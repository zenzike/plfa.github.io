<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Soundness: of reduction with respect to denotational semantics | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Soundness: of reduction with respect to denotational semantics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Programming Language Foundations in Agda" />
<meta property="og:description" content="Programming Language Foundations in Agda" />
<link rel="canonical" href="https://plfa.github.io/Soundness/" />
<meta property="og:url" content="https://plfa.github.io/Soundness/" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<script type="application/ld+json">
{"description":"Programming Language Foundations in Agda","@type":"WebPage","url":"https://plfa.github.io/Soundness/","headline":"Soundness: of reduction with respect to denotational semantics","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">Table of Contents</a>
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Soundness: of reduction with respect to denotational semantics</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="192" class="Keyword">module</a> <a id="199" href="/Soundness/" class="Module">plfa.Soundness</a> <a id="214" class="Keyword">where</a></pre>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="257" class="Keyword">open</a> <a id="262" class="Keyword">import</a> <a id="269" href="/Untyped/" class="Module">plfa.Untyped</a>
<a id="282" class="Keyword">open</a> <a id="287" class="Keyword">import</a> <a id="294" href="/Denotational/" class="Module">plfa.Denotational</a>
<a id="312" class="Keyword">open</a> <a id="317" class="Keyword">import</a> <a id="324" href="/Compositional/" class="Module">plfa.Compositional</a>

<a id="344" class="Keyword">open</a> <a id="349" class="Keyword">import</a> <a id="356" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="396" class="Keyword">using</a> <a id="402" class="Symbol">(</a><a id="403" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a><a id="406" class="Symbol">;</a> <a id="408" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">_≢_</a><a id="411" class="Symbol">;</a> <a id="413" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="417" class="Symbol">;</a> <a id="419" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a><a id="422" class="Symbol">;</a> <a id="424" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1170" class="Function">cong</a><a id="428" class="Symbol">;</a> <a id="430" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1408" class="Function">cong₂</a><a id="435" class="Symbol">;</a> <a id="437" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1274" class="Function">cong-app</a><a id="445" class="Symbol">)</a>
<a id="447" class="Keyword">open</a> <a id="452" class="Keyword">import</a> <a id="459" href="https://agda.github.io/agda-stdlib/Data.Product.html" class="Module">Data.Product</a> <a id="472" class="Keyword">using</a> <a id="478" class="Symbol">(</a><a id="479" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">_×_</a><a id="482" class="Symbol">;</a> <a id="484" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#69" class="Record">Σ</a><a id="485" class="Symbol">;</a> <a id="487" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ-syntax</a><a id="495" class="Symbol">;</a> <a id="497" href="https://agda.github.io/agda-stdlib/Data.Product.html#881" class="Function">∃</a><a id="498" class="Symbol">;</a> <a id="500" href="https://agda.github.io/agda-stdlib/Data.Product.html#942" class="Function">∃-syntax</a><a id="508" class="Symbol">;</a> <a id="510" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a><a id="515" class="Symbol">;</a> <a id="517" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#167" class="Field">proj₂</a><a id="522" class="Symbol">)</a>
  <a id="526" class="Keyword">renaming</a> <a id="535" class="Symbol">(</a><a id="536" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">_,_</a> <a id="540" class="Symbol">to</a> <a id="543" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="548" class="Symbol">)</a>
<a id="550" class="Keyword">open</a> <a id="555" class="Keyword">import</a> <a id="562" href="https://agda.github.io/agda-stdlib/Data.Sum.html" class="Module">Data.Sum</a>
<a id="571" class="Keyword">open</a> <a id="576" class="Keyword">import</a> <a id="583" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="598" class="Keyword">using</a> <a id="604" class="Symbol">(</a><a id="605" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html#611" class="Primitive">lzero</a><a id="610" class="Symbol">)</a>
<a id="612" class="Keyword">open</a> <a id="617" class="Keyword">import</a> <a id="624" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="641" class="Keyword">using</a> <a id="647" class="Symbol">(</a><a id="648" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#464" class="Function Operator">¬_</a><a id="650" class="Symbol">)</a>
<a id="652" class="Keyword">open</a> <a id="657" class="Keyword">import</a> <a id="664" href="https://agda.github.io/agda-stdlib/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="690" class="Keyword">using</a> <a id="696" class="Symbol">(</a><a id="697" href="https://agda.github.io/agda-stdlib/Relation.Nullary.Negation.html#560" class="Function">contradiction</a><a id="710" class="Symbol">)</a>
<a id="712" class="Keyword">open</a> <a id="717" class="Keyword">import</a> <a id="724" href="https://agda.github.io/agda-stdlib/Data.Empty.html" class="Module">Data.Empty</a> <a id="735" class="Keyword">using</a> <a id="741" class="Symbol">(</a><a id="742" href="https://agda.github.io/agda-stdlib/Data.Empty.html#360" class="Function">⊥-elim</a><a id="748" class="Symbol">)</a>
<a id="750" class="Keyword">open</a> <a id="755" class="Keyword">import</a> <a id="762" href="https://agda.github.io/agda-stdlib/Data.Unit.html" class="Module">Data.Unit</a>
<a id="772" class="Keyword">open</a> <a id="777" class="Keyword">import</a> <a id="784" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="801" class="Keyword">using</a> <a id="807" class="Symbol">(</a><a id="808" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#534" class="Datatype">Dec</a><a id="811" class="Symbol">;</a> <a id="813" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a><a id="816" class="Symbol">;</a> <a id="818" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a><a id="820" class="Symbol">)</a>
<a id="822" class="Keyword">open</a> <a id="827" class="Keyword">import</a> <a id="834" href="https://agda.github.io/agda-stdlib/Function.html" class="Module">Function</a> <a id="843" class="Keyword">using</a> <a id="849" class="Symbol">(</a><a id="850" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">_∘_</a><a id="853" class="Symbol">)</a>
<a id="855" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a></pre>

<p>In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e.,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M —↠ ƛ N  implies  ℰ M ≃ ℰ (ƛ N)
</code></pre></div></div>

<p>The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if a term M steps to
N, then M and N are denotationally equal. We shall prove each
direction of this if-and-only-if separately. One direction will look
just like a type preservation proof. The other direction is like
proving type preservation for reduction going in reverse.  Recall that
type preservation is sometimes called subject reduction. Preservation
in reverse is a well-known property and is called <em>subject
expansion</em>. It is also well-known that subject expansion is false for
most typed lambda calculi!</p>

<h2 id="forward-reduction-preserves-denotations">Forward reduction preserves denotations</h2>

<p>The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.</p>

<p>The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.</p>

<h3 id="simultaneous-substitution-preserves-denotations">Simultaneous substitution preserves denotations</h3>

<p>We introduce the following shorthand for the type of a substitution
from variables in context Γ to terms in context Δ.</p>

<pre class="Agda"><a id="Subst"></a><a id="2446" href="/Soundness/#2446" class="Function">Subst</a> <a id="2452" class="Symbol">:</a> <a id="2454" href="/Untyped/#2980" class="Datatype">Context</a> <a id="2462" class="Symbol">→</a> <a id="2464" href="/Untyped/#2980" class="Datatype">Context</a> <a id="2472" class="Symbol">→</a> <a id="2474" class="PrimitiveType">Set</a>
<a id="2478" href="/Soundness/#2446" class="Function">Subst</a> <a id="2484" href="/Soundness/#2484" class="Bound">Γ</a> <a id="2486" href="/Soundness/#2486" class="Bound">Δ</a> <a id="2488" class="Symbol">=</a> <a id="2490" class="Symbol">∀{</a><a id="2492" href="/Soundness/#2492" class="Bound">A</a><a id="2493" class="Symbol">}</a> <a id="2495" class="Symbol">→</a> <a id="2497" href="/Soundness/#2484" class="Bound">Γ</a> <a id="2499" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="2501" href="/Soundness/#2492" class="Bound">A</a> <a id="2503" class="Symbol">→</a> <a id="2505" href="/Soundness/#2486" class="Bound">Δ</a> <a id="2507" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="2509" href="/Soundness/#2492" class="Bound">A</a></pre>

<p>Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if M results in v in environment γ, then applying a
substitution σ to M gives us a program that also results in v, but in
an environment δ in which, for every variable x, σ x results in the
same value as the one for x in the original environment γ.
We write δ `⊢ σ ↓ γ for this condition.</p>

<pre class="Agda"><a id="_`⊢_↓_"></a><a id="2912" href="/Soundness/#2912" class="Function Operator">_`⊢_↓_</a> <a id="2919" class="Symbol">:</a> <a id="2921" class="Symbol">∀{</a><a id="2923" href="/Soundness/#2923" class="Bound">Δ</a> <a id="2925" href="/Soundness/#2925" class="Bound">Γ</a><a id="2926" class="Symbol">}</a> <a id="2928" class="Symbol">→</a> <a id="2930" href="/Denotational/#7331" class="Function">Env</a> <a id="2934" href="/Soundness/#2923" class="Bound">Δ</a> <a id="2936" class="Symbol">→</a> <a id="2938" href="/Soundness/#2446" class="Function">Subst</a> <a id="2944" href="/Soundness/#2925" class="Bound">Γ</a> <a id="2946" href="/Soundness/#2923" class="Bound">Δ</a> <a id="2948" class="Symbol">→</a> <a id="2950" href="/Denotational/#7331" class="Function">Env</a> <a id="2954" href="/Soundness/#2925" class="Bound">Γ</a> <a id="2956" class="Symbol">→</a> <a id="2958" class="PrimitiveType">Set</a>
<a id="2962" href="/Soundness/#2912" class="Function Operator">_`⊢_↓_</a> <a id="2969" class="Symbol">{</a><a id="2970" href="/Soundness/#2970" class="Bound">Δ</a><a id="2971" class="Symbol">}{</a><a id="2973" href="/Soundness/#2973" class="Bound">Γ</a><a id="2974" class="Symbol">}</a> <a id="2976" href="/Soundness/#2976" class="Bound">δ</a> <a id="2978" href="/Soundness/#2978" class="Bound">σ</a> <a id="2980" href="/Soundness/#2980" class="Bound">γ</a> <a id="2982" class="Symbol">=</a> <a id="2984" class="Symbol">(∀</a> <a id="2987" class="Symbol">(</a><a id="2988" href="/Soundness/#2988" class="Bound">x</a> <a id="2990" class="Symbol">:</a> <a id="2992" href="/Soundness/#2973" class="Bound">Γ</a> <a id="2994" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="2996" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="2997" class="Symbol">)</a> <a id="2999" class="Symbol">→</a> <a id="3001" href="/Soundness/#2976" class="Bound">δ</a> <a id="3003" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="3005" href="/Soundness/#2978" class="Bound">σ</a> <a id="3007" href="/Soundness/#2988" class="Bound">x</a> <a id="3009" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="3011" href="/Soundness/#2980" class="Bound">γ</a> <a id="3013" href="/Soundness/#2988" class="Bound">x</a><a id="3014" class="Symbol">)</a></pre>

<p>As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the exts function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in (δ , v) produce the values in (γ , v).</p>

<pre class="Agda"><a id="subst-ext"></a><a id="3293" href="/Soundness/#3293" class="Function">subst-ext</a> <a id="3303" class="Symbol">:</a> <a id="3305" class="Symbol">∀</a> <a id="3307" class="Symbol">{</a><a id="3308" href="/Soundness/#3308" class="Bound">Γ</a> <a id="3310" href="/Soundness/#3310" class="Bound">Δ</a> <a id="3312" href="/Soundness/#3312" class="Bound">v</a><a id="3313" class="Symbol">}</a> <a id="3315" class="Symbol">{</a><a id="3316" href="/Soundness/#3316" class="Bound">γ</a> <a id="3318" class="Symbol">:</a> <a id="3320" href="/Denotational/#7331" class="Function">Env</a> <a id="3324" href="/Soundness/#3308" class="Bound">Γ</a><a id="3325" class="Symbol">}</a> <a id="3327" class="Symbol">{</a><a id="3328" href="/Soundness/#3328" class="Bound">δ</a> <a id="3330" class="Symbol">:</a> <a id="3332" href="/Denotational/#7331" class="Function">Env</a> <a id="3336" href="/Soundness/#3310" class="Bound">Δ</a><a id="3337" class="Symbol">}</a>
  <a id="3341" class="Symbol">→</a> <a id="3343" class="Symbol">(</a><a id="3344" href="/Soundness/#3344" class="Bound">σ</a> <a id="3346" class="Symbol">:</a> <a id="3348" href="/Soundness/#2446" class="Function">Subst</a> <a id="3354" href="/Soundness/#3308" class="Bound">Γ</a> <a id="3356" href="/Soundness/#3310" class="Bound">Δ</a><a id="3357" class="Symbol">)</a>
  <a id="3361" class="Symbol">→</a> <a id="3363" href="/Soundness/#3328" class="Bound">δ</a> <a id="3365" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="3368" href="/Soundness/#3344" class="Bound">σ</a> <a id="3370" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="3372" href="/Soundness/#3316" class="Bound">γ</a>
   <a id="3377" class="Comment">------------------------------</a>
  <a id="3410" class="Symbol">→</a> <a id="3412" class="Symbol">(</a><a id="3413" href="/Soundness/#3328" class="Bound">δ</a> <a id="3415" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="3418" href="/Soundness/#3312" class="Bound">v</a><a id="3419" class="Symbol">)</a> <a id="3421" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="3424" href="/Untyped/#6623" class="Function">exts</a> <a id="3429" href="/Soundness/#3344" class="Bound">σ</a> <a id="3431" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="3433" class="Symbol">(</a><a id="3434" href="/Soundness/#3316" class="Bound">γ</a> <a id="3436" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="3439" href="/Soundness/#3312" class="Bound">v</a><a id="3440" class="Symbol">)</a>
<a id="3442" href="/Soundness/#3293" class="Function">subst-ext</a> <a id="3452" href="/Soundness/#3452" class="Bound">σ</a> <a id="3454" href="/Soundness/#3454" class="Bound">d</a> <a id="3456" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="3458" class="Symbol">=</a> <a id="3460" href="/Denotational/#9910" class="InductiveConstructor">var</a>
<a id="3464" href="/Soundness/#3293" class="Function">subst-ext</a> <a id="3474" href="/Soundness/#3474" class="Bound">σ</a> <a id="3476" href="/Soundness/#3476" class="Bound">d</a> <a id="3478" class="Symbol">(</a><a id="3479" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="3481" href="/Soundness/#3481" class="Bound">x</a><a id="3482" class="Symbol">)</a> <a id="3484" class="Symbol">=</a> <a id="3486" href="/Denotational/#23424" class="Function">rename-pres</a> <a id="3498" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="3501" class="Symbol">(λ</a> <a id="3504" href="/Soundness/#3504" class="Bound">_</a> <a id="3506" class="Symbol">→</a> <a id="3508" href="/Denotational/#5638" class="Function">Refl⊑</a><a id="3513" class="Symbol">)</a> <a id="3515" class="Symbol">(</a><a id="3516" href="/Soundness/#3476" class="Bound">d</a> <a id="3518" href="/Soundness/#3481" class="Bound">x</a><a id="3519" class="Symbol">)</a></pre>

<p>The proof is by cases on the de Bruijn index x.</p>

<ul>
  <li>
    <p>If it is Z, then we need to show that δ , v ⊢ # 0 ↓ v,
which we have by rule (var).</p>
  </li>
  <li>
    <p>If it is S x’,then we need to show that 
(δ , v) ⊢ rename S_ (σ x’) ↓ nth x’ γ,
which we obtain by the renaming lemma.</p>
  </li>
</ul>

<p>With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let’s dive in!</p>

<pre class="Agda"><a id="subst-pres"></a><a id="3940" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="3951" class="Symbol">:</a> <a id="3953" class="Symbol">∀</a> <a id="3955" class="Symbol">{</a><a id="3956" href="/Soundness/#3956" class="Bound">Γ</a> <a id="3958" href="/Soundness/#3958" class="Bound">Δ</a> <a id="3960" href="/Soundness/#3960" class="Bound">v</a><a id="3961" class="Symbol">}</a> <a id="3963" class="Symbol">{</a><a id="3964" href="/Soundness/#3964" class="Bound">γ</a> <a id="3966" class="Symbol">:</a> <a id="3968" href="/Denotational/#7331" class="Function">Env</a> <a id="3972" href="/Soundness/#3956" class="Bound">Γ</a><a id="3973" class="Symbol">}</a> <a id="3975" class="Symbol">{</a><a id="3976" href="/Soundness/#3976" class="Bound">δ</a> <a id="3978" class="Symbol">:</a> <a id="3980" href="/Denotational/#7331" class="Function">Env</a> <a id="3984" href="/Soundness/#3958" class="Bound">Δ</a><a id="3985" class="Symbol">}</a> <a id="3987" class="Symbol">{</a><a id="3988" href="/Soundness/#3988" class="Bound">M</a> <a id="3990" class="Symbol">:</a> <a id="3992" href="/Soundness/#3956" class="Bound">Γ</a> <a id="3994" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="3996" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="3997" class="Symbol">}</a>
  <a id="4001" class="Symbol">→</a> <a id="4003" class="Symbol">(</a><a id="4004" href="/Soundness/#4004" class="Bound">σ</a> <a id="4006" class="Symbol">:</a> <a id="4008" href="/Soundness/#2446" class="Function">Subst</a> <a id="4014" href="/Soundness/#3956" class="Bound">Γ</a> <a id="4016" href="/Soundness/#3958" class="Bound">Δ</a><a id="4017" class="Symbol">)</a>
  <a id="4021" class="Symbol">→</a> <a id="4023" href="/Soundness/#3976" class="Bound">δ</a> <a id="4025" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="4028" href="/Soundness/#4004" class="Bound">σ</a> <a id="4030" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="4032" href="/Soundness/#3964" class="Bound">γ</a>
  <a id="4036" class="Symbol">→</a> <a id="4038" href="/Soundness/#3964" class="Bound">γ</a> <a id="4040" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="4042" href="/Soundness/#3988" class="Bound">M</a> <a id="4044" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="4046" href="/Soundness/#3960" class="Bound">v</a>
    <a id="4052" class="Comment">------------------</a>
  <a id="4073" class="Symbol">→</a> <a id="4075" href="/Soundness/#3976" class="Bound">δ</a> <a id="4077" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="4079" href="/Untyped/#6931" class="Function">subst</a> <a id="4085" href="/Soundness/#4004" class="Bound">σ</a> <a id="4087" href="/Soundness/#3988" class="Bound">M</a> <a id="4089" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="4091" href="/Soundness/#3960" class="Bound">v</a>
<a id="4093" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4104" href="/Soundness/#4104" class="Bound">σ</a> <a id="4106" href="/Soundness/#4106" class="Bound">s</a> <a id="4108" class="Symbol">(</a><a id="4109" href="/Denotational/#9910" class="InductiveConstructor">var</a> <a id="4113" class="Symbol">{</a><a id="4114" class="Argument">x</a> <a id="4116" class="Symbol">=</a> <a id="4118" href="/Soundness/#4118" class="Bound">x</a><a id="4119" class="Symbol">})</a> <a id="4122" class="Symbol">=</a> <a id="4124" class="Symbol">(</a><a id="4125" href="/Soundness/#4106" class="Bound">s</a> <a id="4127" href="/Soundness/#4118" class="Bound">x</a><a id="4128" class="Symbol">)</a>
<a id="4130" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4141" href="/Soundness/#4141" class="Bound">σ</a> <a id="4143" href="/Soundness/#4143" class="Bound">s</a> <a id="4145" class="Symbol">(</a><a id="4146" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="4153" href="/Soundness/#4153" class="Bound">d₁</a> <a id="4156" href="/Soundness/#4156" class="Bound">d₂</a><a id="4158" class="Symbol">)</a> <a id="4160" class="Symbol">=</a>
  <a id="4164" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="4171" class="Symbol">(</a><a id="4172" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4183" href="/Soundness/#4141" class="Bound">σ</a> <a id="4185" href="/Soundness/#4143" class="Bound">s</a> <a id="4187" href="/Soundness/#4153" class="Bound">d₁</a><a id="4189" class="Symbol">)</a> <a id="4191" class="Symbol">(</a><a id="4192" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4203" href="/Soundness/#4141" class="Bound">σ</a> <a id="4205" href="/Soundness/#4143" class="Bound">s</a> <a id="4207" href="/Soundness/#4156" class="Bound">d₂</a><a id="4209" class="Symbol">)</a> 
<a id="4212" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4223" href="/Soundness/#4223" class="Bound">σ</a> <a id="4225" href="/Soundness/#4225" class="Bound">s</a> <a id="4227" class="Symbol">(</a><a id="4228" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="4236" href="/Soundness/#4236" class="Bound">d</a><a id="4237" class="Symbol">)</a> <a id="4239" class="Symbol">=</a>
  <a id="4243" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="4251" class="Symbol">(</a><a id="4252" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4263" class="Symbol">(λ</a> <a id="4266" class="Symbol">{</a><a id="4267" href="/Soundness/#4267" class="Bound">A</a><a id="4268" class="Symbol">}</a> <a id="4270" class="Symbol">→</a> <a id="4272" href="/Untyped/#6623" class="Function">exts</a> <a id="4277" href="/Soundness/#4223" class="Bound">σ</a><a id="4278" class="Symbol">)</a> <a id="4280" class="Symbol">(</a><a id="4281" href="/Soundness/#3293" class="Function">subst-ext</a> <a id="4291" href="/Soundness/#4223" class="Bound">σ</a> <a id="4293" href="/Soundness/#4225" class="Bound">s</a><a id="4294" class="Symbol">)</a> <a id="4296" href="/Soundness/#4236" class="Bound">d</a><a id="4297" class="Symbol">)</a>
<a id="4299" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4310" href="/Soundness/#4310" class="Bound">σ</a> <a id="4312" href="/Soundness/#4312" class="Bound">s</a> <a id="4314" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a> <a id="4322" class="Symbol">=</a> <a id="4324" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a>
<a id="4332" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4343" href="/Soundness/#4343" class="Bound">σ</a> <a id="4345" href="/Soundness/#4345" class="Bound">s</a> <a id="4347" class="Symbol">(</a><a id="4348" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="4356" href="/Soundness/#4356" class="Bound">d₁</a> <a id="4359" href="/Soundness/#4359" class="Bound">d₂</a><a id="4361" class="Symbol">)</a> <a id="4363" class="Symbol">=</a>
  <a id="4367" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="4375" class="Symbol">(</a><a id="4376" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4387" href="/Soundness/#4343" class="Bound">σ</a> <a id="4389" href="/Soundness/#4345" class="Bound">s</a> <a id="4391" href="/Soundness/#4356" class="Bound">d₁</a><a id="4393" class="Symbol">)</a> <a id="4395" class="Symbol">(</a><a id="4396" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4407" href="/Soundness/#4343" class="Bound">σ</a> <a id="4409" href="/Soundness/#4345" class="Bound">s</a> <a id="4411" href="/Soundness/#4359" class="Bound">d₂</a><a id="4413" class="Symbol">)</a>
<a id="4415" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4426" href="/Soundness/#4426" class="Bound">σ</a> <a id="4428" href="/Soundness/#4428" class="Bound">s</a> <a id="4430" class="Symbol">(</a><a id="4431" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="4435" href="/Soundness/#4435" class="Bound">d</a> <a id="4437" href="/Soundness/#4437" class="Bound">lt</a><a id="4439" class="Symbol">)</a> <a id="4441" class="Symbol">=</a> <a id="4443" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="4447" class="Symbol">(</a><a id="4448" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="4459" href="/Soundness/#4426" class="Bound">σ</a> <a id="4461" href="/Soundness/#4428" class="Bound">s</a> <a id="4463" href="/Soundness/#4435" class="Bound">d</a><a id="4464" class="Symbol">)</a> <a id="4466" href="/Soundness/#4437" class="Bound">lt</a></pre>

<p>The proof is by induction on the semantics of M.  The two interesting
cases are for variables and lambda abstractions.</p>

<ul>
  <li>
    <p>For a variable x, we have that v ⊑ nth x γ and we need to show that
δ ⊢ σ x ↓ v.  From the premise applied to x, we have that
δ ⊢ σ x ↓ nth x γ, so we conclude by the (sub) rule.</p>
  </li>
  <li>
    <p>For a lambda abstraction, we must extend the substitution
for the induction hypothesis. We apply the extension lemma
to show that the extended substitution maps variables to
terms that result in the appropriate values.</p>
  </li>
</ul>

<h3 id="single-substitution-preserves-denotations">Single substitution preserves denotations</h3>

<p>For β reduction, (ƛ M) · N —→ M [ N ], we need to show that the
semantics is preserved when substituting N for de Bruijn index 0 in
term M. By inversion on the rules (↦-elim) and (↦-intro),
we have that γ , v₁ ⊢ M ↓ v₂ and γ ⊢ N ↓ v₁.
So we need to show that γ ⊢ M [ N ] ↓ v₂, or equivalently,
that γ ⊢ subst (subst-zero N) M ↓ v₂.</p>

<pre class="Agda"><a id="substitution"></a><a id="5409" href="/Soundness/#5409" class="Function">substitution</a> <a id="5422" class="Symbol">:</a> <a id="5424" class="Symbol">∀</a> <a id="5426" class="Symbol">{</a><a id="5427" href="/Soundness/#5427" class="Bound">Γ</a><a id="5428" class="Symbol">}</a> <a id="5430" class="Symbol">{</a><a id="5431" href="/Soundness/#5431" class="Bound">γ</a> <a id="5433" class="Symbol">:</a> <a id="5435" href="/Denotational/#7331" class="Function">Env</a> <a id="5439" href="/Soundness/#5427" class="Bound">Γ</a><a id="5440" class="Symbol">}</a> <a id="5442" class="Symbol">{</a><a id="5443" href="/Soundness/#5443" class="Bound">M</a> <a id="5445" href="/Soundness/#5445" class="Bound">N</a> <a id="5447" href="/Soundness/#5447" class="Bound">v₁</a> <a id="5450" href="/Soundness/#5450" class="Bound">v₂</a><a id="5452" class="Symbol">}</a>
   <a id="5457" class="Symbol">→</a> <a id="5459" href="/Soundness/#5431" class="Bound">γ</a> <a id="5461" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="5464" href="/Soundness/#5447" class="Bound">v₁</a> <a id="5467" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="5469" href="/Soundness/#5443" class="Bound">M</a> <a id="5471" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="5473" href="/Soundness/#5450" class="Bound">v₂</a>
   <a id="5479" class="Symbol">→</a> <a id="5481" href="/Soundness/#5431" class="Bound">γ</a> <a id="5483" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="5485" href="/Soundness/#5445" class="Bound">N</a> <a id="5487" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="5489" href="/Soundness/#5447" class="Bound">v₁</a>
     <a id="5497" class="Comment">-----------------</a>
   <a id="5518" class="Symbol">→</a> <a id="5520" href="/Soundness/#5431" class="Bound">γ</a> <a id="5522" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="5524" href="/Soundness/#5443" class="Bound">M</a> <a id="5526" href="/Untyped/#7475" class="Function Operator">[</a> <a id="5528" href="/Soundness/#5445" class="Bound">N</a> <a id="5530" href="/Untyped/#7475" class="Function Operator">]</a> <a id="5532" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="5534" href="/Soundness/#5450" class="Bound">v₂</a>   
<a id="5540" href="/Soundness/#5409" class="Function">substitution</a><a id="5552" class="Symbol">{</a><a id="5553" href="/Soundness/#5553" class="Bound">Γ</a><a id="5554" class="Symbol">}{</a><a id="5556" href="/Soundness/#5556" class="Bound">γ</a><a id="5557" class="Symbol">}{</a><a id="5559" href="/Soundness/#5559" class="Bound">M</a><a id="5560" class="Symbol">}{</a><a id="5562" href="/Soundness/#5562" class="Bound">N</a><a id="5563" class="Symbol">}{</a><a id="5565" href="/Soundness/#5565" class="Bound">v₁</a><a id="5567" class="Symbol">}{</a><a id="5569" href="/Soundness/#5569" class="Bound">v₂</a><a id="5571" class="Symbol">}</a> <a id="5573" href="/Soundness/#5573" class="Bound">dm</a> <a id="5576" href="/Soundness/#5576" class="Bound">dn</a> <a id="5579" class="Symbol">=</a>
  <a id="5583" href="/Soundness/#3940" class="Function">subst-pres</a> <a id="5594" class="Symbol">(</a><a id="5595" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5606" href="/Soundness/#5562" class="Bound">N</a><a id="5607" class="Symbol">)</a> <a id="5609" href="/Soundness/#5631" class="Function">sub-z-ok</a> <a id="5618" href="/Soundness/#5573" class="Bound">dm</a>
  <a id="5623" class="Keyword">where</a>
  <a id="5631" href="/Soundness/#5631" class="Function">sub-z-ok</a> <a id="5640" class="Symbol">:</a> <a id="5642" href="/Soundness/#5556" class="Bound">γ</a> <a id="5644" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="5647" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5658" href="/Soundness/#5562" class="Bound">N</a> <a id="5660" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="5662" class="Symbol">(</a><a id="5663" href="/Soundness/#5556" class="Bound">γ</a> <a id="5665" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="5668" href="/Soundness/#5565" class="Bound">v₁</a><a id="5670" class="Symbol">)</a>
  <a id="5674" href="/Soundness/#5631" class="Function">sub-z-ok</a> <a id="5683" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="5685" class="Symbol">=</a> <a id="5687" href="/Soundness/#5576" class="Bound">dn</a>
  <a id="5692" href="/Soundness/#5631" class="Function">sub-z-ok</a> <a id="5701" class="Symbol">(</a><a id="5702" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="5704" href="/Soundness/#5704" class="Bound">x</a><a id="5705" class="Symbol">)</a> <a id="5707" class="Symbol">=</a> <a id="5709" href="/Denotational/#9910" class="InductiveConstructor">var</a></pre>

<p>This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that (subst-zero N) maps
variables to terms that produces the same values as those in γ , v₁.
Let y be an arbitrary variable (de Bruijn index).</p>

<ul>
  <li>
    <p>If it is Z, then (subst-zero N) y = N and nth y (γ , v₁) = v₁.
By the premise we conclude that γ ⊢ N ↓ v₁.</p>
  </li>
  <li>
    <p>If it is (S y’), then (subst-zero N) (S y’) = y’ and
nth (S y’) (γ , v₁) = nth y’ γ.  So we conclude that
γ ⊢ y’ ↓ nth y’ γ by rule (var).</p>
  </li>
</ul>

<h3 id="reduction-preserves-denotations">Reduction preserves denotations</h3>

<p>With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.</p>

<pre class="Agda"><a id="preserve"></a><a id="6396" href="/Soundness/#6396" class="Function">preserve</a> <a id="6405" class="Symbol">:</a> <a id="6407" class="Symbol">∀</a> <a id="6409" class="Symbol">{</a><a id="6410" href="/Soundness/#6410" class="Bound">Γ</a><a id="6411" class="Symbol">}</a> <a id="6413" class="Symbol">{</a><a id="6414" href="/Soundness/#6414" class="Bound">γ</a> <a id="6416" class="Symbol">:</a> <a id="6418" href="/Denotational/#7331" class="Function">Env</a> <a id="6422" href="/Soundness/#6410" class="Bound">Γ</a><a id="6423" class="Symbol">}</a> <a id="6425" class="Symbol">{</a><a id="6426" href="/Soundness/#6426" class="Bound">M</a> <a id="6428" href="/Soundness/#6428" class="Bound">N</a> <a id="6430" href="/Soundness/#6430" class="Bound">v</a><a id="6431" class="Symbol">}</a>
  <a id="6435" class="Symbol">→</a> <a id="6437" href="/Soundness/#6414" class="Bound">γ</a> <a id="6439" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="6441" href="/Soundness/#6426" class="Bound">M</a> <a id="6443" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="6445" href="/Soundness/#6430" class="Bound">v</a>
  <a id="6449" class="Symbol">→</a> <a id="6451" href="/Soundness/#6426" class="Bound">M</a> <a id="6453" href="/Untyped/#10070" class="Datatype Operator">—→</a> <a id="6456" href="/Soundness/#6428" class="Bound">N</a>
    <a id="6462" class="Comment">----------</a>
  <a id="6475" class="Symbol">→</a> <a id="6477" href="/Soundness/#6414" class="Bound">γ</a> <a id="6479" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="6481" href="/Soundness/#6428" class="Bound">N</a> <a id="6483" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="6485" href="/Soundness/#6430" class="Bound">v</a>
<a id="6487" href="/Soundness/#6396" class="Function">preserve</a> <a id="6496" class="Symbol">(</a><a id="6497" href="/Denotational/#9910" class="InductiveConstructor">var</a><a id="6500" class="Symbol">)</a> <a id="6502" class="Symbol">()</a>
<a id="6505" href="/Soundness/#6396" class="Function">preserve</a> <a id="6514" class="Symbol">(</a><a id="6515" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="6522" href="/Soundness/#6522" class="Bound">d₁</a> <a id="6525" href="/Soundness/#6525" class="Bound">d₂</a><a id="6527" class="Symbol">)</a> <a id="6529" class="Symbol">(</a><a id="6530" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="6533" href="/Soundness/#6533" class="Bound">x</a> <a id="6535" href="/Soundness/#6535" class="Bound">r</a><a id="6536" class="Symbol">)</a> <a id="6538" class="Symbol">=</a> <a id="6540" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="6547" class="Symbol">(</a><a id="6548" href="/Soundness/#6396" class="Function">preserve</a> <a id="6557" href="/Soundness/#6522" class="Bound">d₁</a> <a id="6560" href="/Soundness/#6535" class="Bound">r</a><a id="6561" class="Symbol">)</a> <a id="6563" href="/Soundness/#6525" class="Bound">d₂</a> 
<a id="6567" href="/Soundness/#6396" class="Function">preserve</a> <a id="6576" class="Symbol">(</a><a id="6577" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="6584" href="/Soundness/#6584" class="Bound">d₁</a> <a id="6587" href="/Soundness/#6587" class="Bound">d₂</a><a id="6589" class="Symbol">)</a> <a id="6591" class="Symbol">(</a><a id="6592" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="6595" href="/Soundness/#6595" class="Bound">x</a> <a id="6597" href="/Soundness/#6597" class="Bound">r</a><a id="6598" class="Symbol">)</a> <a id="6600" class="Symbol">=</a> <a id="6602" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="6609" href="/Soundness/#6584" class="Bound">d₁</a> <a id="6612" class="Symbol">(</a><a id="6613" href="/Soundness/#6396" class="Function">preserve</a> <a id="6622" href="/Soundness/#6587" class="Bound">d₂</a> <a id="6625" href="/Soundness/#6597" class="Bound">r</a><a id="6626" class="Symbol">)</a> 
<a id="6629" href="/Soundness/#6396" class="Function">preserve</a> <a id="6638" class="Symbol">(</a><a id="6639" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="6646" href="/Soundness/#6646" class="Bound">d₁</a> <a id="6649" href="/Soundness/#6649" class="Bound">d₂</a><a id="6651" class="Symbol">)</a> <a id="6653" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="6655" class="Symbol">=</a> <a id="6657" href="/Soundness/#5409" class="Function">substitution</a> <a id="6670" class="Symbol">(</a><a id="6671" href="/Compositional/#3361" class="Function">lambda-inversion</a> <a id="6688" href="/Soundness/#6646" class="Bound">d₁</a><a id="6690" class="Symbol">)</a> <a id="6692" href="/Soundness/#6649" class="Bound">d₂</a>
<a id="6695" href="/Soundness/#6396" class="Function">preserve</a> <a id="6704" class="Symbol">(</a><a id="6705" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="6713" href="/Soundness/#6713" class="Bound">d</a><a id="6714" class="Symbol">)</a> <a id="6716" class="Symbol">(</a><a id="6717" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="6719" href="/Soundness/#6719" class="Bound">r</a><a id="6720" class="Symbol">)</a> <a id="6722" class="Symbol">=</a> <a id="6724" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="6732" class="Symbol">(</a><a id="6733" href="/Soundness/#6396" class="Function">preserve</a> <a id="6742" href="/Soundness/#6713" class="Bound">d</a> <a id="6744" href="/Soundness/#6719" class="Bound">r</a><a id="6745" class="Symbol">)</a>
<a id="6747" href="/Soundness/#6396" class="Function">preserve</a> <a id="6756" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a> <a id="6764" href="/Soundness/#6764" class="Bound">r</a> <a id="6766" class="Symbol">=</a> <a id="6768" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a>
<a id="6776" href="/Soundness/#6396" class="Function">preserve</a> <a id="6785" class="Symbol">(</a><a id="6786" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="6794" href="/Soundness/#6794" class="Bound">d</a> <a id="6796" href="/Soundness/#6796" class="Bound">d₁</a><a id="6798" class="Symbol">)</a> <a id="6800" href="/Soundness/#6800" class="Bound">r</a> <a id="6802" class="Symbol">=</a> <a id="6804" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="6812" class="Symbol">(</a><a id="6813" href="/Soundness/#6396" class="Function">preserve</a> <a id="6822" href="/Soundness/#6794" class="Bound">d</a> <a id="6824" href="/Soundness/#6800" class="Bound">r</a><a id="6825" class="Symbol">)</a> <a id="6827" class="Symbol">(</a><a id="6828" href="/Soundness/#6396" class="Function">preserve</a> <a id="6837" href="/Soundness/#6796" class="Bound">d₁</a> <a id="6840" href="/Soundness/#6800" class="Bound">r</a><a id="6841" class="Symbol">)</a>
<a id="6843" href="/Soundness/#6396" class="Function">preserve</a> <a id="6852" class="Symbol">(</a><a id="6853" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="6857" href="/Soundness/#6857" class="Bound">d</a> <a id="6859" href="/Soundness/#6859" class="Bound">lt</a><a id="6861" class="Symbol">)</a> <a id="6863" href="/Soundness/#6863" class="Bound">r</a> <a id="6865" class="Symbol">=</a> <a id="6867" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="6871" class="Symbol">(</a><a id="6872" href="/Soundness/#6396" class="Function">preserve</a> <a id="6881" href="/Soundness/#6857" class="Bound">d</a> <a id="6883" href="/Soundness/#6863" class="Bound">r</a><a id="6884" class="Symbol">)</a> <a id="6886" href="/Soundness/#6859" class="Bound">lt</a></pre>

<p>We proceed by induction on the semantics of M with case analysis on
the reduction.</p>

<ul>
  <li>
    <p>If M is a variable, then there is no such reduction.</p>
  </li>
  <li>
    <p>If M is an application, then the reduction is either a congruence
(ξ₁ or ξ₂) or β. For each congruence, we use the induction
hypothesis. For β reduction we use the substitution lemma and the
(sub) rule.</p>
  </li>
  <li>
    <p>The rest of the cases are straightforward.</p>
  </li>
</ul>

<h2 id="reduction-reflects-denotations">Reduction reflects denotations</h2>

<p>This section proves that reduction reflects the denotation of a
term. That is, if N results in v, and if M reduces to N, then M also
results in v. While there are some broad similarities between this
proof and the above proof of semantic preservation, we shall require a
few more technical lemmas to obtain this result.</p>

<p>The main challenge is dealing with the substitution in β reduction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ƛ M₁) · M₂ —→ M₁ [ M₂ ]
</code></pre></div></div>

<p>We have that γ ⊢ M₁ [ M₂ ] ↓ v and need to show that γ ⊢ (ƛ M₁) · M₂ ↓
v. Now consider the derivation of γ ⊢ M₁ [ M₂ ] ↓ v. The term M₂ may
occur 0, 1, or many times inside M₁ [ M₂ ]. At each of those
occurences, M₂ may result in a different value. But to build a
derivation for (ƛ M₁) · M₂, we need a single value for M₂.  If M₂
occured more than 1 time, then we can join all of the different values
using ⊔. If M₂ occured 0 times, then we can use ⊥ for the value of M₂.</p>

<h3 id="renaming-reflects-meaning">Renaming reflects meaning</h3>

<p>Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if δ ⊢ rename ρ M ↓ v, then γ ⊢ M ↓ v, where (δ ∘ ρ) `⊑ γ.</p>

<p>First, we need a variant of a lemma given earlier.</p>
<pre class="Agda"><a id="nth-ext"></a><a id="8510" href="/Soundness/#8510" class="Function">nth-ext</a> <a id="8518" class="Symbol">:</a> <a id="8520" class="Symbol">∀</a> <a id="8522" class="Symbol">{</a><a id="8523" href="/Soundness/#8523" class="Bound">Γ</a> <a id="8525" href="/Soundness/#8525" class="Bound">Δ</a> <a id="8527" href="/Soundness/#8527" class="Bound">v</a><a id="8528" class="Symbol">}</a> <a id="8530" class="Symbol">{</a><a id="8531" href="/Soundness/#8531" class="Bound">γ</a> <a id="8533" class="Symbol">:</a> <a id="8535" href="/Denotational/#7331" class="Function">Env</a> <a id="8539" href="/Soundness/#8523" class="Bound">Γ</a><a id="8540" class="Symbol">}</a> <a id="8542" class="Symbol">{</a><a id="8543" href="/Soundness/#8543" class="Bound">δ</a> <a id="8545" class="Symbol">:</a> <a id="8547" href="/Denotational/#7331" class="Function">Env</a> <a id="8551" href="/Soundness/#8525" class="Bound">Δ</a><a id="8552" class="Symbol">}</a>
  <a id="8556" class="Symbol">→</a> <a id="8558" class="Symbol">(</a><a id="8559" href="/Soundness/#8559" class="Bound">ρ</a> <a id="8561" class="Symbol">:</a> <a id="8563" href="/Denotational/#22564" class="Function">Rename</a> <a id="8570" href="/Soundness/#8523" class="Bound">Γ</a> <a id="8572" href="/Soundness/#8525" class="Bound">Δ</a><a id="8573" class="Symbol">)</a>
  <a id="8577" class="Symbol">→</a> <a id="8579" class="Symbol">(</a><a id="8580" href="/Soundness/#8543" class="Bound">δ</a> <a id="8582" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="8584" href="/Soundness/#8559" class="Bound">ρ</a><a id="8585" class="Symbol">)</a> <a id="8587" href="/Denotational/#8342" class="Function Operator">`⊑</a> <a id="8590" href="/Soundness/#8531" class="Bound">γ</a>
    <a id="8596" class="Comment">------------------------------</a>
  <a id="8629" class="Symbol">→</a> <a id="8631" class="Symbol">((</a><a id="8633" href="/Soundness/#8543" class="Bound">δ</a> <a id="8635" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="8638" href="/Soundness/#8527" class="Bound">v</a><a id="8639" class="Symbol">)</a> <a id="8641" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="8643" href="/Untyped/#5845" class="Function">ext</a> <a id="8647" href="/Soundness/#8559" class="Bound">ρ</a><a id="8648" class="Symbol">)</a> <a id="8650" href="/Denotational/#8342" class="Function Operator">`⊑</a> <a id="8653" class="Symbol">(</a><a id="8654" href="/Soundness/#8531" class="Bound">γ</a> <a id="8656" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="8659" href="/Soundness/#8527" class="Bound">v</a><a id="8660" class="Symbol">)</a>
<a id="8662" href="/Soundness/#8510" class="Function">nth-ext</a> <a id="8670" href="/Soundness/#8670" class="Bound">ρ</a> <a id="8672" href="/Soundness/#8672" class="Bound">lt</a> <a id="8675" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="8677" class="Symbol">=</a> <a id="8679" href="/Denotational/#5638" class="Function">Refl⊑</a>
<a id="8685" href="/Soundness/#8510" class="Function">nth-ext</a> <a id="8693" href="/Soundness/#8693" class="Bound">ρ</a> <a id="8695" href="/Soundness/#8695" class="Bound">lt</a> <a id="8698" class="Symbol">(</a><a id="8699" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="8701" href="/Soundness/#8701" class="Bound">x</a><a id="8702" class="Symbol">)</a> <a id="8704" class="Symbol">=</a> <a id="8706" href="/Soundness/#8695" class="Bound">lt</a> <a id="8709" href="/Soundness/#8701" class="Bound">x</a></pre>

<p>The proof is then as follows.</p>
<pre class="Agda"><a id="rename-reflect"></a><a id="8766" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="8781" class="Symbol">:</a> <a id="8783" class="Symbol">∀</a> <a id="8785" class="Symbol">{</a><a id="8786" href="/Soundness/#8786" class="Bound">Γ</a> <a id="8788" href="/Soundness/#8788" class="Bound">Δ</a> <a id="8790" href="/Soundness/#8790" class="Bound">v</a><a id="8791" class="Symbol">}</a> <a id="8793" class="Symbol">{</a><a id="8794" href="/Soundness/#8794" class="Bound">γ</a> <a id="8796" class="Symbol">:</a> <a id="8798" href="/Denotational/#7331" class="Function">Env</a> <a id="8802" href="/Soundness/#8786" class="Bound">Γ</a><a id="8803" class="Symbol">}</a> <a id="8805" class="Symbol">{</a><a id="8806" href="/Soundness/#8806" class="Bound">δ</a> <a id="8808" class="Symbol">:</a> <a id="8810" href="/Denotational/#7331" class="Function">Env</a> <a id="8814" href="/Soundness/#8788" class="Bound">Δ</a><a id="8815" class="Symbol">}</a> <a id="8817" class="Symbol">{</a> <a id="8819" href="/Soundness/#8819" class="Bound">M</a> <a id="8821" class="Symbol">:</a> <a id="8823" href="/Soundness/#8786" class="Bound">Γ</a> <a id="8825" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="8827" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="8828" class="Symbol">}</a>
  <a id="8832" class="Symbol">→</a> <a id="8834" class="Symbol">{</a><a id="8835" href="/Soundness/#8835" class="Bound">ρ</a> <a id="8837" class="Symbol">:</a> <a id="8839" href="/Denotational/#22564" class="Function">Rename</a> <a id="8846" href="/Soundness/#8786" class="Bound">Γ</a> <a id="8848" href="/Soundness/#8788" class="Bound">Δ</a><a id="8849" class="Symbol">}</a>
  <a id="8853" class="Symbol">→</a> <a id="8855" class="Symbol">(</a><a id="8856" href="/Soundness/#8806" class="Bound">δ</a> <a id="8858" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="8860" href="/Soundness/#8835" class="Bound">ρ</a><a id="8861" class="Symbol">)</a> <a id="8863" href="/Denotational/#8342" class="Function Operator">`⊑</a> <a id="8866" href="/Soundness/#8794" class="Bound">γ</a>
  <a id="8870" class="Symbol">→</a> <a id="8872" href="/Soundness/#8806" class="Bound">δ</a> <a id="8874" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="8876" href="/Untyped/#6171" class="Function">rename</a> <a id="8883" href="/Soundness/#8835" class="Bound">ρ</a> <a id="8885" href="/Soundness/#8819" class="Bound">M</a> <a id="8887" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="8889" href="/Soundness/#8790" class="Bound">v</a>
    <a id="8895" class="Comment">------------------------------------</a>
  <a id="8934" class="Symbol">→</a> <a id="8936" href="/Soundness/#8794" class="Bound">γ</a> <a id="8938" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="8940" href="/Soundness/#8819" class="Bound">M</a> <a id="8942" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="8944" href="/Soundness/#8790" class="Bound">v</a>
<a id="8946" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="8961" class="Symbol">{</a><a id="8962" class="Argument">M</a> <a id="8964" class="Symbol">=</a> <a id="8966" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="8968" href="/Soundness/#8968" class="Bound">x</a><a id="8969" class="Symbol">}</a> <a id="8971" href="/Soundness/#8971" class="Bound">all-n</a> <a id="8977" href="/Soundness/#8977" class="Bound">d</a> <a id="8979" class="Keyword">with</a> <a id="8984" href="/Compositional/#9430" class="Function">var-inv</a> <a id="8992" href="/Soundness/#8977" class="Bound">d</a>
<a id="8994" class="Symbol">...</a> <a id="8998" class="Symbol">|</a> <a id="9000" href="/Soundness/#9000" class="Bound">lt</a> <a id="9003" class="Symbol">=</a>  <a id="9006" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="9010" href="/Denotational/#9910" class="InductiveConstructor">var</a> <a id="9014" class="Symbol">(</a><a id="9015" href="/Denotational/#4765" class="InductiveConstructor">Trans⊑</a> <a id="9022" href="/Soundness/#9000" class="Bound">lt</a> <a id="9025" class="Symbol">(</a><a id="9026" class="Bound">all-n</a> <a id="9032" class="Bound">x</a><a id="9033" class="Symbol">))</a>
<a id="9036" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9051" class="Symbol">{</a><a id="9052" href="/Soundness/#9052" class="Bound">Γ</a><a id="9053" class="Symbol">}{</a><a id="9055" href="/Soundness/#9055" class="Bound">Δ</a><a id="9056" class="Symbol">}{</a><a id="9058" href="/Soundness/#9058" class="Bound">v₁</a> <a id="9061" href="/Denotational/#4129" class="InductiveConstructor Operator">↦</a> <a id="9063" href="/Soundness/#9063" class="Bound">v₂</a><a id="9065" class="Symbol">}{</a><a id="9067" href="/Soundness/#9067" class="Bound">γ</a><a id="9068" class="Symbol">}{</a><a id="9070" href="/Soundness/#9070" class="Bound">δ</a><a id="9071" class="Symbol">}{</a><a id="9073" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9075" href="/Soundness/#9075" class="Bound">M&#39;</a><a id="9077" class="Symbol">}{</a><a id="9079" href="/Soundness/#9079" class="Bound">ρ</a><a id="9080" class="Symbol">}</a> <a id="9082" href="/Soundness/#9082" class="Bound">all-n</a> <a id="9088" class="Symbol">(</a><a id="9089" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="9097" href="/Soundness/#9097" class="Bound">d</a><a id="9098" class="Symbol">)</a> <a id="9100" class="Symbol">=</a>
   <a id="9105" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="9113" class="Symbol">(</a><a id="9114" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9129" class="Symbol">(</a><a id="9130" href="/Soundness/#8510" class="Function">nth-ext</a> <a id="9138" href="/Soundness/#9079" class="Bound">ρ</a> <a id="9140" href="/Soundness/#9082" class="Bound">all-n</a><a id="9145" class="Symbol">)</a> <a id="9147" href="/Soundness/#9097" class="Bound">d</a><a id="9148" class="Symbol">)</a>
<a id="9150" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9165" class="Symbol">{</a><a id="9166" class="Argument">M</a> <a id="9168" class="Symbol">=</a> <a id="9170" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9172" href="/Soundness/#9172" class="Bound">M&#39;</a><a id="9174" class="Symbol">}</a> <a id="9176" href="/Soundness/#9176" class="Bound">all-n</a> <a id="9182" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a> <a id="9190" class="Symbol">=</a> <a id="9192" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a>
<a id="9200" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9215" class="Symbol">{</a><a id="9216" class="Argument">M</a> <a id="9218" class="Symbol">=</a> <a id="9220" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9222" href="/Soundness/#9222" class="Bound">M&#39;</a><a id="9224" class="Symbol">}</a> <a id="9226" href="/Soundness/#9226" class="Bound">all-n</a> <a id="9232" class="Symbol">(</a><a id="9233" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="9241" href="/Soundness/#9241" class="Bound">d₁</a> <a id="9244" href="/Soundness/#9244" class="Bound">d₂</a><a id="9246" class="Symbol">)</a> <a id="9248" class="Symbol">=</a>
   <a id="9253" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="9261" class="Symbol">(</a><a id="9262" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9277" href="/Soundness/#9226" class="Bound">all-n</a> <a id="9283" href="/Soundness/#9241" class="Bound">d₁</a><a id="9285" class="Symbol">)</a> <a id="9287" class="Symbol">(</a><a id="9288" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9303" href="/Soundness/#9226" class="Bound">all-n</a> <a id="9309" href="/Soundness/#9244" class="Bound">d₂</a><a id="9311" class="Symbol">)</a>
<a id="9313" href="/Soundness/#8766" class="CatchallClause Function">rename-reflect</a><a id="9327" class="CatchallClause"> </a><a id="9328" class="CatchallClause Symbol">{</a><a id="9329" class="CatchallClause Argument">M</a><a id="9330" class="CatchallClause"> </a><a id="9331" class="CatchallClause Symbol">=</a><a id="9332" class="CatchallClause"> </a><a id="9333" href="/Untyped/#4238" class="CatchallClause InductiveConstructor Operator">ƛ</a><a id="9334" class="CatchallClause"> </a><a id="9335" href="/Soundness/#9335" class="CatchallClause Bound">M&#39;</a><a id="9337" class="CatchallClause Symbol">}</a><a id="9338" class="CatchallClause"> </a><a id="9339" href="/Soundness/#9339" class="CatchallClause Bound">all-n</a><a id="9344" class="CatchallClause"> </a><a id="9345" class="CatchallClause Symbol">(</a><a id="9346" href="/Denotational/#10462" class="CatchallClause InductiveConstructor">sub</a><a id="9349" class="CatchallClause"> </a><a id="9350" href="/Soundness/#9350" class="CatchallClause Bound">d₁</a><a id="9352" class="CatchallClause"> </a><a id="9353" href="/Soundness/#9353" class="CatchallClause Bound">lt</a><a id="9355" class="CatchallClause Symbol">)</a> <a id="9357" class="Symbol">=</a>   <a id="9361" class="Comment">-- [PLW: why is this line in gray?]</a>
   <a id="9400" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="9404" class="Symbol">(</a><a id="9405" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9420" href="/Soundness/#9339" class="Bound">all-n</a> <a id="9426" href="/Soundness/#9350" class="Bound">d₁</a><a id="9428" class="Symbol">)</a> <a id="9430" href="/Soundness/#9353" class="Bound">lt</a>
<a id="9433" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9448" class="Symbol">{</a><a id="9449" class="Argument">M</a> <a id="9451" class="Symbol">=</a> <a id="9453" href="/Soundness/#9453" class="Bound">M₁</a> <a id="9456" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9458" href="/Soundness/#9458" class="Bound">M₂</a><a id="9460" class="Symbol">}</a> <a id="9462" href="/Soundness/#9462" class="Bound">all-n</a> <a id="9468" class="Symbol">(</a><a id="9469" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="9476" href="/Soundness/#9476" class="Bound">d₁</a> <a id="9479" href="/Soundness/#9479" class="Bound">d₂</a><a id="9481" class="Symbol">)</a> <a id="9483" class="Symbol">=</a>
   <a id="9488" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="9495" class="Symbol">(</a><a id="9496" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9511" href="/Soundness/#9462" class="Bound">all-n</a> <a id="9517" href="/Soundness/#9476" class="Bound">d₁</a><a id="9519" class="Symbol">)</a> <a id="9521" class="Symbol">(</a><a id="9522" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9537" href="/Soundness/#9462" class="Bound">all-n</a> <a id="9543" href="/Soundness/#9479" class="Bound">d₂</a><a id="9545" class="Symbol">)</a> 
<a id="9548" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9563" class="Symbol">{</a><a id="9564" class="Argument">M</a> <a id="9566" class="Symbol">=</a> <a id="9568" href="/Soundness/#9568" class="Bound">M₁</a> <a id="9571" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9573" href="/Soundness/#9573" class="Bound">M₂</a><a id="9575" class="Symbol">}</a> <a id="9577" href="/Soundness/#9577" class="Bound">all-n</a> <a id="9583" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a> <a id="9591" class="Symbol">=</a> <a id="9593" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a>
<a id="9601" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9616" class="Symbol">{</a><a id="9617" class="Argument">M</a> <a id="9619" class="Symbol">=</a> <a id="9621" href="/Soundness/#9621" class="Bound">M₁</a> <a id="9624" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9626" href="/Soundness/#9626" class="Bound">M₂</a><a id="9628" class="Symbol">}</a> <a id="9630" href="/Soundness/#9630" class="Bound">all-n</a> <a id="9636" class="Symbol">(</a><a id="9637" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="9645" href="/Soundness/#9645" class="Bound">d₁</a> <a id="9648" href="/Soundness/#9648" class="Bound">d₂</a><a id="9650" class="Symbol">)</a> <a id="9652" class="Symbol">=</a>
   <a id="9657" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="9665" class="Symbol">(</a><a id="9666" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9681" href="/Soundness/#9630" class="Bound">all-n</a> <a id="9687" href="/Soundness/#9645" class="Bound">d₁</a><a id="9689" class="Symbol">)</a> <a id="9691" class="Symbol">(</a><a id="9692" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9707" href="/Soundness/#9630" class="Bound">all-n</a> <a id="9713" href="/Soundness/#9648" class="Bound">d₂</a><a id="9715" class="Symbol">)</a>
<a id="9717" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9732" class="Symbol">{</a><a id="9733" class="Argument">M</a> <a id="9735" class="Symbol">=</a> <a id="9737" href="/Soundness/#9737" class="Bound">M₁</a> <a id="9740" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9742" href="/Soundness/#9742" class="Bound">M₂</a><a id="9744" class="Symbol">}</a> <a id="9746" href="/Soundness/#9746" class="Bound">all-n</a> <a id="9752" class="Symbol">(</a><a id="9753" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="9757" href="/Soundness/#9757" class="Bound">d₁</a> <a id="9760" href="/Soundness/#9760" class="Bound">lt</a><a id="9762" class="Symbol">)</a> <a id="9764" class="Symbol">=</a>
   <a id="9769" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="9773" class="Symbol">(</a><a id="9774" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="9789" href="/Soundness/#9746" class="Bound">all-n</a> <a id="9795" href="/Soundness/#9757" class="Bound">d₁</a><a id="9797" class="Symbol">)</a> <a id="9799" href="/Soundness/#9760" class="Bound">lt</a></pre>

<p>We cannot prove this lemma by induction on the derivation of
δ ⊢ rename ρ M ↓ v, so instead we proceed by induction on M.</p>

<ul>
  <li>
    <p>If it is a variable, we apply the inversion lemma to obtain
that v ⊑ nth (ρ x) δ. Instantiating the premise to x we have
nth (ρ x) δ = nth x γ, so we conclude by the (var) rule.</p>
  </li>
  <li>
    <p>If it is a lambda abstraction ƛ M’, we have
rename ρ (ƛ M’) = ƛ (rename (ext ρ) M’).
We proceed by cases on δ ⊢ ƛ (rename (ext ρ) M’) ↓ v.</p>

    <ul>
      <li>
        <p>Rule (↦-intro): To satisfy the premise of the induction
hypothesis, we prove that the renaming can be extended to be a
mapping from γ , v₁ to δ , v₁.</p>
      </li>
      <li>
        <p>Rule (⊥-intro): We simply apply (⊥-intro).</p>
      </li>
      <li>
        <p>Rule (⊔-intro): We apply the induction hypotheses and (⊔-intro).</p>
      </li>
      <li>
        <p>Rule (sub): [PLW: this case is also in the code!]</p>
      </li>
    </ul>
  </li>
  <li>
    <p>If it is an application M₁ · M₂, we have
rename ρ (M₁ · M₂) = (rename ρ M₁) · (rename ρ M₂).
We proceed by cases on δ ⊢ (rename ρ M₁) · (rename ρ M₂) ↓ v
and all the cases are straightforward.</p>
  </li>
</ul>

<p>In the upcoming uses of rename-reflect, the renaming will always be
the increment function. So we prove a corollary for that special case.</p>

<pre class="Agda"><a id="rename-inc-reflect"></a><a id="10959" href="/Soundness/#10959" class="Function">rename-inc-reflect</a> <a id="10978" class="Symbol">:</a> <a id="10980" class="Symbol">∀</a> <a id="10982" class="Symbol">{</a><a id="10983" href="/Soundness/#10983" class="Bound">Γ</a> <a id="10985" href="/Soundness/#10985" class="Bound">v&#39;</a> <a id="10988" href="/Soundness/#10988" class="Bound">v</a><a id="10989" class="Symbol">}</a> <a id="10991" class="Symbol">{</a><a id="10992" href="/Soundness/#10992" class="Bound">γ</a> <a id="10994" class="Symbol">:</a> <a id="10996" href="/Denotational/#7331" class="Function">Env</a> <a id="11000" href="/Soundness/#10983" class="Bound">Γ</a><a id="11001" class="Symbol">}</a> <a id="11003" class="Symbol">{</a> <a id="11005" href="/Soundness/#11005" class="Bound">M</a> <a id="11007" class="Symbol">:</a> <a id="11009" href="/Soundness/#10983" class="Bound">Γ</a> <a id="11011" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="11013" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11014" class="Symbol">}</a>
  <a id="11018" class="Symbol">→</a> <a id="11020" class="Symbol">(</a><a id="11021" href="/Soundness/#10992" class="Bound">γ</a> <a id="11023" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="11026" href="/Soundness/#10985" class="Bound">v&#39;</a><a id="11028" class="Symbol">)</a> <a id="11030" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="11032" href="/Untyped/#6171" class="Function">rename</a> <a id="11039" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="11042" href="/Soundness/#11005" class="Bound">M</a> <a id="11044" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="11046" href="/Soundness/#10988" class="Bound">v</a>
    <a id="11052" class="Comment">----------------------------</a>
  <a id="11083" class="Symbol">→</a> <a id="11085" href="/Soundness/#10992" class="Bound">γ</a> <a id="11087" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="11089" href="/Soundness/#11005" class="Bound">M</a> <a id="11091" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="11093" href="/Soundness/#10988" class="Bound">v</a>
<a id="11095" href="/Soundness/#10959" class="Function">rename-inc-reflect</a> <a id="11114" href="/Soundness/#11114" class="Bound">d</a> <a id="11116" class="Symbol">=</a> <a id="11118" href="/Soundness/#8766" class="Function">rename-reflect</a> <a id="11133" href="/Denotational/#8860" class="Function">`Refl⊑</a> <a id="11140" href="/Soundness/#11114" class="Bound">d</a></pre>

<h3 id="substitution-reflects-denotations-the-variable-case">Substitution reflects denotations, the variable case</h3>

<p>We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if γ ⊢ (subst σ M) ↓ v, then γ ⊢ σ k ↓
nth k δ and δ ⊢ M ↓ v for any k and some δ.  We shall start with the
case in which M is a variable x.  So instead the premise is γ ⊢ σ x ↓
v and we need to show that δ ⊢ ` x ↓ v for some δ. The δ that we
choose shall be the environment that maps x to v and every other
variable to ⊥.</p>

<p>The nth element of the `⊥ environment is always ⊥.
[PLW: Probably can omit]</p>
<pre class="Agda"><a id="nth-`⊥"></a><a id="11725" href="/Soundness/#11725" class="Function">nth-`⊥</a> <a id="11732" class="Symbol">:</a> <a id="11734" class="Symbol">∀{</a><a id="11736" href="/Soundness/#11736" class="Bound">Γ</a><a id="11737" class="Symbol">}</a> <a id="11739" class="Symbol">{</a><a id="11740" href="/Soundness/#11740" class="Bound">x</a> <a id="11742" class="Symbol">:</a> <a id="11744" href="/Soundness/#11736" class="Bound">Γ</a> <a id="11746" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="11748" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11749" class="Symbol">}</a> <a id="11751" class="Symbol">→</a> <a id="11753" href="/Denotational/#8561" class="Function">`⊥</a> <a id="11756" href="/Soundness/#11740" class="Bound">x</a> <a id="11758" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="11760" href="/Denotational/#4117" class="InductiveConstructor">⊥</a>
<a id="11762" href="/Soundness/#11725" class="Function">nth-`⊥</a> <a id="11769" class="Symbol">{</a><a id="11770" class="Argument">x</a> <a id="11772" class="Symbol">=</a> <a id="11774" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="11775" class="Symbol">}</a> <a id="11777" class="Symbol">=</a> <a id="11779" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="11784" href="/Soundness/#11725" class="Function">nth-`⊥</a> <a id="11791" class="Symbol">{</a><a id="11792" href="/Soundness/#11792" class="Bound">Γ</a> <a id="11794" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="11796" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11797" class="Symbol">}</a> <a id="11799" class="Symbol">{</a><a id="11800" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="11802" href="/Soundness/#11802" class="Bound">x</a><a id="11803" class="Symbol">}</a> <a id="11805" class="Symbol">=</a> <a id="11807" href="/Soundness/#11725" class="Function">nth-`⊥</a> <a id="11814" class="Symbol">{</a><a id="11815" href="/Soundness/#11792" class="Bound">Γ</a><a id="11816" class="Symbol">}</a> <a id="11818" class="Symbol">{</a><a id="11819" href="/Soundness/#11802" class="Bound">x</a><a id="11820" class="Symbol">}</a></pre>

<p>Next we define the environment that maps x to v and every other
variable to ⊥, that is (const-env x v).</p>

<pre class="Agda"><a id="11952" class="Comment">{-
inv-S : ∀ {Γ A B} {x y : Γ ∋ A}
  → _≡_ {_} {Γ , B ∋ A} (S x) (S y)
  → S x ≡ S y
    -------------------------------
  → x ≡ y
inv-S refl = refl
-}</a>

<a id="_var≟_"></a><a id="12105" href="/Soundness/#12105" class="Function Operator">_var≟_</a> <a id="12112" class="Symbol">:</a> <a id="12114" class="Symbol">∀</a> <a id="12116" class="Symbol">{</a><a id="12117" href="/Soundness/#12117" class="Bound">Γ</a><a id="12118" class="Symbol">}</a> <a id="12120" class="Symbol">→</a> <a id="12122" class="Symbol">(</a><a id="12123" href="/Soundness/#12123" class="Bound">x</a> <a id="12125" href="/Soundness/#12125" class="Bound">y</a> <a id="12127" class="Symbol">:</a> <a id="12129" href="/Soundness/#12117" class="Bound">Γ</a> <a id="12131" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12133" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12134" class="Symbol">)</a> <a id="12136" class="Symbol">→</a> <a id="12138" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#534" class="Datatype">Dec</a> <a id="12142" class="Symbol">(</a><a id="12143" href="/Soundness/#12123" class="Bound">x</a> <a id="12145" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12147" href="/Soundness/#12125" class="Bound">y</a><a id="12148" class="Symbol">)</a>
<a id="12150" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12152" href="/Soundness/#12105" class="Function Operator">var≟</a> <a id="12157" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12160" class="Symbol">=</a>  <a id="12163" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12167" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12172" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12174" href="/Soundness/#12105" class="Function Operator">var≟</a> <a id="12179" class="Symbol">(</a><a id="12180" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12182" class="Symbol">_)</a>  <a id="12186" class="Symbol">=</a>  <a id="12189" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12192" class="Symbol">λ()</a>
<a id="12196" class="Symbol">(</a><a id="12197" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12199" class="Symbol">_)</a> <a id="12202" href="/Soundness/#12105" class="Function Operator">var≟</a> <a id="12207" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12210" class="Symbol">=</a>  <a id="12213" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12216" class="Symbol">λ()</a>
<a id="12220" class="Symbol">(</a><a id="12221" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12223" href="/Soundness/#12223" class="Bound">x</a><a id="12224" class="Symbol">)</a> <a id="12226" href="/Soundness/#12105" class="Function Operator">var≟</a> <a id="12231" class="Symbol">(</a><a id="12232" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12234" href="/Soundness/#12234" class="Bound">y</a><a id="12235" class="Symbol">)</a> <a id="12237" class="Keyword">with</a>  <a id="12243" href="/Soundness/#12223" class="Bound">x</a> <a id="12245" href="/Soundness/#12105" class="Function Operator">var≟</a> <a id="12250" href="/Soundness/#12234" class="Bound">y</a>
<a id="12252" class="Symbol">...</a>                 <a id="12272" class="Symbol">|</a>  <a id="12275" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12279" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12284" class="Symbol">=</a>  <a id="12287" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12291" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12296" class="Symbol">...</a>                 <a id="12316" class="Symbol">|</a>  <a id="12319" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12322" href="/Soundness/#12322" class="Bound">neq</a>   <a id="12328" class="Symbol">=</a>  <a id="12331" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12334" class="Symbol">λ{</a><a id="12336" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12341" class="Symbol">→</a> <a id="12343" href="/Soundness/#12322" class="Bound">neq</a> <a id="12347" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="12351" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12354" href="/Soundness/#12354" class="Function">var≟-refl</a> <a id="12364" class="Symbol">:</a> <a id="12366" class="Symbol">∀</a> <a id="12368" class="Symbol">{</a><a id="12369" href="/Soundness/#12369" class="Bound">Γ</a><a id="12370" class="Symbol">}</a> <a id="12372" class="Symbol">(</a><a id="12373" href="/Soundness/#12373" class="Bound">x</a> <a id="12375" class="Symbol">:</a> <a id="12377" href="/Soundness/#12369" class="Bound">Γ</a> <a id="12379" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12381" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12382" class="Symbol">)</a> <a id="12384" class="Symbol">→</a> <a id="12386" class="Symbol">(</a><a id="12387" href="/Soundness/#12373" class="Bound">x</a> <a id="12389" href="/Soundness/#12105" class="Function Operator">var≟</a> <a id="12394" href="/Soundness/#12373" class="Bound">x</a><a id="12395" class="Symbol">)</a> <a id="12397" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12399" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12403" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12408" href="/Soundness/#12354" class="Function">var≟-refl</a> <a id="12418" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12420" class="Symbol">=</a> <a id="12422" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12427" href="/Soundness/#12354" class="Function">var≟-refl</a> <a id="12437" class="Symbol">(</a><a id="12438" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12440" href="/Soundness/#12440" class="Bound">x</a><a id="12441" class="Symbol">)</a> <a id="12443" class="Keyword">rewrite</a> <a id="12451" href="/Soundness/#12354" class="Function">var≟-refl</a> <a id="12461" href="/Soundness/#12440" class="Bound">x</a> <a id="12463" class="Symbol">=</a> <a id="12465" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>

<a id="const-env"></a><a id="12471" href="/Soundness/#12471" class="Function">const-env</a> <a id="12481" class="Symbol">:</a> <a id="12483" class="Symbol">∀{</a><a id="12485" href="/Soundness/#12485" class="Bound">Γ</a><a id="12486" class="Symbol">}</a> <a id="12488" class="Symbol">→</a> <a id="12490" class="Symbol">(</a><a id="12491" href="/Soundness/#12491" class="Bound">x</a> <a id="12493" class="Symbol">:</a> <a id="12495" href="/Soundness/#12485" class="Bound">Γ</a> <a id="12497" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12499" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12500" class="Symbol">)</a> <a id="12502" class="Symbol">→</a> <a id="12504" href="/Denotational/#4097" class="Datatype">Value</a> <a id="12510" class="Symbol">→</a> <a id="12512" href="/Denotational/#7331" class="Function">Env</a> <a id="12516" href="/Soundness/#12485" class="Bound">Γ</a>
<a id="12518" href="/Soundness/#12471" class="Function">const-env</a> <a id="12528" href="/Soundness/#12528" class="Bound">x</a> <a id="12530" href="/Soundness/#12530" class="Bound">v</a> <a id="12532" href="/Soundness/#12532" class="Bound">y</a> <a id="12534" class="Keyword">with</a> <a id="12539" href="/Soundness/#12528" class="Bound">x</a> <a id="12541" href="/Soundness/#12105" class="Function Operator">var≟</a> <a id="12546" href="/Soundness/#12532" class="Bound">y</a>
<a id="12548" class="Symbol">...</a>             <a id="12564" class="Symbol">|</a> <a id="12566" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12570" class="Symbol">_</a>       <a id="12578" class="Symbol">=</a> <a id="12580" class="Bound">v</a>
<a id="12582" class="Symbol">...</a>             <a id="12598" class="Symbol">|</a> <a id="12600" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12603" class="Symbol">_</a>        <a id="12612" class="Symbol">=</a> <a id="12614" href="/Denotational/#4117" class="InductiveConstructor">⊥</a></pre>

<p>Of course, the nth element of (const-env n v) is the value v.</p>

<pre class="Agda"><a id="nth-const-env"></a><a id="12704" href="/Soundness/#12704" class="Function">nth-const-env</a> <a id="12718" class="Symbol">:</a> <a id="12720" class="Symbol">∀{</a><a id="12722" href="/Soundness/#12722" class="Bound">Γ</a><a id="12723" class="Symbol">}</a> <a id="12725" class="Symbol">{</a><a id="12726" href="/Soundness/#12726" class="Bound">x</a> <a id="12728" class="Symbol">:</a> <a id="12730" href="/Soundness/#12722" class="Bound">Γ</a> <a id="12732" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12734" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12735" class="Symbol">}</a> <a id="12737" class="Symbol">{</a><a id="12738" href="/Soundness/#12738" class="Bound">v</a><a id="12739" class="Symbol">}</a> <a id="12741" class="Symbol">→</a> <a id="12743" class="Symbol">(</a><a id="12744" href="/Soundness/#12471" class="Function">const-env</a> <a id="12754" href="/Soundness/#12726" class="Bound">x</a> <a id="12756" href="/Soundness/#12738" class="Bound">v</a><a id="12757" class="Symbol">)</a> <a id="12759" href="/Soundness/#12726" class="Bound">x</a> <a id="12761" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12763" href="/Soundness/#12738" class="Bound">v</a>
<a id="12765" href="/Soundness/#12704" class="Function">nth-const-env</a> <a id="12779" class="Symbol">{</a><a id="12780" class="Argument">x</a> <a id="12782" class="Symbol">=</a> <a id="12784" href="/Soundness/#12784" class="Bound">x</a><a id="12785" class="Symbol">}</a> <a id="12787" class="Keyword">rewrite</a> <a id="12795" href="/Soundness/#12354" class="Function">var≟-refl</a> <a id="12805" href="/Soundness/#12784" class="Bound">x</a> <a id="12807" class="Symbol">=</a> <a id="12809" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>The nth element of (const-env n’ v) is the value ⊥, so long as n ≢ n’.</p>

<pre class="Agda"><a id="diff-nth-const-env"></a><a id="12911" href="/Soundness/#12911" class="Function">diff-nth-const-env</a> <a id="12930" class="Symbol">:</a> <a id="12932" class="Symbol">∀{</a><a id="12934" href="/Soundness/#12934" class="Bound">Γ</a><a id="12935" class="Symbol">}</a> <a id="12937" class="Symbol">{</a><a id="12938" href="/Soundness/#12938" class="Bound">x</a> <a id="12940" href="/Soundness/#12940" class="Bound">y</a> <a id="12942" class="Symbol">:</a> <a id="12944" href="/Soundness/#12934" class="Bound">Γ</a> <a id="12946" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12948" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12949" class="Symbol">}</a> <a id="12951" class="Symbol">{</a><a id="12952" href="/Soundness/#12952" class="Bound">v</a><a id="12953" class="Symbol">}</a>
  <a id="12957" class="Symbol">→</a> <a id="12959" href="/Soundness/#12938" class="Bound">x</a> <a id="12961" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">≢</a> <a id="12963" href="/Soundness/#12940" class="Bound">y</a>
    <a id="12969" class="Comment">-------------------</a>
  <a id="12991" class="Symbol">→</a> <a id="12993" href="/Soundness/#12471" class="Function">const-env</a> <a id="13003" href="/Soundness/#12938" class="Bound">x</a> <a id="13005" href="/Soundness/#12952" class="Bound">v</a> <a id="13007" href="/Soundness/#12940" class="Bound">y</a> <a id="13009" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13011" href="/Denotational/#4117" class="InductiveConstructor">⊥</a>
<a id="13013" href="/Soundness/#12911" class="Function">diff-nth-const-env</a> <a id="13032" class="Symbol">{</a><a id="13033" href="/Soundness/#13033" class="Bound">Γ</a><a id="13034" class="Symbol">}</a> <a id="13036" class="Symbol">{</a><a id="13037" href="/Soundness/#13037" class="Bound">x</a><a id="13038" class="Symbol">}</a> <a id="13040" class="Symbol">{</a><a id="13041" href="/Soundness/#13041" class="Bound">y</a><a id="13042" class="Symbol">}</a> <a id="13044" href="/Soundness/#13044" class="Bound">neq</a> <a id="13048" class="Keyword">with</a> <a id="13053" href="/Soundness/#13037" class="Bound">x</a> <a id="13055" href="/Soundness/#12105" class="Function Operator">var≟</a> <a id="13060" href="/Soundness/#13041" class="Bound">y</a>
<a id="13062" class="Symbol">...</a>  <a id="13067" class="Symbol">|</a> <a id="13069" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="13073" href="/Soundness/#13073" class="Bound">eq</a>  <a id="13077" class="Symbol">=</a>  <a id="13080" href="https://agda.github.io/agda-stdlib/Data.Empty.html#360" class="Function">⊥-elim</a> <a id="13087" class="Symbol">(</a><a id="13088" class="Bound">neq</a> <a id="13092" href="/Soundness/#13073" class="Bound">eq</a><a id="13094" class="Symbol">)</a>
<a id="13096" class="Symbol">...</a>  <a id="13101" class="Symbol">|</a> <a id="13103" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="13106" class="Symbol">_</a>    <a id="13111" class="Symbol">=</a>  <a id="13114" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>So we choose (const-env x v) for δ and obtain δ ⊢ ` x ↓ v
with the (var) rule.</p>

<p>It remains to prove that γ `⊢ σ ↓ δ and δ ⊢ M ↓ v for any k, given that
we have chosen (const-env x v) for δ .  We shall have two cases to
consider, x ≡ y or x ≢ y.</p>

<p>Now to finish the two cases of the proof.</p>

<ul>
  <li>In the case where x ≡ y, we need to show
that γ ⊢ σ y ↓ v, but that’s just our premise.</li>
  <li>In the case where x ≢ y, we need to show
that γ ⊢ σ y ↓ ⊥, which we do via rule (⊥-intro).</li>
</ul>

<p>Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.</p>

<pre class="Agda"><a id="subst-reflect-var"></a><a id="13766" href="/Soundness/#13766" class="Function">subst-reflect-var</a> <a id="13784" class="Symbol">:</a> <a id="13786" class="Symbol">∀</a> <a id="13788" class="Symbol">{</a><a id="13789" href="/Soundness/#13789" class="Bound">Γ</a> <a id="13791" href="/Soundness/#13791" class="Bound">Δ</a><a id="13792" class="Symbol">}</a> <a id="13794" class="Symbol">{</a><a id="13795" href="/Soundness/#13795" class="Bound">γ</a> <a id="13797" class="Symbol">:</a> <a id="13799" href="/Denotational/#7331" class="Function">Env</a> <a id="13803" href="/Soundness/#13791" class="Bound">Δ</a><a id="13804" class="Symbol">}</a> <a id="13806" class="Symbol">{</a><a id="13807" href="/Soundness/#13807" class="Bound">x</a> <a id="13809" class="Symbol">:</a> <a id="13811" href="/Soundness/#13789" class="Bound">Γ</a> <a id="13813" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="13815" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="13816" class="Symbol">}</a> <a id="13818" class="Symbol">{</a><a id="13819" href="/Soundness/#13819" class="Bound">v</a><a id="13820" class="Symbol">}</a> <a id="13822" class="Symbol">{</a><a id="13823" href="/Soundness/#13823" class="Bound">σ</a> <a id="13825" class="Symbol">:</a> <a id="13827" href="/Soundness/#2446" class="Function">Subst</a> <a id="13833" href="/Soundness/#13789" class="Bound">Γ</a> <a id="13835" href="/Soundness/#13791" class="Bound">Δ</a><a id="13836" class="Symbol">}</a>
  <a id="13840" class="Symbol">→</a> <a id="13842" href="/Soundness/#13795" class="Bound">γ</a> <a id="13844" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="13846" href="/Soundness/#13823" class="Bound">σ</a> <a id="13848" href="/Soundness/#13807" class="Bound">x</a> <a id="13850" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="13852" href="/Soundness/#13819" class="Bound">v</a>
    <a id="13858" class="Comment">----------------------------------------</a>
  <a id="13901" class="Symbol">→</a> <a id="13903" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="13906" href="/Soundness/#13906" class="Bound">δ</a> <a id="13908" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="13910" href="/Denotational/#7331" class="Function">Env</a> <a id="13914" href="/Soundness/#13789" class="Bound">Γ</a> <a id="13916" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="13918" href="/Soundness/#13795" class="Bound">γ</a> <a id="13920" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="13923" href="/Soundness/#13823" class="Bound">σ</a> <a id="13925" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="13927" href="/Soundness/#13906" class="Bound">δ</a>  <a id="13930" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="13933" href="/Soundness/#13906" class="Bound">δ</a> <a id="13935" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="13937" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="13939" href="/Soundness/#13807" class="Bound">x</a> <a id="13941" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="13943" href="/Soundness/#13819" class="Bound">v</a>
<a id="13945" href="/Soundness/#13766" class="Function">subst-reflect-var</a> <a id="13963" class="Symbol">{</a><a id="13964" href="/Soundness/#13964" class="Bound">Γ</a><a id="13965" class="Symbol">}{</a><a id="13967" href="/Soundness/#13967" class="Bound">Δ</a><a id="13968" class="Symbol">}{</a><a id="13970" href="/Soundness/#13970" class="Bound">γ</a><a id="13971" class="Symbol">}{</a><a id="13973" href="/Soundness/#13973" class="Bound">x</a><a id="13974" class="Symbol">}{</a><a id="13976" href="/Soundness/#13976" class="Bound">v</a><a id="13977" class="Symbol">}{</a><a id="13979" href="/Soundness/#13979" class="Bound">σ</a><a id="13980" class="Symbol">}</a> <a id="13982" href="/Soundness/#13982" class="Bound">xv</a>
  <a id="13987" class="Keyword">rewrite</a> <a id="13995" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="13999" class="Symbol">(</a><a id="14000" href="/Soundness/#12704" class="Function">nth-const-env</a> <a id="14014" class="Symbol">{</a><a id="14015" href="/Soundness/#13964" class="Bound">Γ</a><a id="14016" class="Symbol">}{</a><a id="14018" href="/Soundness/#13973" class="Bound">x</a><a id="14019" class="Symbol">}{</a><a id="14021" href="/Soundness/#13976" class="Bound">v</a><a id="14022" class="Symbol">})</a> <a id="14025" class="Symbol">=</a>
    <a id="14031" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14033" href="/Soundness/#12471" class="Function">const-env</a> <a id="14043" href="/Soundness/#13973" class="Bound">x</a> <a id="14045" href="/Soundness/#13976" class="Bound">v</a> <a id="14047" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14049" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14051" href="/Soundness/#14084" class="Function">const-env-ok</a> <a id="14064" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14066" href="/Denotational/#9910" class="InductiveConstructor">var</a> <a id="14070" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="14072" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
  <a id="14076" class="Keyword">where</a>
  <a id="14084" href="/Soundness/#14084" class="Function">const-env-ok</a> <a id="14097" class="Symbol">:</a> <a id="14099" href="/Soundness/#13970" class="Bound">γ</a> <a id="14101" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="14104" href="/Soundness/#13979" class="Bound">σ</a> <a id="14106" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="14108" href="/Soundness/#12471" class="Function">const-env</a> <a id="14118" href="/Soundness/#13973" class="Bound">x</a> <a id="14120" href="/Soundness/#13976" class="Bound">v</a>
  <a id="14124" href="/Soundness/#14084" class="Function">const-env-ok</a> <a id="14137" href="/Soundness/#14137" class="Bound">y</a> <a id="14139" class="Keyword">with</a> <a id="14144" href="/Soundness/#13973" class="Bound">x</a> <a id="14146" href="/Soundness/#12105" class="Function Operator">var≟</a> <a id="14151" href="/Soundness/#14137" class="Bound">y</a>
  <a id="14155" class="Symbol">...</a> <a id="14159" class="Symbol">|</a> <a id="14161" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="14165" href="/Soundness/#14165" class="Bound">x≡y</a> <a id="14169" class="Keyword">rewrite</a> <a id="14177" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14181" href="/Soundness/#14165" class="Bound">x≡y</a> <a id="14185" class="Symbol">|</a> <a id="14187" href="/Soundness/#12704" class="Function">nth-const-env</a> <a id="14201" class="Symbol">{</a><a id="14202" href="/Soundness/#13964" class="Bound">Γ</a><a id="14203" class="Symbol">}{</a><a id="14205" href="/Soundness/#13973" class="Bound">x</a><a id="14206" class="Symbol">}{</a><a id="14208" href="/Soundness/#13976" class="Bound">v</a><a id="14209" class="Symbol">}</a> <a id="14211" class="Symbol">=</a> <a id="14213" href="/Soundness/#13982" class="Bound">xv</a>
  <a id="14218" class="Symbol">...</a> <a id="14222" class="Symbol">|</a> <a id="14224" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="14227" href="/Soundness/#14227" class="Bound">x≢y</a> <a id="14231" class="Keyword">rewrite</a> <a id="14239" href="/Soundness/#12911" class="Function">diff-nth-const-env</a> <a id="14258" class="Symbol">{</a><a id="14259" href="/Soundness/#13964" class="Bound">Γ</a><a id="14260" class="Symbol">}{</a><a id="14262" href="/Soundness/#13973" class="Bound">x</a><a id="14263" class="Symbol">}{</a><a id="14265" class="Bound">y</a><a id="14266" class="Symbol">}{</a><a id="14268" href="/Soundness/#13976" class="Bound">v</a><a id="14269" class="Symbol">}</a> <a id="14271" href="/Soundness/#14227" class="Bound">x≢y</a> <a id="14275" class="Symbol">=</a> <a id="14277" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a></pre>

<h3 id="substitutions-and-environment-construction">Substitutions and environment construction</h3>

<p>Every substitution produces terms that can evaluate to ⊥.</p>

<pre class="Agda"><a id="subst-⊥"></a><a id="14418" href="/Soundness/#14418" class="Function">subst-⊥</a> <a id="14426" class="Symbol">:</a> <a id="14428" class="Symbol">∀{</a><a id="14430" href="/Soundness/#14430" class="Bound">Γ</a> <a id="14432" href="/Soundness/#14432" class="Bound">Δ</a><a id="14433" class="Symbol">}{</a><a id="14435" href="/Soundness/#14435" class="Bound">γ</a> <a id="14437" class="Symbol">:</a> <a id="14439" href="/Denotational/#7331" class="Function">Env</a> <a id="14443" href="/Soundness/#14432" class="Bound">Δ</a><a id="14444" class="Symbol">}{</a><a id="14446" href="/Soundness/#14446" class="Bound">σ</a> <a id="14448" class="Symbol">:</a> <a id="14450" href="/Soundness/#2446" class="Function">Subst</a> <a id="14456" href="/Soundness/#14430" class="Bound">Γ</a> <a id="14458" href="/Soundness/#14432" class="Bound">Δ</a><a id="14459" class="Symbol">}</a>
    <a id="14465" class="Comment">-----------------</a>
  <a id="14485" class="Symbol">→</a> <a id="14487" href="/Soundness/#14435" class="Bound">γ</a> <a id="14489" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="14492" href="/Soundness/#14446" class="Bound">σ</a> <a id="14494" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="14496" href="/Denotational/#8561" class="Function">`⊥</a>
<a id="14499" href="/Soundness/#14418" class="Function">subst-⊥</a> <a id="14507" href="/Soundness/#14507" class="Bound">x</a> <a id="14509" class="Symbol">=</a> <a id="14511" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a></pre>

<p>If a substitution produces terms that evaluate to the values in
both γ₁ and γ₂, then those terms also evaluate to the values in 
γ₁ `⊔ γ₂.</p>

<pre class="Agda"><a id="subst-⊔"></a><a id="14684" href="/Soundness/#14684" class="Function">subst-⊔</a> <a id="14692" class="Symbol">:</a> <a id="14694" class="Symbol">∀{</a><a id="14696" href="/Soundness/#14696" class="Bound">Γ</a> <a id="14698" href="/Soundness/#14698" class="Bound">Δ</a><a id="14699" class="Symbol">}{</a><a id="14701" href="/Soundness/#14701" class="Bound">γ</a> <a id="14703" class="Symbol">:</a> <a id="14705" href="/Denotational/#7331" class="Function">Env</a> <a id="14709" href="/Soundness/#14698" class="Bound">Δ</a><a id="14710" class="Symbol">}{</a><a id="14712" href="/Soundness/#14712" class="Bound">γ₁</a> <a id="14715" href="/Soundness/#14715" class="Bound">γ₂</a> <a id="14718" class="Symbol">:</a> <a id="14720" href="/Denotational/#7331" class="Function">Env</a> <a id="14724" href="/Soundness/#14696" class="Bound">Γ</a><a id="14725" class="Symbol">}{</a><a id="14727" href="/Soundness/#14727" class="Bound">σ</a> <a id="14729" class="Symbol">:</a> <a id="14731" href="/Soundness/#2446" class="Function">Subst</a> <a id="14737" href="/Soundness/#14696" class="Bound">Γ</a> <a id="14739" href="/Soundness/#14698" class="Bound">Δ</a><a id="14740" class="Symbol">}</a>
           <a id="14753" class="Symbol">→</a> <a id="14755" href="/Soundness/#14701" class="Bound">γ</a> <a id="14757" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="14760" href="/Soundness/#14727" class="Bound">σ</a> <a id="14762" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="14764" href="/Soundness/#14712" class="Bound">γ₁</a>
           <a id="14778" class="Symbol">→</a> <a id="14780" href="/Soundness/#14701" class="Bound">γ</a> <a id="14782" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="14785" href="/Soundness/#14727" class="Bound">σ</a> <a id="14787" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="14789" href="/Soundness/#14715" class="Bound">γ₂</a>
             <a id="14805" class="Comment">-------------------------</a>
           <a id="14842" class="Symbol">→</a> <a id="14844" href="/Soundness/#14701" class="Bound">γ</a> <a id="14846" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="14849" href="/Soundness/#14727" class="Bound">σ</a> <a id="14851" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="14853" class="Symbol">(</a><a id="14854" href="/Soundness/#14712" class="Bound">γ₁</a> <a id="14857" href="/Denotational/#8590" class="Function Operator">`⊔</a> <a id="14860" href="/Soundness/#14715" class="Bound">γ₂</a><a id="14862" class="Symbol">)</a>
<a id="14864" href="/Soundness/#14684" class="Function">subst-⊔</a> <a id="14872" href="/Soundness/#14872" class="Bound">γ₁-ok</a> <a id="14878" href="/Soundness/#14878" class="Bound">γ₂-ok</a> <a id="14884" href="/Soundness/#14884" class="Bound">x</a> <a id="14886" class="Symbol">=</a> <a id="14888" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="14896" class="Symbol">(</a><a id="14897" href="/Soundness/#14872" class="Bound">γ₁-ok</a> <a id="14903" href="/Soundness/#14884" class="Bound">x</a><a id="14904" class="Symbol">)</a> <a id="14906" class="Symbol">(</a><a id="14907" href="/Soundness/#14878" class="Bound">γ₂-ok</a> <a id="14913" href="/Soundness/#14884" class="Bound">x</a><a id="14914" class="Symbol">)</a></pre>

<h3 id="the-lambda-constructor-is-injective">The Lambda constructor is injective</h3>

<pre class="Agda"><a id="lambda-inj"></a><a id="14982" href="/Soundness/#14982" class="Function">lambda-inj</a> <a id="14993" class="Symbol">:</a> <a id="14995" class="Symbol">∀</a> <a id="14997" class="Symbol">{</a><a id="14998" href="/Soundness/#14998" class="Bound">Γ</a><a id="14999" class="Symbol">}</a> <a id="15001" class="Symbol">{</a><a id="15002" href="/Soundness/#15002" class="Bound">M</a> <a id="15004" href="/Soundness/#15004" class="Bound">N</a> <a id="15006" class="Symbol">:</a> <a id="15008" href="/Soundness/#14998" class="Bound">Γ</a> <a id="15010" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15012" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15014" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15016" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15018" class="Symbol">}</a>
  <a id="15022" class="Symbol">→</a> <a id="15024" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a> <a id="15028" class="Symbol">{</a><a id="15029" class="Argument">A</a> <a id="15031" class="Symbol">=</a> <a id="15033" href="/Soundness/#14998" class="Bound">Γ</a> <a id="15035" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15037" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15038" class="Symbol">}</a> <a id="15040" class="Symbol">(</a><a id="15041" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15043" href="/Soundness/#15002" class="Bound">M</a><a id="15044" class="Symbol">)</a> <a id="15046" class="Symbol">(</a><a id="15047" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15049" href="/Soundness/#15004" class="Bound">N</a><a id="15050" class="Symbol">)</a>
    <a id="15056" class="Comment">---------------------------</a>
  <a id="15086" class="Symbol">→</a> <a id="15088" href="/Soundness/#15002" class="Bound">M</a> <a id="15090" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="15092" href="/Soundness/#15004" class="Bound">N</a>
<a id="15094" href="/Soundness/#14982" class="Function">lambda-inj</a> <a id="15105" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="15110" class="Symbol">=</a> <a id="15112" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<h3 id="simultaneous-substitution-reflects-denotations">Simultaneous substitution reflects denotations</h3>

<p>In this section we prove a central lemma, that
substitution reflects denotations. That is, if γ ⊢ subst σ M ↓ v, then
δ ⊢ M ↓ v and γ `⊢ σ ↓ δ for some δ. We shall proceed by induction on
the derivation of γ ⊢ subst σ M ↓ v. This requires a minor
restatement of the lemma, changing the premise to γ ⊢ L ↓ v and
L ≡ subst σ M.</p>

<pre class="Agda"><a id="split"></a><a id="15521" href="/Soundness/#15521" class="Function">split</a> <a id="15527" class="Symbol">:</a> <a id="15529" class="Symbol">∀</a> <a id="15531" class="Symbol">{</a><a id="15532" href="/Soundness/#15532" class="Bound">Γ</a><a id="15533" class="Symbol">}</a> <a id="15535" class="Symbol">{</a><a id="15536" href="/Soundness/#15536" class="Bound">M</a> <a id="15538" class="Symbol">:</a> <a id="15540" href="/Soundness/#15532" class="Bound">Γ</a> <a id="15542" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15544" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15546" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15548" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15549" class="Symbol">}</a> <a id="15551" class="Symbol">{</a><a id="15552" href="/Soundness/#15552" class="Bound">δ</a> <a id="15554" class="Symbol">:</a> <a id="15556" href="/Denotational/#7331" class="Function">Env</a> <a id="15560" class="Symbol">(</a><a id="15561" href="/Soundness/#15532" class="Bound">Γ</a> <a id="15563" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15565" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15566" class="Symbol">)}</a> <a id="15569" class="Symbol">{</a><a id="15570" href="/Soundness/#15570" class="Bound">v</a><a id="15571" class="Symbol">}</a>
  <a id="15575" class="Symbol">→</a> <a id="15577" href="/Soundness/#15552" class="Bound">δ</a> <a id="15579" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="15581" href="/Soundness/#15536" class="Bound">M</a> <a id="15583" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="15585" href="/Soundness/#15570" class="Bound">v</a>
    <a id="15591" class="Comment">--------------------------</a>
  <a id="15620" class="Symbol">→</a> <a id="15622" class="Symbol">(</a><a id="15623" href="/Denotational/#7742" class="Function">init</a> <a id="15628" href="/Soundness/#15552" class="Bound">δ</a> <a id="15630" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="15633" href="/Denotational/#7797" class="Function">last</a> <a id="15638" href="/Soundness/#15552" class="Bound">δ</a><a id="15639" class="Symbol">)</a> <a id="15641" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="15643" href="/Soundness/#15536" class="Bound">M</a> <a id="15645" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="15647" href="/Soundness/#15570" class="Bound">v</a>
<a id="15649" href="/Soundness/#15521" class="Function">split</a> <a id="15655" class="Symbol">{</a><a id="15656" class="Argument">δ</a> <a id="15658" class="Symbol">=</a> <a id="15660" href="/Soundness/#15660" class="Bound">δ</a><a id="15661" class="Symbol">}</a> <a id="15663" href="/Soundness/#15663" class="Bound">δMv</a> <a id="15667" class="Keyword">rewrite</a> <a id="15675" href="/Denotational/#7846" class="Function">init-last</a> <a id="15685" href="/Soundness/#15660" class="Bound">δ</a> <a id="15687" class="Symbol">=</a> <a id="15689" href="/Soundness/#15663" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="15694" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="15708" class="Symbol">:</a> <a id="15710" class="Symbol">∀</a> <a id="15712" class="Symbol">{</a><a id="15713" href="/Soundness/#15713" class="Bound">Γ</a> <a id="15715" href="/Soundness/#15715" class="Bound">Δ</a><a id="15716" class="Symbol">}</a> <a id="15718" class="Symbol">{</a><a id="15719" href="/Soundness/#15719" class="Bound">δ</a> <a id="15721" class="Symbol">:</a> <a id="15723" href="/Denotational/#7331" class="Function">Env</a> <a id="15727" href="/Soundness/#15715" class="Bound">Δ</a><a id="15728" class="Symbol">}</a> <a id="15730" class="Symbol">{</a><a id="15731" href="/Soundness/#15731" class="Bound">M</a> <a id="15733" class="Symbol">:</a> <a id="15735" href="/Soundness/#15713" class="Bound">Γ</a> <a id="15737" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15739" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15740" class="Symbol">}</a> <a id="15742" class="Symbol">{</a><a id="15743" href="/Soundness/#15743" class="Bound">v</a><a id="15744" class="Symbol">}</a> <a id="15746" class="Symbol">{</a><a id="15747" href="/Soundness/#15747" class="Bound">L</a> <a id="15749" class="Symbol">:</a> <a id="15751" href="/Soundness/#15715" class="Bound">Δ</a> <a id="15753" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15755" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15756" class="Symbol">}</a> <a id="15758" class="Symbol">{</a><a id="15759" href="/Soundness/#15759" class="Bound">σ</a> <a id="15761" class="Symbol">:</a> <a id="15763" href="/Soundness/#2446" class="Function">Subst</a> <a id="15769" href="/Soundness/#15713" class="Bound">Γ</a> <a id="15771" href="/Soundness/#15715" class="Bound">Δ</a><a id="15772" class="Symbol">}</a>
  <a id="15776" class="Symbol">→</a> <a id="15778" href="/Soundness/#15719" class="Bound">δ</a> <a id="15780" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="15782" href="/Soundness/#15747" class="Bound">L</a> <a id="15784" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="15786" href="/Soundness/#15743" class="Bound">v</a>
  <a id="15790" class="Symbol">→</a> <a id="15792" href="/Untyped/#6931" class="Function">subst</a> <a id="15798" href="/Soundness/#15759" class="Bound">σ</a> <a id="15800" href="/Soundness/#15731" class="Bound">M</a> <a id="15802" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="15804" href="/Soundness/#15747" class="Bound">L</a>
    <a id="15810" class="Comment">---------------------------------------</a>
  <a id="15852" class="Symbol">→</a> <a id="15854" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="15857" href="/Soundness/#15857" class="Bound">γ</a> <a id="15859" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="15861" href="/Denotational/#7331" class="Function">Env</a> <a id="15865" href="/Soundness/#15713" class="Bound">Γ</a> <a id="15867" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="15869" href="/Soundness/#15719" class="Bound">δ</a> <a id="15871" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="15874" href="/Soundness/#15759" class="Bound">σ</a> <a id="15876" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="15878" href="/Soundness/#15857" class="Bound">γ</a>  <a id="15881" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="15884" href="/Soundness/#15857" class="Bound">γ</a> <a id="15886" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="15888" href="/Soundness/#15731" class="Bound">M</a> <a id="15890" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="15892" href="/Soundness/#15743" class="Bound">v</a>

<a id="15895" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="15909" class="Symbol">{</a><a id="15910" class="Argument">M</a> <a id="15912" class="Symbol">=</a> <a id="15914" href="/Soundness/#15914" class="Bound">M</a><a id="15915" class="Symbol">}{</a><a id="15917" class="Argument">σ</a> <a id="15919" class="Symbol">=</a> <a id="15921" href="/Soundness/#15921" class="Bound">σ</a><a id="15922" class="Symbol">}</a> <a id="15924" class="Symbol">(</a><a id="15925" href="/Denotational/#9910" class="InductiveConstructor">var</a> <a id="15929" class="Symbol">{</a><a id="15930" class="Argument">x</a> <a id="15932" class="Symbol">=</a> <a id="15934" href="/Soundness/#15934" class="Bound">y</a><a id="15935" class="Symbol">})</a> <a id="15938" href="/Soundness/#15938" class="Bound">eqL</a> <a id="15942" class="Keyword">with</a> <a id="15947" href="/Soundness/#15914" class="Bound">M</a> 
<a id="15950" class="Symbol">...</a> <a id="15954" class="Symbol">|</a> <a id="15956" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="15958" href="/Soundness/#15958" class="Bound">x</a>  <a id="15961" class="Keyword">with</a> <a id="15966" href="/Denotational/#9910" class="InductiveConstructor">var</a> <a id="15970" class="Symbol">{</a><a id="15971" class="Argument">x</a> <a id="15973" class="Symbol">=</a> <a id="15975" class="Bound">y</a><a id="15976" class="Symbol">}</a>
<a id="15978" class="Symbol">...</a>           <a id="15992" class="Symbol">|</a> <a id="15994" href="/Soundness/#15994" class="Bound">yv</a>  <a id="15998" class="Keyword">rewrite</a> <a id="16006" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16010" class="Bound">eqL</a> <a id="16014" class="Symbol">=</a> <a id="16016" href="/Soundness/#13766" class="Function">subst-reflect-var</a> <a id="16034" class="Symbol">{</a><a id="16035" class="Argument">σ</a> <a id="16037" class="Symbol">=</a> <a id="16039" class="Bound">σ</a><a id="16040" class="Symbol">}</a> <a id="16042" href="/Soundness/#15994" class="Bound">yv</a>
<a id="16045" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="16059" class="Symbol">{</a><a id="16060" class="Argument">M</a> <a id="16062" class="Symbol">=</a> <a id="16064" href="/Soundness/#16064" class="Bound">M</a><a id="16065" class="Symbol">}</a> <a id="16067" class="Symbol">(</a><a id="16068" href="/Denotational/#9910" class="InductiveConstructor">var</a> <a id="16072" class="Symbol">{</a><a id="16073" class="Argument">x</a> <a id="16075" class="Symbol">=</a> <a id="16077" href="/Soundness/#16077" class="Bound">y</a><a id="16078" class="Symbol">})</a> <a id="16081" class="Symbol">()</a> <a id="16084" class="Symbol">|</a> <a id="16086" href="/Soundness/#16086" class="Bound">M₁</a> <a id="16089" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16091" href="/Soundness/#16091" class="Bound">M₂</a>
<a id="16094" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="16108" class="Symbol">{</a><a id="16109" class="Argument">M</a> <a id="16111" class="Symbol">=</a> <a id="16113" href="/Soundness/#16113" class="Bound">M</a><a id="16114" class="Symbol">}</a> <a id="16116" class="Symbol">(</a><a id="16117" href="/Denotational/#9910" class="InductiveConstructor">var</a> <a id="16121" class="Symbol">{</a><a id="16122" class="Argument">x</a> <a id="16124" class="Symbol">=</a> <a id="16126" href="/Soundness/#16126" class="Bound">y</a><a id="16127" class="Symbol">})</a> <a id="16130" class="Symbol">()</a> <a id="16133" class="Symbol">|</a> <a id="16135" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16137" href="/Soundness/#16137" class="Bound">M&#39;</a>

<a id="16141" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="16155" class="Symbol">{</a><a id="16156" class="Argument">M</a> <a id="16158" class="Symbol">=</a> <a id="16160" href="/Soundness/#16160" class="Bound">M</a><a id="16161" class="Symbol">}{</a><a id="16163" class="Argument">σ</a> <a id="16165" class="Symbol">=</a> <a id="16167" href="/Soundness/#16167" class="Bound">σ</a><a id="16168" class="Symbol">}</a> <a id="16170" class="Symbol">(</a><a id="16171" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="16178" href="/Soundness/#16178" class="Bound">d₁</a> <a id="16181" href="/Soundness/#16181" class="Bound">d₂</a><a id="16183" class="Symbol">)</a> <a id="16185" href="/Soundness/#16185" class="Bound">eqL</a>
         <a id="16198" class="Keyword">with</a> <a id="16203" href="/Soundness/#16160" class="Bound">M</a> 
<a id="16206" class="Symbol">...</a>    <a id="16213" class="Symbol">|</a> <a id="16215" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16217" href="/Soundness/#16217" class="Bound">x</a> <a id="16219" class="Keyword">with</a> <a id="16224" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="16231" class="Bound">d₁</a> <a id="16234" class="Bound">d₂</a> 
<a id="16238" class="Symbol">...</a>    <a id="16245" class="Symbol">|</a> <a id="16247" href="/Soundness/#16247" class="Bound">d&#39;</a> <a id="16250" class="Keyword">rewrite</a> <a id="16258" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16262" class="Bound">eqL</a> <a id="16266" class="Symbol">=</a> <a id="16268" href="/Soundness/#13766" class="Function">subst-reflect-var</a> <a id="16286" class="Symbol">{</a><a id="16287" class="Argument">σ</a> <a id="16289" class="Symbol">=</a> <a id="16291" class="Bound">σ</a><a id="16292" class="Symbol">}</a> <a id="16294" href="/Soundness/#16247" class="Bound">d&#39;</a>
<a id="16297" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="16311" class="Symbol">(</a><a id="16312" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="16319" href="/Soundness/#16319" class="Bound">d₁</a> <a id="16322" href="/Soundness/#16322" class="Bound">d₂</a><a id="16324" class="Symbol">)</a> <a id="16326" class="Symbol">()</a> <a id="16329" class="Symbol">|</a> <a id="16331" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16333" href="/Soundness/#16333" class="Bound">M&#39;</a>
<a id="16336" href="/Soundness/#15694" class="Function">subst-reflect</a><a id="16349" class="Symbol">{</a><a id="16350" href="/Soundness/#16350" class="Bound">Γ</a><a id="16351" class="Symbol">}{</a><a id="16353" href="/Soundness/#16353" class="Bound">Δ</a><a id="16354" class="Symbol">}{</a><a id="16356" href="/Soundness/#16356" class="Bound">γ</a><a id="16357" class="Symbol">}{</a><a id="16359" class="Argument">σ</a> <a id="16361" class="Symbol">=</a> <a id="16363" href="/Soundness/#16363" class="Bound">σ</a><a id="16364" class="Symbol">}</a> <a id="16366" class="Symbol">(</a><a id="16367" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="16374" href="/Soundness/#16374" class="Bound">d₁</a> <a id="16377" href="/Soundness/#16377" class="Bound">d₂</a><a id="16379" class="Symbol">)</a>
   <a id="16384" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16389" class="Symbol">|</a> <a id="16391" href="/Soundness/#16391" class="Bound">M₁</a> <a id="16394" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16396" href="/Soundness/#16396" class="Bound">M₂</a>
     <a id="16404" class="Keyword">with</a> <a id="16409" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="16423" class="Symbol">{</a><a id="16424" class="Argument">M</a> <a id="16426" class="Symbol">=</a> <a id="16428" href="/Soundness/#16391" class="Bound">M₁</a><a id="16430" class="Symbol">}</a> <a id="16432" href="/Soundness/#16374" class="Bound">d₁</a> <a id="16435" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16440" class="Symbol">|</a> <a id="16442" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="16456" class="Symbol">{</a><a id="16457" class="Argument">M</a> <a id="16459" class="Symbol">=</a> <a id="16461" href="/Soundness/#16396" class="Bound">M₂</a><a id="16463" class="Symbol">}</a> <a id="16465" href="/Soundness/#16377" class="Bound">d₂</a> <a id="16468" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="16473" class="Symbol">...</a>     <a id="16481" class="Symbol">|</a> <a id="16483" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16485" href="/Soundness/#16485" class="Bound">δ₁</a> <a id="16488" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16490" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16492" href="/Soundness/#16492" class="Bound">subst-δ₁</a> <a id="16501" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16503" href="/Soundness/#16503" class="Bound">m1</a> <a id="16506" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16508" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16510" class="Symbol">|</a> <a id="16512" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16514" href="/Soundness/#16514" class="Bound">δ₂</a> <a id="16517" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16519" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16521" href="/Soundness/#16521" class="Bound">subst-δ₂</a> <a id="16530" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16532" href="/Soundness/#16532" class="Bound">m2</a> <a id="16535" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16537" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16539" class="Symbol">=</a>
     <a id="16546" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16548" href="/Soundness/#16485" class="Bound">δ₁</a> <a id="16551" href="/Denotational/#8590" class="Function Operator">`⊔</a> <a id="16554" href="/Soundness/#16514" class="Bound">δ₂</a> <a id="16557" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16559" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16561" href="/Soundness/#14684" class="Function">subst-⊔</a> <a id="16569" class="Symbol">{</a><a id="16570" class="Argument">γ₁</a> <a id="16573" class="Symbol">=</a> <a id="16575" href="/Soundness/#16485" class="Bound">δ₁</a><a id="16577" class="Symbol">}{</a><a id="16579" class="Argument">γ₂</a> <a id="16582" class="Symbol">=</a> <a id="16584" href="/Soundness/#16514" class="Bound">δ₂</a><a id="16586" class="Symbol">}{</a><a id="16588" class="Argument">σ</a> <a id="16590" class="Symbol">=</a> <a id="16592" class="Bound">σ</a><a id="16593" class="Symbol">}</a> <a id="16595" href="/Soundness/#16492" class="Bound">subst-δ₁</a> <a id="16604" href="/Soundness/#16521" class="Bound">subst-δ₂</a> <a id="16613" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="16635" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="16642" class="Symbol">(</a><a id="16643" href="/Denotational/#26207" class="Function">Env⊑</a> <a id="16648" href="/Soundness/#16503" class="Bound">m1</a> <a id="16651" class="Symbol">(</a><a id="16652" href="/Denotational/#8928" class="Function">EnvConjR1⊑</a> <a id="16663" href="/Soundness/#16485" class="Bound">δ₁</a> <a id="16666" href="/Soundness/#16514" class="Bound">δ₂</a><a id="16668" class="Symbol">))</a>
                           <a id="16698" class="Symbol">(</a><a id="16699" href="/Denotational/#26207" class="Function">Env⊑</a> <a id="16704" href="/Soundness/#16532" class="Bound">m2</a> <a id="16707" class="Symbol">(</a><a id="16708" href="/Denotational/#9025" class="Function">EnvConjR2⊑</a> <a id="16719" href="/Soundness/#16485" class="Bound">δ₁</a> <a id="16722" href="/Soundness/#16514" class="Bound">δ₂</a><a id="16724" class="Symbol">))</a> <a id="16727" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16729" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="16732" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="16746" class="Symbol">{</a><a id="16747" class="Argument">M</a> <a id="16749" class="Symbol">=</a> <a id="16751" href="/Soundness/#16751" class="Bound">M</a><a id="16752" class="Symbol">}{</a><a id="16754" class="Argument">σ</a> <a id="16756" class="Symbol">=</a> <a id="16758" href="/Soundness/#16758" class="Bound">σ</a><a id="16759" class="Symbol">}</a> <a id="16761" class="Symbol">(</a><a id="16762" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="16770" href="/Soundness/#16770" class="Bound">d</a><a id="16771" class="Symbol">)</a> <a id="16773" href="/Soundness/#16773" class="Bound">eqL</a> <a id="16777" class="Keyword">with</a> <a id="16782" href="/Soundness/#16751" class="Bound">M</a>
<a id="16784" class="Symbol">...</a>    <a id="16791" class="Symbol">|</a> <a id="16793" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16795" href="/Soundness/#16795" class="Bound">x</a> <a id="16797" class="Keyword">with</a> <a id="16802" class="Symbol">(</a><a id="16803" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="16811" class="Bound">d</a><a id="16812" class="Symbol">)</a>
<a id="16814" class="Symbol">...</a>             <a id="16830" class="Symbol">|</a> <a id="16832" href="/Soundness/#16832" class="Bound">d&#39;</a> <a id="16835" class="Keyword">rewrite</a> <a id="16843" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16847" class="Bound">eqL</a> <a id="16851" class="Symbol">=</a> <a id="16853" href="/Soundness/#13766" class="Function">subst-reflect-var</a> <a id="16871" class="Symbol">{</a><a id="16872" class="Argument">σ</a> <a id="16874" class="Symbol">=</a> <a id="16876" class="Bound">σ</a><a id="16877" class="Symbol">}</a> <a id="16879" href="/Soundness/#16832" class="Bound">d&#39;</a>
<a id="16882" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="16896" class="Symbol">{</a><a id="16897" class="Argument">σ</a> <a id="16899" class="Symbol">=</a> <a id="16901" href="/Soundness/#16901" class="Bound">σ</a><a id="16902" class="Symbol">}</a> <a id="16904" class="Symbol">(</a><a id="16905" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="16913" href="/Soundness/#16913" class="Bound">d</a><a id="16914" class="Symbol">)</a> <a id="16916" href="/Soundness/#16916" class="Bound">eq</a> <a id="16919" class="Symbol">|</a> <a id="16921" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16923" href="/Soundness/#16923" class="Bound">M&#39;</a>
      <a id="16932" class="Keyword">with</a> <a id="16937" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="16951" class="Symbol">{</a><a id="16952" class="Argument">σ</a> <a id="16954" class="Symbol">=</a> <a id="16956" href="/Untyped/#6623" class="Function">exts</a> <a id="16961" href="/Soundness/#16901" class="Bound">σ</a><a id="16962" class="Symbol">}</a> <a id="16964" href="/Soundness/#16913" class="Bound">d</a> <a id="16966" class="Symbol">(</a><a id="16967" href="/Soundness/#14982" class="Function">lambda-inj</a> <a id="16978" href="/Soundness/#16916" class="Bound">eq</a><a id="16980" class="Symbol">)</a>
<a id="16982" class="Symbol">...</a> <a id="16986" class="Symbol">|</a> <a id="16988" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16990" href="/Soundness/#16990" class="Bound">δ′</a> <a id="16993" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16995" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16997" href="/Soundness/#16997" class="Bound">exts-σ-δ′</a> <a id="17007" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17009" href="/Soundness/#17009" class="Bound">m′</a> <a id="17012" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17014" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17016" class="Symbol">=</a> 
    <a id="17023" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17025" href="/Denotational/#7742" class="Function">init</a> <a id="17030" href="/Soundness/#16990" class="Bound">δ′</a> <a id="17033" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17035" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17037" class="Symbol">((λ</a> <a id="17041" href="/Soundness/#17041" class="Bound">x</a> <a id="17043" class="Symbol">→</a> <a id="17045" href="/Soundness/#10959" class="Function">rename-inc-reflect</a> <a id="17064" class="Symbol">(</a><a id="17065" href="/Soundness/#16997" class="Bound">exts-σ-δ′</a> <a id="17075" class="Symbol">(</a><a id="17076" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="17078" href="/Soundness/#17041" class="Bound">x</a><a id="17079" class="Symbol">))))</a> <a id="17084" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
             <a id="17099" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="17107" class="Symbol">(</a><a id="17108" href="/Denotational/#26641" class="Function">up-env</a> <a id="17115" class="Symbol">(</a><a id="17116" href="/Soundness/#15521" class="Function">split</a> <a id="17122" href="/Soundness/#17009" class="Bound">m′</a><a id="17124" class="Symbol">)</a> <a id="17126" class="Symbol">(</a><a id="17127" href="/Compositional/#9430" class="Function">var-inv</a> <a id="17135" class="Symbol">(</a><a id="17136" href="/Soundness/#16997" class="Bound">exts-σ-δ′</a> <a id="17146" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="17147" class="Symbol">)))</a> <a id="17151" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17153" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17155" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="17169" class="Symbol">(</a><a id="17170" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="17178" href="/Soundness/#17178" class="Bound">d</a><a id="17179" class="Symbol">)</a> <a id="17181" class="Symbol">()</a> <a id="17184" class="Symbol">|</a> <a id="17186" href="/Soundness/#17186" class="Bound">M₁</a> <a id="17189" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="17191" href="/Soundness/#17191" class="Bound">M₂</a> 

<a id="17196" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="17210" class="Symbol">{</a><a id="17211" class="Argument">σ</a> <a id="17213" class="Symbol">=</a> <a id="17215" href="/Soundness/#17215" class="Bound">σ</a><a id="17216" class="Symbol">}</a> <a id="17218" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a> <a id="17226" href="/Soundness/#17226" class="Bound">eq</a> <a id="17229" class="Symbol">=</a>
    <a id="17235" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17237" href="/Denotational/#8561" class="Function">`⊥</a> <a id="17240" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17242" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17244" href="/Soundness/#14418" class="Function">subst-⊥</a> <a id="17252" class="Symbol">{</a><a id="17253" class="Argument">σ</a> <a id="17255" class="Symbol">=</a> <a id="17257" href="/Soundness/#17215" class="Bound">σ</a><a id="17258" class="Symbol">}</a> <a id="17260" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17262" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a> <a id="17270" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17272" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="17275" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="17289" class="Symbol">{</a><a id="17290" class="Argument">σ</a> <a id="17292" class="Symbol">=</a> <a id="17294" href="/Soundness/#17294" class="Bound">σ</a><a id="17295" class="Symbol">}</a> <a id="17297" class="Symbol">(</a><a id="17298" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="17306" href="/Soundness/#17306" class="Bound">d₁</a> <a id="17309" href="/Soundness/#17309" class="Bound">d₂</a><a id="17311" class="Symbol">)</a> <a id="17313" href="/Soundness/#17313" class="Bound">eq</a>
  <a id="17318" class="Keyword">with</a> <a id="17323" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="17337" class="Symbol">{</a><a id="17338" class="Argument">σ</a> <a id="17340" class="Symbol">=</a> <a id="17342" href="/Soundness/#17294" class="Bound">σ</a><a id="17343" class="Symbol">}</a> <a id="17345" href="/Soundness/#17306" class="Bound">d₁</a> <a id="17348" href="/Soundness/#17313" class="Bound">eq</a> <a id="17351" class="Symbol">|</a> <a id="17353" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="17367" class="Symbol">{</a><a id="17368" class="Argument">σ</a> <a id="17370" class="Symbol">=</a> <a id="17372" href="/Soundness/#17294" class="Bound">σ</a><a id="17373" class="Symbol">}</a> <a id="17375" href="/Soundness/#17309" class="Bound">d₂</a> <a id="17378" href="/Soundness/#17313" class="Bound">eq</a>
<a id="17381" class="Symbol">...</a> <a id="17385" class="Symbol">|</a> <a id="17387" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17389" href="/Soundness/#17389" class="Bound">δ₁</a> <a id="17392" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17394" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17396" href="/Soundness/#17396" class="Bound">subst-δ₁</a> <a id="17405" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17407" href="/Soundness/#17407" class="Bound">m1</a> <a id="17410" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17412" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17414" class="Symbol">|</a> <a id="17416" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17418" href="/Soundness/#17418" class="Bound">δ₂</a> <a id="17421" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17423" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17425" href="/Soundness/#17425" class="Bound">subst-δ₂</a> <a id="17434" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17436" href="/Soundness/#17436" class="Bound">m2</a> <a id="17439" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17441" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17443" class="Symbol">=</a>
     <a id="17450" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17452" href="/Soundness/#17389" class="Bound">δ₁</a> <a id="17455" href="/Denotational/#8590" class="Function Operator">`⊔</a> <a id="17458" href="/Soundness/#17418" class="Bound">δ₂</a> <a id="17461" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17463" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17465" href="/Soundness/#14684" class="Function">subst-⊔</a> <a id="17473" class="Symbol">{</a><a id="17474" class="Argument">γ₁</a> <a id="17477" class="Symbol">=</a> <a id="17479" href="/Soundness/#17389" class="Bound">δ₁</a><a id="17481" class="Symbol">}{</a><a id="17483" class="Argument">γ₂</a> <a id="17486" class="Symbol">=</a> <a id="17488" href="/Soundness/#17418" class="Bound">δ₂</a><a id="17490" class="Symbol">}{</a><a id="17492" class="Argument">σ</a> <a id="17494" class="Symbol">=</a> <a id="17496" class="Bound">σ</a><a id="17497" class="Symbol">}</a> <a id="17499" href="/Soundness/#17396" class="Bound">subst-δ₁</a> <a id="17508" href="/Soundness/#17425" class="Bound">subst-δ₂</a> <a id="17517" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="17539" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="17547" class="Symbol">(</a><a id="17548" href="/Denotational/#26207" class="Function">Env⊑</a> <a id="17553" href="/Soundness/#17407" class="Bound">m1</a> <a id="17556" class="Symbol">(</a><a id="17557" href="/Denotational/#8928" class="Function">EnvConjR1⊑</a> <a id="17568" href="/Soundness/#17389" class="Bound">δ₁</a> <a id="17571" href="/Soundness/#17418" class="Bound">δ₂</a><a id="17573" class="Symbol">))</a>
                            <a id="17604" class="Symbol">(</a><a id="17605" href="/Denotational/#26207" class="Function">Env⊑</a> <a id="17610" href="/Soundness/#17436" class="Bound">m2</a> <a id="17613" class="Symbol">(</a><a id="17614" href="/Denotational/#9025" class="Function">EnvConjR2⊑</a> <a id="17625" href="/Soundness/#17389" class="Bound">δ₁</a> <a id="17628" href="/Soundness/#17418" class="Bound">δ₂</a><a id="17630" class="Symbol">))</a> <a id="17633" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17635" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17637" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="17651" class="Symbol">(</a><a id="17652" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="17656" href="/Soundness/#17656" class="Bound">d</a> <a id="17658" href="/Soundness/#17658" class="Bound">lt</a><a id="17660" class="Symbol">)</a> <a id="17662" href="/Soundness/#17662" class="Bound">eq</a> 
    <a id="17670" class="Keyword">with</a> <a id="17675" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="17689" href="/Soundness/#17656" class="Bound">d</a> <a id="17691" href="/Soundness/#17662" class="Bound">eq</a>
<a id="17694" class="Symbol">...</a> <a id="17698" class="Symbol">|</a> <a id="17700" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17702" href="/Soundness/#17702" class="Bound">δ</a> <a id="17704" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17706" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17708" href="/Soundness/#17708" class="Bound">subst-δ</a> <a id="17716" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17718" href="/Soundness/#17718" class="Bound">m</a> <a id="17720" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17722" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17724" class="Symbol">=</a> <a id="17726" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17728" href="/Soundness/#17702" class="Bound">δ</a> <a id="17730" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17732" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17734" href="/Soundness/#17708" class="Bound">subst-δ</a> <a id="17742" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17744" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="17748" href="/Soundness/#17718" class="Bound">m</a> <a id="17750" class="Bound">lt</a> <a id="17753" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17755" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<ul>
  <li>
    <p>Case (var): We have subst σ M ≡ ` y, so M must also be a variable, say x.
We apply the lemma subst-reflect-var to conclude.</p>
  </li>
  <li>Case (↦-elim): We have subst σ M ≡ L₁ · L₂. We proceed by cases on M.
    <ul>
      <li>
        <p>Case M ≡ ` x: We apply the subst-reflect-var lemma again to conclude.</p>
      </li>
      <li>
        <p>Case M ≡ M₁ · M₂: By the induction hypothesis, we have
some δ₁ and δ₂ such that δ₁ ⊢ M₁ ↓ v₁ ↦ v₃ and γ <code class="highlighter-rouge">⊢ σ ↓ δ₁,
as well as δ₂ ⊢ M₂ ↓ v₁ and γ </code>⊢ σ ↓ δ₂.
By Env⊑ we have  δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃ and δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁
(using EnvConjR1⊑ and EnvConjR2⊑), and therefore δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃.
We conclude this case by obtaining γ ⊢ σ ↓ δ₁ ⊔ δ₂
by the subst-⊔ lemma.</p>
      </li>
    </ul>
  </li>
  <li>Case (↦-intro): We have subst σ M ≡ ƛ L’. We proceed by cases on M.
    <ul>
      <li>
        <p>Case M ≡ ` x: We apply the subst-reflect-var lemma.</p>
      </li>
      <li>
        <p>Case M ≡ ƛ M’: By the induction hypothesis, we have
(δ’ , v’) ⊢ M’ ↓ v₂ and (δ , v₁) ⊢ exts σ ↓ (δ’ , v’).
From the later we have (δ , v₁) ⊢ # 0 ↓ v’.
By the lemma var-inv we have v’ ⊑ v₁, so by the up-env lemma we
have (δ’ , v₁) ⊢ M’ ↓ v₂ and therefore δ’ ⊢ ƛ M’ ↓ v₁ → v₂.  We
also need to show that δ `⊢ σ ↓ δ’.  Fix k. We have (δ , v₁) ⊢
rename S_ σ k ↓ nth k δ’.  We then apply the lemma
rename-inc-reflect to obtain δ ⊢ σ k ↓ nth k δ’, so this case is
complete.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Case (⊥-intro): We choose ⊥ for δ.
We have ⊥ ⊢ M ↓ ⊥ by (⊥-intro).
We have δ ⊢ σ ↓ ⊥ by the lemma subst-empty.</p>
  </li>
  <li>Case (⊔-intro): By the induction hypothesis we have
δ₁ ⊢ M ↓ v₁, δ₂ ⊢ M ↓ v₂, δ ⊢ σ ↓ δ₁, and δ ⊢ σ ↓ δ₂.
We have δ₁ ⊔ δ₂ ⊢ M ↓ v₁ and δ₁ ⊔ δ₂ ⊢ M ↓ v₂
by Env⊑ with EnvConjR1⊑ and EnvConjR2⊑.
So by (⊔-intro) we have δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂.
By subst-⊔ we conclude that δ ⊢ σ ↓ δ₁ ⊔ δ₂.</li>
</ul>

<h3 id="single-substitution-reflects-denotations">Single substitution reflects denotations</h3>

<p>Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, β reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
give terms M : (Γ , ★ ⊢ ★) and N : (Γ ⊢ ★,)
if γ ⊢ M [ N ] ↓ v, then γ ⊢ N ↓ v₂ and (γ , v₂) ⊢ M ↓ v
for some value v₂. We have M [ N ] = subst (subst-zero N) M.
We apply the subst-reflect lemma to obtain
γ `⊢ subst-zero N ↓ (δ’ , v’) and (δ’ , v’) ⊢ M ↓ v
for some δ’ and v’.</p>

<p>Instantiating γ `⊢ subst-zero N ↓ (δ’ , v’) at k = 0
gives us γ ⊢ N ↓ v’. We choose v₂ = v’, so the first
part of our conclusion is complete.</p>

<p>It remains to prove (γ , v’) ⊢ M ↓ v. First, we obtain 
(γ , v’) ⊢ rename var-id M ↓ v by the rename-pres lemma
applied to (δ’ , v’) ⊢ M ↓ v, with the var-id renaming,
γ = (δ’ , v’), and δ = (γ , v’). To apply this lemma,
we need to show that 
nth n (δ’ , v’) ⊑ nth (var-id n) (γ , v’) for any n.
This is accomplished by the following lemma, which
makes use of γ `⊢ subst-zero N ↓ (δ’ , v’).</p>

<pre class="Agda"><a id="nth-id-le"></a><a id="20605" href="/Soundness/#20605" class="Function">nth-id-le</a> <a id="20615" class="Symbol">:</a> <a id="20617" class="Symbol">∀{</a><a id="20619" href="/Soundness/#20619" class="Bound">Γ</a><a id="20620" class="Symbol">}{</a><a id="20622" href="/Soundness/#20622" class="Bound">δ&#39;</a><a id="20624" class="Symbol">}{</a><a id="20626" href="/Soundness/#20626" class="Bound">v&#39;</a><a id="20628" class="Symbol">}{</a><a id="20630" href="/Soundness/#20630" class="Bound">γ</a><a id="20631" class="Symbol">}{</a><a id="20633" href="/Soundness/#20633" class="Bound">N</a><a id="20634" class="Symbol">}</a>
      <a id="20642" class="Symbol">→</a> <a id="20644" href="/Soundness/#20630" class="Bound">γ</a> <a id="20646" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="20649" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="20660" href="/Soundness/#20633" class="Bound">N</a> <a id="20662" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="20664" class="Symbol">(</a><a id="20665" href="/Soundness/#20622" class="Bound">δ&#39;</a> <a id="20668" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="20671" href="/Soundness/#20626" class="Bound">v&#39;</a><a id="20673" class="Symbol">)</a>
        <a id="20683" class="Comment">-----------------------------------------------------</a>
      <a id="20743" class="Symbol">→</a> <a id="20745" class="Symbol">(</a><a id="20746" href="/Soundness/#20746" class="Bound">x</a> <a id="20748" class="Symbol">:</a> <a id="20750" href="/Soundness/#20619" class="Bound">Γ</a> <a id="20752" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="20754" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="20756" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="20758" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="20759" class="Symbol">)</a> <a id="20761" class="Symbol">→</a> <a id="20763" class="Symbol">(</a><a id="20764" href="/Soundness/#20622" class="Bound">δ&#39;</a> <a id="20767" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="20770" href="/Soundness/#20626" class="Bound">v&#39;</a><a id="20772" class="Symbol">)</a> <a id="20774" href="/Soundness/#20746" class="Bound">x</a> <a id="20776" href="/Denotational/#4468" class="Datatype Operator">⊑</a> <a id="20778" class="Symbol">(</a><a id="20779" href="/Soundness/#20630" class="Bound">γ</a> <a id="20781" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="20784" href="/Soundness/#20626" class="Bound">v&#39;</a><a id="20786" class="Symbol">)</a> <a id="20788" class="Symbol">(</a><a id="20789" href="/Denotational/#25859" class="Function">var-id</a> <a id="20796" href="/Soundness/#20746" class="Bound">x</a><a id="20797" class="Symbol">)</a> 
<a id="20800" href="/Soundness/#20605" class="Function">nth-id-le</a> <a id="20810" href="/Soundness/#20810" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="20820" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="20822" class="Symbol">=</a> <a id="20824" href="/Denotational/#5638" class="Function">Refl⊑</a>
<a id="20830" href="/Soundness/#20605" class="Function">nth-id-le</a> <a id="20840" href="/Soundness/#20840" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="20850" class="Symbol">(</a><a id="20851" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="20853" href="/Soundness/#20853" class="Bound">n&#39;</a><a id="20855" class="Symbol">)</a> <a id="20857" class="Symbol">=</a> <a id="20859" href="/Compositional/#9430" class="Function">var-inv</a> <a id="20867" class="Symbol">(</a><a id="20868" href="/Soundness/#20840" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="20878" class="Symbol">(</a><a id="20879" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="20881" href="/Soundness/#20853" class="Bound">n&#39;</a><a id="20883" class="Symbol">))</a></pre>

<p>The above lemma proceeds by induction on n.</p>

<ul>
  <li>If it is Z, then we show that v’ ⊑ v’ by Refl⊑.</li>
  <li>If it is S n,’ then from the premise we obtain
γ ⊢ # n’ ↓ nth n’ δ’. By var-inv we have
nth n’ δ’ ⊑ nth n’ γ from which we conclude that
nth (S n’) (δ’ , v’) ⊑ nth (var-id (S n’)) (γ , v’).</li>
</ul>

<p>Returning to the proof that single substitution reflects
denotations, we have just proved that</p>

<p>(γ `, v’) ⊢ rename var-id M ↓ v</p>

<p>but we need to show (γ `, v’) ⊢ M ↓ v. 
So we apply the rename-id lemma to obtain
rename var-id M ≡ M.</p>

<p>The following is the formal version of this proof.</p>

<pre class="Agda"><a id="subst-zero-reflect"></a><a id="21492" href="/Soundness/#21492" class="Function">subst-zero-reflect</a> <a id="21511" class="Symbol">:</a> <a id="21513" class="Symbol">∀</a> <a id="21515" class="Symbol">{</a><a id="21516" href="/Soundness/#21516" class="Bound">Δ</a><a id="21517" class="Symbol">}</a> <a id="21519" class="Symbol">{</a><a id="21520" href="/Soundness/#21520" class="Bound">δ</a> <a id="21522" class="Symbol">:</a> <a id="21524" href="/Denotational/#7331" class="Function">Env</a> <a id="21528" href="/Soundness/#21516" class="Bound">Δ</a><a id="21529" class="Symbol">}</a> <a id="21531" class="Symbol">{</a><a id="21532" href="/Soundness/#21532" class="Bound">γ</a> <a id="21534" class="Symbol">:</a> <a id="21536" href="/Denotational/#7331" class="Function">Env</a> <a id="21540" class="Symbol">(</a><a id="21541" href="/Soundness/#21516" class="Bound">Δ</a> <a id="21543" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="21545" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21546" class="Symbol">)}</a> <a id="21549" class="Symbol">{</a><a id="21550" href="/Soundness/#21550" class="Bound">N</a> <a id="21552" class="Symbol">:</a> <a id="21554" href="/Soundness/#21516" class="Bound">Δ</a> <a id="21556" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21558" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21559" class="Symbol">}</a>
  <a id="21563" class="Symbol">→</a> <a id="21565" href="/Soundness/#21520" class="Bound">δ</a> <a id="21567" href="/Soundness/#2912" class="Function Operator">`⊢</a> <a id="21570" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="21581" href="/Soundness/#21550" class="Bound">N</a> <a id="21583" href="/Soundness/#2912" class="Function Operator">↓</a> <a id="21585" href="/Soundness/#21532" class="Bound">γ</a>
    <a id="21591" class="Comment">----------------------------------------</a>
  <a id="21634" class="Symbol">→</a> <a id="21636" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="21639" href="/Soundness/#21639" class="Bound">w</a> <a id="21641" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="21643" href="/Denotational/#4097" class="Datatype">Value</a> <a id="21649" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="21651" href="/Soundness/#21532" class="Bound">γ</a> <a id="21653" href="/Denotational/#8342" class="Function Operator">`⊑</a> <a id="21656" class="Symbol">(</a><a id="21657" href="/Soundness/#21520" class="Bound">δ</a> <a id="21659" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="21662" href="/Soundness/#21639" class="Bound">w</a><a id="21663" class="Symbol">)</a> <a id="21665" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a> <a id="21667" href="/Soundness/#21520" class="Bound">δ</a> <a id="21669" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="21671" href="/Soundness/#21550" class="Bound">N</a> <a id="21673" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="21675" href="/Soundness/#21639" class="Bound">w</a>
<a id="21677" href="/Soundness/#21492" class="Function">subst-zero-reflect</a> <a id="21696" class="Symbol">{</a><a id="21697" class="Argument">δ</a> <a id="21699" class="Symbol">=</a> <a id="21701" href="/Soundness/#21701" class="Bound">δ</a><a id="21702" class="Symbol">}</a> <a id="21704" class="Symbol">{</a><a id="21705" class="Argument">γ</a> <a id="21707" class="Symbol">=</a> <a id="21709" href="/Soundness/#21709" class="Bound">γ</a><a id="21710" class="Symbol">}</a> <a id="21712" href="/Soundness/#21712" class="Bound">δσγ</a> <a id="21716" class="Symbol">=</a> <a id="21718" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21720" href="/Denotational/#7797" class="Function">last</a> <a id="21725" href="/Soundness/#21709" class="Bound">γ</a> <a id="21727" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21729" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21731" href="/Soundness/#21762" class="Function">lemma</a> <a id="21737" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21739" href="/Soundness/#21712" class="Bound">δσγ</a> <a id="21743" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="21745" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21747" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>   
  <a id="21754" class="Keyword">where</a>
  <a id="21762" href="/Soundness/#21762" class="Function">lemma</a> <a id="21768" class="Symbol">:</a> <a id="21770" href="/Soundness/#21709" class="Bound">γ</a> <a id="21772" href="/Denotational/#8342" class="Function Operator">`⊑</a> <a id="21775" class="Symbol">(</a><a id="21776" href="/Soundness/#21701" class="Bound">δ</a> <a id="21778" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="21781" href="/Denotational/#7797" class="Function">last</a> <a id="21786" href="/Soundness/#21709" class="Bound">γ</a><a id="21787" class="Symbol">)</a>
  <a id="21791" href="/Soundness/#21762" class="Function">lemma</a> <a id="21797" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="21800" class="Symbol">=</a>  <a id="21803" href="/Denotational/#5638" class="Function">Refl⊑</a>
  <a id="21811" href="/Soundness/#21762" class="Function">lemma</a> <a id="21817" class="Symbol">(</a><a id="21818" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21820" href="/Soundness/#21820" class="Bound">x</a><a id="21821" class="Symbol">)</a> <a id="21823" class="Symbol">=</a> <a id="21825" href="/Compositional/#9430" class="Function">var-inv</a> <a id="21833" class="Symbol">(</a><a id="21834" href="/Soundness/#21712" class="Bound">δσγ</a> <a id="21838" class="Symbol">(</a><a id="21839" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21841" href="/Soundness/#21820" class="Bound">x</a><a id="21842" class="Symbol">))</a>
  
<a id="substitution-reflect"></a><a id="21848" href="/Soundness/#21848" class="Function">substitution-reflect</a> <a id="21869" class="Symbol">:</a> <a id="21871" class="Symbol">∀</a> <a id="21873" class="Symbol">{</a><a id="21874" href="/Soundness/#21874" class="Bound">Δ</a><a id="21875" class="Symbol">}</a> <a id="21877" class="Symbol">{</a><a id="21878" href="/Soundness/#21878" class="Bound">δ</a> <a id="21880" class="Symbol">:</a> <a id="21882" href="/Denotational/#7331" class="Function">Env</a> <a id="21886" href="/Soundness/#21874" class="Bound">Δ</a><a id="21887" class="Symbol">}</a> <a id="21889" class="Symbol">{</a><a id="21890" href="/Soundness/#21890" class="Bound">M</a> <a id="21892" class="Symbol">:</a> <a id="21894" href="/Soundness/#21874" class="Bound">Δ</a> <a id="21896" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="21898" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="21900" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21902" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21903" class="Symbol">}</a> <a id="21905" class="Symbol">{</a><a id="21906" href="/Soundness/#21906" class="Bound">N</a> <a id="21908" class="Symbol">:</a> <a id="21910" href="/Soundness/#21874" class="Bound">Δ</a> <a id="21912" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21914" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21915" class="Symbol">}</a> <a id="21917" class="Symbol">{</a><a id="21918" href="/Soundness/#21918" class="Bound">v</a><a id="21919" class="Symbol">}</a>
  <a id="21923" class="Symbol">→</a> <a id="21925" href="/Soundness/#21878" class="Bound">δ</a> <a id="21927" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="21929" href="/Soundness/#21890" class="Bound">M</a> <a id="21931" href="/Untyped/#7475" class="Function Operator">[</a> <a id="21933" href="/Soundness/#21906" class="Bound">N</a> <a id="21935" href="/Untyped/#7475" class="Function Operator">]</a> <a id="21937" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="21939" href="/Soundness/#21918" class="Bound">v</a>
    <a id="21945" class="Comment">------------------------------------------------</a>
  <a id="21996" class="Symbol">→</a> <a id="21998" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="22001" href="/Soundness/#22001" class="Bound">w</a> <a id="22003" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="22005" href="/Denotational/#4097" class="Datatype">Value</a> <a id="22011" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="22013" href="/Soundness/#21878" class="Bound">δ</a> <a id="22015" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="22017" href="/Soundness/#21906" class="Bound">N</a> <a id="22019" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="22021" href="/Soundness/#22001" class="Bound">w</a>  <a id="22024" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="22027" class="Symbol">(</a><a id="22028" href="/Soundness/#21878" class="Bound">δ</a> <a id="22030" href="/Denotational/#7489" class="Function Operator">`,</a> <a id="22033" href="/Soundness/#22001" class="Bound">w</a><a id="22034" class="Symbol">)</a> <a id="22036" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="22038" href="/Soundness/#21890" class="Bound">M</a> <a id="22040" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="22042" href="/Soundness/#21918" class="Bound">v</a>
<a id="22044" href="/Soundness/#21848" class="Function">substitution-reflect</a> <a id="22065" href="/Soundness/#22065" class="Bound">d</a> <a id="22067" class="Keyword">with</a> <a id="22072" href="/Soundness/#15694" class="Function">subst-reflect</a> <a id="22086" href="/Soundness/#22065" class="Bound">d</a> <a id="22088" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="22093" class="Symbol">...</a>  <a id="22098" class="Symbol">|</a> <a id="22100" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22102" href="/Soundness/#22102" class="Bound">γ</a> <a id="22104" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22106" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22108" href="/Soundness/#22108" class="Bound">δσγ</a> <a id="22112" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22114" href="/Soundness/#22114" class="Bound">γMv</a> <a id="22118" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22120" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22122" class="Keyword">with</a> <a id="22127" href="/Soundness/#21492" class="Function">subst-zero-reflect</a> <a id="22146" href="/Soundness/#22108" class="Bound">δσγ</a>
<a id="22150" class="Symbol">...</a>    <a id="22157" class="Symbol">|</a> <a id="22159" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22161" href="/Soundness/#22161" class="Bound">w</a> <a id="22163" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22165" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22167" href="/Soundness/#22167" class="Bound">ineq</a> <a id="22172" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22174" href="/Soundness/#22174" class="Bound">δNw</a> <a id="22178" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22180" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22182" class="Symbol">=</a> <a id="22184" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22186" href="/Soundness/#22161" class="Bound">w</a> <a id="22188" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22190" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22192" href="/Soundness/#22174" class="Bound">δNw</a> <a id="22196" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22198" href="/Denotational/#26207" class="Function">Env⊑</a> <a id="22203" class="Bound">γMv</a> <a id="22207" href="/Soundness/#22167" class="Bound">ineq</a> <a id="22212" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22214" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<h3 id="reduction-reflects-denotations-1">Reduction reflects denotations</h3>

<p>Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.</p>

<pre class="Agda"><a id="reflect-beta"></a><a id="22388" href="/Soundness/#22388" class="Function">reflect-beta</a> <a id="22401" class="Symbol">:</a> <a id="22403" class="Symbol">∀{</a><a id="22405" href="/Soundness/#22405" class="Bound">Γ</a><a id="22406" class="Symbol">}{</a><a id="22408" href="/Soundness/#22408" class="Bound">γ</a> <a id="22410" class="Symbol">:</a> <a id="22412" href="/Denotational/#7331" class="Function">Env</a> <a id="22416" href="/Soundness/#22405" class="Bound">Γ</a><a id="22417" class="Symbol">}{</a><a id="22419" href="/Soundness/#22419" class="Bound">M</a> <a id="22421" href="/Soundness/#22421" class="Bound">N</a><a id="22422" class="Symbol">}{</a><a id="22424" href="/Soundness/#22424" class="Bound">v</a><a id="22425" class="Symbol">}</a>
    <a id="22431" class="Symbol">→</a> <a id="22433" href="/Soundness/#22408" class="Bound">γ</a> <a id="22435" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="22437" class="Symbol">(</a><a id="22438" href="/Soundness/#22421" class="Bound">N</a> <a id="22440" href="/Untyped/#7475" class="Function Operator">[</a> <a id="22442" href="/Soundness/#22419" class="Bound">M</a> <a id="22444" href="/Untyped/#7475" class="Function Operator">]</a><a id="22445" class="Symbol">)</a> <a id="22447" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="22449" href="/Soundness/#22424" class="Bound">v</a>
    <a id="22455" class="Symbol">→</a> <a id="22457" href="/Soundness/#22408" class="Bound">γ</a> <a id="22459" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="22461" class="Symbol">(</a><a id="22462" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="22464" href="/Soundness/#22421" class="Bound">N</a><a id="22465" class="Symbol">)</a> <a id="22467" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="22469" href="/Soundness/#22419" class="Bound">M</a> <a id="22471" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="22473" href="/Soundness/#22424" class="Bound">v</a>
<a id="22475" href="/Soundness/#22388" class="Function">reflect-beta</a> <a id="22488" href="/Soundness/#22488" class="Bound">d</a> 
    <a id="22495" class="Keyword">with</a> <a id="22500" href="/Soundness/#21848" class="Function">substitution-reflect</a> <a id="22521" href="/Soundness/#22488" class="Bound">d</a>
<a id="22523" class="Symbol">...</a> <a id="22527" class="Symbol">|</a> <a id="22529" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22531" href="/Soundness/#22531" class="Bound">v₂&#39;</a> <a id="22535" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22537" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22539" href="/Soundness/#22539" class="Bound">d₁&#39;</a> <a id="22543" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22545" href="/Soundness/#22545" class="Bound">d₂&#39;</a> <a id="22549" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22551" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22553" class="Symbol">=</a> <a id="22555" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="22562" class="Symbol">(</a><a id="22563" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="22571" href="/Soundness/#22545" class="Bound">d₂&#39;</a><a id="22574" class="Symbol">)</a> <a id="22576" href="/Soundness/#22539" class="Bound">d₁&#39;</a> 


<a id="reflect"></a><a id="22583" href="/Soundness/#22583" class="Function">reflect</a> <a id="22591" class="Symbol">:</a> <a id="22593" class="Symbol">∀</a> <a id="22595" class="Symbol">{</a><a id="22596" href="/Soundness/#22596" class="Bound">Γ</a><a id="22597" class="Symbol">}</a> <a id="22599" class="Symbol">{</a><a id="22600" href="/Soundness/#22600" class="Bound">γ</a> <a id="22602" class="Symbol">:</a> <a id="22604" href="/Denotational/#7331" class="Function">Env</a> <a id="22608" href="/Soundness/#22596" class="Bound">Γ</a><a id="22609" class="Symbol">}</a> <a id="22611" class="Symbol">{</a><a id="22612" href="/Soundness/#22612" class="Bound">M</a> <a id="22614" href="/Soundness/#22614" class="Bound">M&#39;</a> <a id="22617" href="/Soundness/#22617" class="Bound">N</a> <a id="22619" href="/Soundness/#22619" class="Bound">v</a><a id="22620" class="Symbol">}</a>
  <a id="22624" class="Symbol">→</a> <a id="22626" href="/Soundness/#22600" class="Bound">γ</a> <a id="22628" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="22630" href="/Soundness/#22617" class="Bound">N</a> <a id="22632" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="22634" href="/Soundness/#22619" class="Bound">v</a>  <a id="22637" class="Symbol">→</a>  <a id="22640" href="/Soundness/#22612" class="Bound">M</a> <a id="22642" href="/Untyped/#10070" class="Datatype Operator">—→</a> <a id="22645" href="/Soundness/#22614" class="Bound">M&#39;</a>  <a id="22649" class="Symbol">→</a>   <a id="22653" href="/Soundness/#22614" class="Bound">M&#39;</a> <a id="22656" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="22658" href="/Soundness/#22617" class="Bound">N</a>
    <a id="22664" class="Comment">---------------------------------</a>
  <a id="22700" class="Symbol">→</a> <a id="22702" href="/Soundness/#22600" class="Bound">γ</a> <a id="22704" href="/Denotational/#9856" class="Datatype Operator">⊢</a> <a id="22706" href="/Soundness/#22612" class="Bound">M</a> <a id="22708" href="/Denotational/#9856" class="Datatype Operator">↓</a> <a id="22710" href="/Soundness/#22619" class="Bound">v</a>
<a id="22712" href="/Soundness/#22583" class="Function">reflect</a> <a id="22720" class="Symbol">(</a><a id="22721" href="/Denotational/#9910" class="InductiveConstructor">var</a><a id="22724" class="Symbol">)</a> <a id="22726" class="Symbol">(</a><a id="22727" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="22730" href="/Soundness/#22730" class="Bound">x₁</a> <a id="22733" href="/Soundness/#22733" class="Bound">r</a><a id="22734" class="Symbol">)</a> <a id="22736" class="Symbol">()</a>
<a id="22739" href="/Soundness/#22583" class="Function">reflect</a> <a id="22747" class="Symbol">(</a><a id="22748" href="/Denotational/#9910" class="InductiveConstructor">var</a><a id="22751" class="Symbol">)</a> <a id="22753" class="Symbol">(</a><a id="22754" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="22757" href="/Soundness/#22757" class="Bound">x₁</a> <a id="22760" href="/Soundness/#22760" class="Bound">r</a><a id="22761" class="Symbol">)</a> <a id="22763" class="Symbol">()</a>
<a id="22766" href="/Soundness/#22583" class="Function">reflect</a><a id="22773" class="Symbol">{</a><a id="22774" class="Argument">γ</a> <a id="22776" class="Symbol">=</a> <a id="22778" href="/Soundness/#22778" class="Bound">γ</a><a id="22779" class="Symbol">}</a> <a id="22781" class="Symbol">(</a><a id="22782" href="/Denotational/#9910" class="InductiveConstructor">var</a><a id="22785" class="Symbol">{</a><a id="22786" class="Argument">x</a> <a id="22788" class="Symbol">=</a> <a id="22790" href="/Soundness/#22790" class="Bound">x</a><a id="22791" class="Symbol">})</a> <a id="22794" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="22796" href="/Soundness/#22796" class="Bound">mn</a>
    <a id="22803" class="Keyword">with</a> <a id="22808" href="/Denotational/#9910" class="InductiveConstructor">var</a><a id="22811" class="Symbol">{</a><a id="22812" class="Argument">γ</a> <a id="22814" class="Symbol">=</a> <a id="22816" href="/Soundness/#22778" class="Bound">γ</a><a id="22817" class="Symbol">}{</a><a id="22819" class="Argument">x</a> <a id="22821" class="Symbol">=</a> <a id="22823" href="/Soundness/#22790" class="Bound">x</a><a id="22824" class="Symbol">}</a>
<a id="22826" class="Symbol">...</a> <a id="22830" class="Symbol">|</a> <a id="22832" href="/Soundness/#22832" class="Bound">d&#39;</a> <a id="22835" class="Keyword">rewrite</a> <a id="22843" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="22847" class="Bound">mn</a> <a id="22850" class="Symbol">=</a> <a id="22852" href="/Soundness/#22388" class="Function">reflect-beta</a> <a id="22865" href="/Soundness/#22832" class="Bound">d&#39;</a> 
<a id="22869" href="/Soundness/#22583" class="Function">reflect</a> <a id="22877" class="Symbol">(</a><a id="22878" href="/Denotational/#9910" class="InductiveConstructor">var</a><a id="22881" class="Symbol">)</a> <a id="22883" class="Symbol">(</a><a id="22884" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="22886" href="/Soundness/#22886" class="Bound">r</a><a id="22887" class="Symbol">)</a> <a id="22889" class="Symbol">()</a>
<a id="22892" href="/Soundness/#22583" class="Function">reflect</a> <a id="22900" class="Symbol">(</a><a id="22901" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="22908" href="/Soundness/#22908" class="Bound">d₁</a> <a id="22911" href="/Soundness/#22911" class="Bound">d₂</a><a id="22913" class="Symbol">)</a> <a id="22915" class="Symbol">(</a><a id="22916" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="22919" href="/Soundness/#22919" class="Bound">x</a> <a id="22921" href="/Soundness/#22921" class="Bound">r</a><a id="22922" class="Symbol">)</a> <a id="22924" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="22929" class="Symbol">=</a> <a id="22931" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="22938" class="Symbol">(</a><a id="22939" href="/Soundness/#22583" class="Function">reflect</a> <a id="22947" href="/Soundness/#22908" class="Bound">d₁</a> <a id="22950" href="/Soundness/#22921" class="Bound">r</a> <a id="22952" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="22956" class="Symbol">)</a> <a id="22958" href="/Soundness/#22911" class="Bound">d₂</a> 
<a id="22962" href="/Soundness/#22583" class="Function">reflect</a> <a id="22970" class="Symbol">(</a><a id="22971" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="22978" href="/Soundness/#22978" class="Bound">d₁</a> <a id="22981" href="/Soundness/#22981" class="Bound">d₂</a><a id="22983" class="Symbol">)</a> <a id="22985" class="Symbol">(</a><a id="22986" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="22989" href="/Soundness/#22989" class="Bound">x</a> <a id="22991" href="/Soundness/#22991" class="Bound">r</a><a id="22992" class="Symbol">)</a> <a id="22994" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="22999" class="Symbol">=</a> <a id="23001" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="23008" href="/Soundness/#22978" class="Bound">d₁</a> <a id="23011" class="Symbol">(</a><a id="23012" href="/Soundness/#22583" class="Function">reflect</a> <a id="23020" href="/Soundness/#22981" class="Bound">d₂</a> <a id="23023" href="/Soundness/#22991" class="Bound">r</a> <a id="23025" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23029" class="Symbol">)</a> 
<a id="23032" href="/Soundness/#22583" class="Function">reflect</a> <a id="23040" class="Symbol">(</a><a id="23041" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="23048" href="/Soundness/#23048" class="Bound">d₁</a> <a id="23051" href="/Soundness/#23051" class="Bound">d₂</a><a id="23053" class="Symbol">)</a> <a id="23055" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="23057" href="/Soundness/#23057" class="Bound">mn</a>
    <a id="23064" class="Keyword">with</a> <a id="23069" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="23076" href="/Soundness/#23048" class="Bound">d₁</a> <a id="23079" href="/Soundness/#23051" class="Bound">d₂</a>
<a id="23082" class="Symbol">...</a> <a id="23086" class="Symbol">|</a> <a id="23088" href="/Soundness/#23088" class="Bound">d&#39;</a> <a id="23091" class="Keyword">rewrite</a> <a id="23099" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23103" class="Bound">mn</a> <a id="23106" class="Symbol">=</a> <a id="23108" href="/Soundness/#22388" class="Function">reflect-beta</a> <a id="23121" href="/Soundness/#23088" class="Bound">d&#39;</a>
<a id="23124" href="/Soundness/#22583" class="Function">reflect</a> <a id="23132" class="Symbol">(</a><a id="23133" href="/Denotational/#9989" class="InductiveConstructor">↦-elim</a> <a id="23140" href="/Soundness/#23140" class="Bound">d₁</a> <a id="23143" href="/Soundness/#23143" class="Bound">d₂</a><a id="23145" class="Symbol">)</a> <a id="23147" class="Symbol">(</a><a id="23148" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="23150" href="/Soundness/#23150" class="Bound">r</a><a id="23151" class="Symbol">)</a> <a id="23153" class="Symbol">()</a>
<a id="23156" href="/Soundness/#22583" class="Function">reflect</a> <a id="23164" class="Symbol">(</a><a id="23165" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="23173" href="/Soundness/#23173" class="Bound">d</a><a id="23174" class="Symbol">)</a> <a id="23176" class="Symbol">(</a><a id="23177" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="23180" href="/Soundness/#23180" class="Bound">x</a> <a id="23182" href="/Soundness/#23182" class="Bound">r</a><a id="23183" class="Symbol">)</a> <a id="23185" class="Symbol">()</a>
<a id="23188" href="/Soundness/#22583" class="Function">reflect</a> <a id="23196" class="Symbol">(</a><a id="23197" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="23205" href="/Soundness/#23205" class="Bound">d</a><a id="23206" class="Symbol">)</a> <a id="23208" class="Symbol">(</a><a id="23209" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="23212" href="/Soundness/#23212" class="Bound">x</a> <a id="23214" href="/Soundness/#23214" class="Bound">r</a><a id="23215" class="Symbol">)</a> <a id="23217" class="Symbol">()</a>
<a id="23220" href="/Soundness/#22583" class="Function">reflect</a> <a id="23228" class="Symbol">(</a><a id="23229" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="23237" href="/Soundness/#23237" class="Bound">d</a><a id="23238" class="Symbol">)</a> <a id="23240" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="23242" href="/Soundness/#23242" class="Bound">mn</a>
    <a id="23249" class="Keyword">with</a> <a id="23254" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="23262" href="/Soundness/#23237" class="Bound">d</a>
<a id="23264" class="Symbol">...</a> <a id="23268" class="Symbol">|</a> <a id="23270" href="/Soundness/#23270" class="Bound">d&#39;</a> <a id="23273" class="Keyword">rewrite</a> <a id="23281" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23285" class="Bound">mn</a> <a id="23288" class="Symbol">=</a> <a id="23290" href="/Soundness/#22388" class="Function">reflect-beta</a> <a id="23303" href="/Soundness/#23270" class="Bound">d&#39;</a>
<a id="23306" href="/Soundness/#22583" class="Function">reflect</a> <a id="23314" class="Symbol">(</a><a id="23315" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="23323" href="/Soundness/#23323" class="Bound">d</a><a id="23324" class="Symbol">)</a> <a id="23326" class="Symbol">(</a><a id="23327" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="23329" href="/Soundness/#23329" class="Bound">r</a><a id="23330" class="Symbol">)</a> <a id="23332" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23337" class="Symbol">=</a> <a id="23339" href="/Denotational/#10127" class="InductiveConstructor">↦-intro</a> <a id="23347" class="Symbol">(</a><a id="23348" href="/Soundness/#22583" class="Function">reflect</a> <a id="23356" href="/Soundness/#23323" class="Bound">d</a> <a id="23358" href="/Soundness/#23329" class="Bound">r</a> <a id="23360" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23364" class="Symbol">)</a>
<a id="23366" href="/Soundness/#22583" class="Function">reflect</a> <a id="23374" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a> <a id="23382" href="/Soundness/#23382" class="Bound">r</a> <a id="23384" href="/Soundness/#23384" class="Bound">mn</a> <a id="23387" class="Symbol">=</a> <a id="23389" href="/Denotational/#10251" class="InductiveConstructor">⊥-intro</a>
<a id="23397" href="/Soundness/#22583" class="Function">reflect</a> <a id="23405" class="Symbol">(</a><a id="23406" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="23414" href="/Soundness/#23414" class="Bound">d₁</a> <a id="23417" href="/Soundness/#23417" class="Bound">d₂</a><a id="23419" class="Symbol">)</a> <a id="23421" href="/Soundness/#23421" class="Bound">r</a> <a id="23423" href="/Soundness/#23423" class="Bound">mn</a> <a id="23426" class="Keyword">rewrite</a> <a id="23434" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23438" href="/Soundness/#23423" class="Bound">mn</a> <a id="23441" class="Symbol">=</a>
   <a id="23446" href="/Denotational/#10326" class="InductiveConstructor">⊔-intro</a> <a id="23454" class="Symbol">(</a><a id="23455" href="/Soundness/#22583" class="Function">reflect</a> <a id="23463" href="/Soundness/#23414" class="Bound">d₁</a> <a id="23466" href="/Soundness/#23421" class="Bound">r</a> <a id="23468" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23472" class="Symbol">)</a> <a id="23474" class="Symbol">(</a><a id="23475" href="/Soundness/#22583" class="Function">reflect</a> <a id="23483" href="/Soundness/#23417" class="Bound">d₂</a> <a id="23486" href="/Soundness/#23421" class="Bound">r</a> <a id="23488" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23492" class="Symbol">)</a>
<a id="23494" href="/Soundness/#22583" class="Function">reflect</a> <a id="23502" class="Symbol">(</a><a id="23503" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="23507" href="/Soundness/#23507" class="Bound">d</a> <a id="23509" href="/Soundness/#23509" class="Bound">lt</a><a id="23511" class="Symbol">)</a> <a id="23513" href="/Soundness/#23513" class="Bound">r</a> <a id="23515" href="/Soundness/#23515" class="Bound">mn</a> <a id="23518" class="Symbol">=</a> <a id="23520" href="/Denotational/#10462" class="InductiveConstructor">sub</a> <a id="23524" class="Symbol">(</a><a id="23525" href="/Soundness/#22583" class="Function">reflect</a> <a id="23533" href="/Soundness/#23507" class="Bound">d</a> <a id="23535" href="/Soundness/#23513" class="Bound">r</a> <a id="23537" href="/Soundness/#23515" class="Bound">mn</a><a id="23539" class="Symbol">)</a> <a id="23541" href="/Soundness/#23509" class="Bound">lt</a></pre>

<h2 id="finale-reduction-implies-denotational-equality">Finale: reduction implies denotational equality</h2>

<p>We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.</p>

<pre class="Agda"><a id="reduce-equal"></a><a id="23741" href="/Soundness/#23741" class="Function">reduce-equal</a> <a id="23754" class="Symbol">:</a> <a id="23756" class="Symbol">∀</a> <a id="23758" class="Symbol">{</a><a id="23759" href="/Soundness/#23759" class="Bound">Γ</a><a id="23760" class="Symbol">}</a> <a id="23762" class="Symbol">{</a><a id="23763" href="/Soundness/#23763" class="Bound">M</a> <a id="23765" class="Symbol">:</a> <a id="23767" href="/Soundness/#23759" class="Bound">Γ</a> <a id="23769" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="23771" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="23772" class="Symbol">}</a> <a id="23774" class="Symbol">{</a><a id="23775" href="/Soundness/#23775" class="Bound">N</a> <a id="23777" class="Symbol">:</a> <a id="23779" href="/Soundness/#23759" class="Bound">Γ</a> <a id="23781" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="23783" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="23784" class="Symbol">}</a>
  <a id="23788" class="Symbol">→</a> <a id="23790" href="/Soundness/#23763" class="Bound">M</a> <a id="23792" href="/Untyped/#10070" class="Datatype Operator">—→</a> <a id="23795" href="/Soundness/#23775" class="Bound">N</a>
    <a id="23801" class="Comment">---------</a>
  <a id="23813" class="Symbol">→</a> <a id="23815" href="/Denotational/#18334" class="Function">ℰ</a> <a id="23817" href="/Soundness/#23763" class="Bound">M</a> <a id="23819" href="/Denotational/#18532" class="Function Operator">≃</a> <a id="23821" href="/Denotational/#18334" class="Function">ℰ</a> <a id="23823" href="/Soundness/#23775" class="Bound">N</a>
<a id="23825" href="/Soundness/#23741" class="Function">reduce-equal</a> <a id="23838" class="Symbol">{</a><a id="23839" href="/Soundness/#23839" class="Bound">Γ</a><a id="23840" class="Symbol">}{</a><a id="23842" href="/Soundness/#23842" class="Bound">M</a><a id="23843" class="Symbol">}{</a><a id="23845" href="/Soundness/#23845" class="Bound">N</a><a id="23846" class="Symbol">}</a> <a id="23848" href="/Soundness/#23848" class="Bound">r</a> <a id="23850" class="Symbol">=</a> <a id="23852" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="23854" class="Symbol">(λ</a> <a id="23857" href="/Soundness/#23857" class="Bound">m</a> <a id="23859" class="Symbol">→</a> <a id="23861" href="/Soundness/#6396" class="Function">preserve</a> <a id="23870" href="/Soundness/#23857" class="Bound">m</a> <a id="23872" href="/Soundness/#23848" class="Bound">r</a><a id="23873" class="Symbol">)</a> <a id="23875" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="23877" class="Symbol">(λ</a> <a id="23880" href="/Soundness/#23880" class="Bound">n</a> <a id="23882" class="Symbol">→</a> <a id="23884" href="/Soundness/#22583" class="Function">reflect</a> <a id="23892" href="/Soundness/#23880" class="Bound">n</a> <a id="23894" href="/Soundness/#23848" class="Bound">r</a> <a id="23896" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23900" class="Symbol">)</a> <a id="23902" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<p>We conclude that multi-step reduction to a lambda abstraction implies
denotational equivalence to a lambda abstraction.</p>

<pre class="Agda"><a id="denot-sound"></a><a id="24050" href="/Soundness/#24050" class="Function">denot-sound</a> <a id="24062" class="Symbol">:</a> <a id="24064" class="Symbol">∀{</a><a id="24066" href="/Soundness/#24066" class="Bound">Γ</a><a id="24067" class="Symbol">}</a> <a id="24069" class="Symbol">{</a><a id="24070" href="/Soundness/#24070" class="Bound">M</a> <a id="24072" class="Symbol">:</a> <a id="24074" href="/Soundness/#24066" class="Bound">Γ</a> <a id="24076" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24078" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24079" class="Symbol">}</a> <a id="24081" class="Symbol">{</a><a id="24082" href="/Soundness/#24082" class="Bound">N</a> <a id="24084" class="Symbol">:</a> <a id="24086" href="/Soundness/#24066" class="Bound">Γ</a> <a id="24088" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="24090" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="24092" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24094" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24095" class="Symbol">}</a>
  <a id="24099" class="Symbol">→</a> <a id="24101" href="/Soundness/#24070" class="Bound">M</a> <a id="24103" href="/Untyped/#11252" class="Datatype Operator">—↠</a> <a id="24106" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24108" href="/Soundness/#24082" class="Bound">N</a>
    <a id="24114" class="Comment">-----------------</a>
  <a id="24134" class="Symbol">→</a> <a id="24136" href="/Denotational/#18334" class="Function">ℰ</a> <a id="24138" href="/Soundness/#24070" class="Bound">M</a> <a id="24140" href="/Denotational/#18532" class="Function Operator">≃</a> <a id="24142" href="/Denotational/#18334" class="Function">ℰ</a> <a id="24144" class="Symbol">(</a><a id="24145" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24147" href="/Soundness/#24082" class="Bound">N</a><a id="24148" class="Symbol">)</a>
<a id="24150" href="/Soundness/#24050" class="Function">denot-sound</a> <a id="24162" class="Symbol">(</a><a id="24163" class="DottedPattern Symbol">.(</a><a id="24165" href="/Untyped/#4238" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="24167" class="DottedPattern Symbol">_)</a> <a id="24170" href="/Untyped/#11302" class="InductiveConstructor Operator">∎</a><a id="24171" class="Symbol">)</a> <a id="24173" class="Symbol">=</a> <a id="24175" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="24177" class="Symbol">(λ</a> <a id="24180" href="/Soundness/#24180" class="Bound">x</a> <a id="24182" class="Symbol">→</a> <a id="24184" href="/Soundness/#24180" class="Bound">x</a><a id="24185" class="Symbol">)</a> <a id="24187" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="24189" class="Symbol">(λ</a> <a id="24192" href="/Soundness/#24192" class="Bound">x</a> <a id="24194" class="Symbol">→</a> <a id="24196" href="/Soundness/#24192" class="Bound">x</a><a id="24197" class="Symbol">)</a> <a id="24199" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="24201" href="/Soundness/#24050" class="Function">denot-sound</a> <a id="24213" class="Symbol">{</a><a id="24214" href="/Soundness/#24214" class="Bound">Γ</a><a id="24215" class="Symbol">}</a> <a id="24217" class="Symbol">(</a><a id="24218" href="/Soundness/#24218" class="Bound">L</a> <a id="24220" href="/Untyped/#11358" class="InductiveConstructor Operator">—→⟨</a> <a id="24224" href="/Soundness/#24224" class="Bound">r</a> <a id="24226" href="/Untyped/#11358" class="InductiveConstructor Operator">⟩</a> <a id="24228" href="/Soundness/#24228" class="Bound">M—↠N</a><a id="24232" class="Symbol">)</a> <a id="24234" class="Symbol">{</a><a id="24235" href="/Soundness/#24235" class="Bound">γ</a><a id="24236" class="Symbol">}</a> <a id="24238" class="Symbol">{</a><a id="24239" href="/Soundness/#24239" class="Bound">v</a><a id="24240" class="Symbol">}</a> <a id="24242" class="Symbol">=</a>
  <a id="24246" class="Keyword">let</a> <a id="24250" href="/Soundness/#24250" class="Bound">ih</a> <a id="24253" class="Symbol">=</a> <a id="24255" href="/Soundness/#24050" class="Function">denot-sound</a> <a id="24267" href="/Soundness/#24228" class="Bound">M—↠N</a> <a id="24272" class="Keyword">in</a>
  <a id="24277" class="Keyword">let</a> <a id="24281" href="/Soundness/#24281" class="Bound">e</a> <a id="24283" class="Symbol">=</a> <a id="24285" href="/Soundness/#23741" class="Function">reduce-equal</a> <a id="24298" href="/Soundness/#24224" class="Bound">r</a> <a id="24300" class="Symbol">{</a><a id="24301" href="/Soundness/#24235" class="Bound">γ</a><a id="24302" class="Symbol">}</a> <a id="24304" class="Symbol">{</a><a id="24305" href="/Soundness/#24239" class="Bound">v</a><a id="24306" class="Symbol">}</a> <a id="24308" class="Keyword">in</a>
  <a id="24313" href="/Denotational/#18905" class="Function">≃-trans</a> <a id="24321" class="Symbol">{</a><a id="24322" href="/Soundness/#24214" class="Bound">Γ</a><a id="24323" class="Symbol">}</a> <a id="24325" href="/Soundness/#24281" class="Bound">e</a> <a id="24327" href="/Soundness/#24250" class="Bound">ih</a> <a id="24330" class="Symbol">{</a><a id="24331" href="/Soundness/#24235" class="Bound">γ</a><a id="24332" class="Symbol">}</a> <a id="24334" class="Symbol">{</a><a id="24335" href="/Soundness/#24239" class="Bound">v</a><a id="24336" class="Symbol">}</a></pre>


  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>

<!-- Script which allows for foldable code blocks -->
<script type="text/javascript">
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
