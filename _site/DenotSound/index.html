<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DenotSound: Soundness of reduction with respect to denotational semantics | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="DenotSound: Soundness of reduction with respect to denotational semantics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Programming Language Foundations in Agda" />
<meta property="og:description" content="Programming Language Foundations in Agda" />
<link rel="canonical" href="https://plfa.github.io/DenotSound/" />
<meta property="og:url" content="https://plfa.github.io/DenotSound/" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<script type="application/ld+json">
{"description":"Programming Language Foundations in Agda","@type":"WebPage","url":"https://plfa.github.io/DenotSound/","headline":"DenotSound: Soundness of reduction with respect to denotational semantics","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">Table of Contents</a>
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">DenotSound: Soundness of reduction with respect to denotational semantics</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/DenotCompositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/DenotSound.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/DenotAdequate/">Next</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="214" class="Keyword">module</a> <a id="221" href="/DenotSound/" class="Module">plfa.DenotSound</a> <a id="237" class="Keyword">where</a></pre>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="280" class="Keyword">open</a> <a id="285" class="Keyword">import</a> <a id="292" href="/Untyped/" class="Module">plfa.Untyped</a>
<a id="305" class="Keyword">open</a> <a id="310" class="Keyword">import</a> <a id="317" href="/Denot/" class="Module">plfa.Denot</a>
<a id="328" class="Keyword">open</a> <a id="333" class="Keyword">import</a> <a id="340" href="/DenotCompositional/" class="Module">plfa.DenotCompositional</a>

<a id="365" class="Keyword">open</a> <a id="370" class="Keyword">import</a> <a id="377" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="417" class="Keyword">using</a> <a id="423" class="Symbol">(</a><a id="424" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a><a id="427" class="Symbol">;</a> <a id="429" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">_≢_</a><a id="432" class="Symbol">;</a> <a id="434" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="438" class="Symbol">;</a> <a id="440" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a><a id="443" class="Symbol">;</a> <a id="445" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1170" class="Function">cong</a><a id="449" class="Symbol">;</a> <a id="451" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1408" class="Function">cong₂</a><a id="456" class="Symbol">;</a> <a id="458" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1274" class="Function">cong-app</a><a id="466" class="Symbol">)</a>
<a id="468" class="Keyword">open</a> <a id="473" class="Keyword">import</a> <a id="480" href="https://agda.github.io/agda-stdlib/Data.Product.html" class="Module">Data.Product</a> <a id="493" class="Keyword">using</a> <a id="499" class="Symbol">(</a><a id="500" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">_×_</a><a id="503" class="Symbol">;</a> <a id="505" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#69" class="Record">Σ</a><a id="506" class="Symbol">;</a> <a id="508" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ-syntax</a><a id="516" class="Symbol">;</a> <a id="518" href="https://agda.github.io/agda-stdlib/Data.Product.html#881" class="Function">∃</a><a id="519" class="Symbol">;</a> <a id="521" href="https://agda.github.io/agda-stdlib/Data.Product.html#942" class="Function">∃-syntax</a><a id="529" class="Symbol">;</a> <a id="531" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a><a id="536" class="Symbol">;</a> <a id="538" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#167" class="Field">proj₂</a><a id="543" class="Symbol">)</a>
  <a id="547" class="Keyword">renaming</a> <a id="556" class="Symbol">(</a><a id="557" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">_,_</a> <a id="561" class="Symbol">to</a> <a id="564" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="569" class="Symbol">)</a>
<a id="571" class="Keyword">open</a> <a id="576" class="Keyword">import</a> <a id="583" href="https://agda.github.io/agda-stdlib/Data.Sum.html" class="Module">Data.Sum</a>
<a id="592" class="Keyword">open</a> <a id="597" class="Keyword">import</a> <a id="604" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="619" class="Keyword">using</a> <a id="625" class="Symbol">(</a><a id="626" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html#611" class="Primitive">lzero</a><a id="631" class="Symbol">)</a>
<a id="633" class="Keyword">open</a> <a id="638" class="Keyword">import</a> <a id="645" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="662" class="Keyword">using</a> <a id="668" class="Symbol">(</a><a id="669" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#464" class="Function Operator">¬_</a><a id="671" class="Symbol">)</a>
<a id="673" class="Keyword">open</a> <a id="678" class="Keyword">import</a> <a id="685" href="https://agda.github.io/agda-stdlib/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="711" class="Keyword">using</a> <a id="717" class="Symbol">(</a><a id="718" href="https://agda.github.io/agda-stdlib/Relation.Nullary.Negation.html#560" class="Function">contradiction</a><a id="731" class="Symbol">)</a>
<a id="733" class="Keyword">open</a> <a id="738" class="Keyword">import</a> <a id="745" href="https://agda.github.io/agda-stdlib/Data.Empty.html" class="Module">Data.Empty</a> <a id="756" class="Keyword">using</a> <a id="762" class="Symbol">(</a><a id="763" href="https://agda.github.io/agda-stdlib/Data.Empty.html#360" class="Function">⊥-elim</a><a id="769" class="Symbol">)</a>
<a id="771" class="Keyword">open</a> <a id="776" class="Keyword">import</a> <a id="783" href="https://agda.github.io/agda-stdlib/Data.Unit.html" class="Module">Data.Unit</a>
<a id="793" class="Keyword">open</a> <a id="798" class="Keyword">import</a> <a id="805" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="822" class="Keyword">using</a> <a id="828" class="Symbol">(</a><a id="829" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#534" class="Datatype">Dec</a><a id="832" class="Symbol">;</a> <a id="834" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a><a id="837" class="Symbol">;</a> <a id="839" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a><a id="841" class="Symbol">)</a>
<a id="843" class="Keyword">open</a> <a id="848" class="Keyword">import</a> <a id="855" href="https://agda.github.io/agda-stdlib/Function.html" class="Module">Function</a> <a id="864" class="Keyword">using</a> <a id="870" class="Symbol">(</a><a id="871" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">_∘_</a><a id="874" class="Symbol">)</a>
<a id="876" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a></pre>

<p>In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e.,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M —↠ ƛ N  implies  ℰ M ≃ ℰ (ƛ N)
</code></pre></div></div>

<p>The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if a term M steps to
N, then M and N are denotationally equal. We shall prove each
direction of this if-and-only-if separately. One direction will look
just like a type preservation proof. The other direction is like
proving type preservation for reduction going in reverse.  Recall that
type preservation is sometimes called subject reduction. Preservation
in reverse is a well-known property and is called <em>subject
expansion</em>. It is also well-known that subject expansion is false for
most typed lambda calculi!</p>

<h2 id="forward-reduction-preserves-denotations">Forward reduction preserves denotations</h2>

<p>The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.</p>

<p>The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.</p>

<h3 id="simultaneous-substitution-preserves-denotations">Simultaneous substitution preserves denotations</h3>

<p>We introduce the following shorthand for the type of a substitution
from variables in context Γ to terms in context Δ.</p>

<pre class="Agda"><a id="Subst"></a><a id="2467" href="/DenotSound/#2467" class="Function">Subst</a> <a id="2473" class="Symbol">:</a> <a id="2475" href="/Untyped/#2980" class="Datatype">Context</a> <a id="2483" class="Symbol">→</a> <a id="2485" href="/Untyped/#2980" class="Datatype">Context</a> <a id="2493" class="Symbol">→</a> <a id="2495" class="PrimitiveType">Set</a>
<a id="2499" href="/DenotSound/#2467" class="Function">Subst</a> <a id="2505" href="/DenotSound/#2505" class="Bound">Γ</a> <a id="2507" href="/DenotSound/#2507" class="Bound">Δ</a> <a id="2509" class="Symbol">=</a> <a id="2511" class="Symbol">∀{</a><a id="2513" href="/DenotSound/#2513" class="Bound">A</a><a id="2514" class="Symbol">}</a> <a id="2516" class="Symbol">→</a> <a id="2518" href="/DenotSound/#2505" class="Bound">Γ</a> <a id="2520" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="2522" href="/DenotSound/#2513" class="Bound">A</a> <a id="2524" class="Symbol">→</a> <a id="2526" href="/DenotSound/#2507" class="Bound">Δ</a> <a id="2528" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="2530" href="/DenotSound/#2513" class="Bound">A</a></pre>

<p>Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if M results in v in environment γ, then applying a
substitution σ to M gives us a program that also results in v, but in
an environment δ in which, for every variable x, σ x results in the
same value as the one for x in the original environment γ.
We write δ `⊢ σ ↓ γ for this condition.</p>

<pre class="Agda"><a id="_`⊢_↓_"></a><a id="2933" href="/DenotSound/#2933" class="Function Operator">_`⊢_↓_</a> <a id="2940" class="Symbol">:</a> <a id="2942" class="Symbol">∀{</a><a id="2944" href="/DenotSound/#2944" class="Bound">Δ</a> <a id="2946" href="/DenotSound/#2946" class="Bound">Γ</a><a id="2947" class="Symbol">}</a> <a id="2949" class="Symbol">→</a> <a id="2951" href="/Denot/#7488" class="Function">Env</a> <a id="2955" href="/DenotSound/#2944" class="Bound">Δ</a> <a id="2957" class="Symbol">→</a> <a id="2959" href="/DenotSound/#2467" class="Function">Subst</a> <a id="2965" href="/DenotSound/#2946" class="Bound">Γ</a> <a id="2967" href="/DenotSound/#2944" class="Bound">Δ</a> <a id="2969" class="Symbol">→</a> <a id="2971" href="/Denot/#7488" class="Function">Env</a> <a id="2975" href="/DenotSound/#2946" class="Bound">Γ</a> <a id="2977" class="Symbol">→</a> <a id="2979" class="PrimitiveType">Set</a>
<a id="2983" href="/DenotSound/#2933" class="Function Operator">_`⊢_↓_</a> <a id="2990" class="Symbol">{</a><a id="2991" href="/DenotSound/#2991" class="Bound">Δ</a><a id="2992" class="Symbol">}{</a><a id="2994" href="/DenotSound/#2994" class="Bound">Γ</a><a id="2995" class="Symbol">}</a> <a id="2997" href="/DenotSound/#2997" class="Bound">δ</a> <a id="2999" href="/DenotSound/#2999" class="Bound">σ</a> <a id="3001" href="/DenotSound/#3001" class="Bound">γ</a> <a id="3003" class="Symbol">=</a> <a id="3005" class="Symbol">(∀</a> <a id="3008" class="Symbol">(</a><a id="3009" href="/DenotSound/#3009" class="Bound">x</a> <a id="3011" class="Symbol">:</a> <a id="3013" href="/DenotSound/#2994" class="Bound">Γ</a> <a id="3015" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="3017" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="3018" class="Symbol">)</a> <a id="3020" class="Symbol">→</a> <a id="3022" href="/DenotSound/#2997" class="Bound">δ</a> <a id="3024" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="3026" href="/DenotSound/#2999" class="Bound">σ</a> <a id="3028" href="/DenotSound/#3009" class="Bound">x</a> <a id="3030" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="3032" href="/DenotSound/#3001" class="Bound">γ</a> <a id="3034" href="/DenotSound/#3009" class="Bound">x</a><a id="3035" class="Symbol">)</a></pre>

<p>As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the exts function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in (δ , v) produce the values in (γ , v).</p>

<pre class="Agda"><a id="subst-ext"></a><a id="3314" href="/DenotSound/#3314" class="Function">subst-ext</a> <a id="3324" class="Symbol">:</a> <a id="3326" class="Symbol">∀</a> <a id="3328" class="Symbol">{</a><a id="3329" href="/DenotSound/#3329" class="Bound">Γ</a> <a id="3331" href="/DenotSound/#3331" class="Bound">Δ</a> <a id="3333" href="/DenotSound/#3333" class="Bound">v</a><a id="3334" class="Symbol">}</a> <a id="3336" class="Symbol">{</a><a id="3337" href="/DenotSound/#3337" class="Bound">γ</a> <a id="3339" class="Symbol">:</a> <a id="3341" href="/Denot/#7488" class="Function">Env</a> <a id="3345" href="/DenotSound/#3329" class="Bound">Γ</a><a id="3346" class="Symbol">}</a> <a id="3348" class="Symbol">{</a><a id="3349" href="/DenotSound/#3349" class="Bound">δ</a> <a id="3351" class="Symbol">:</a> <a id="3353" href="/Denot/#7488" class="Function">Env</a> <a id="3357" href="/DenotSound/#3331" class="Bound">Δ</a><a id="3358" class="Symbol">}</a>
  <a id="3362" class="Symbol">→</a> <a id="3364" class="Symbol">(</a><a id="3365" href="/DenotSound/#3365" class="Bound">σ</a> <a id="3367" class="Symbol">:</a> <a id="3369" href="/DenotSound/#2467" class="Function">Subst</a> <a id="3375" href="/DenotSound/#3329" class="Bound">Γ</a> <a id="3377" href="/DenotSound/#3331" class="Bound">Δ</a><a id="3378" class="Symbol">)</a>
  <a id="3382" class="Symbol">→</a> <a id="3384" href="/DenotSound/#3349" class="Bound">δ</a> <a id="3386" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="3389" href="/DenotSound/#3365" class="Bound">σ</a> <a id="3391" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="3393" href="/DenotSound/#3337" class="Bound">γ</a>
   <a id="3398" class="Comment">------------------------------</a>
  <a id="3431" class="Symbol">→</a> <a id="3433" class="Symbol">(</a><a id="3434" href="/DenotSound/#3349" class="Bound">δ</a> <a id="3436" href="/Denot/#7646" class="Function Operator">`,</a> <a id="3439" href="/DenotSound/#3333" class="Bound">v</a><a id="3440" class="Symbol">)</a> <a id="3442" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="3445" href="/Untyped/#6623" class="Function">exts</a> <a id="3450" href="/DenotSound/#3365" class="Bound">σ</a> <a id="3452" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="3454" class="Symbol">(</a><a id="3455" href="/DenotSound/#3337" class="Bound">γ</a> <a id="3457" href="/Denot/#7646" class="Function Operator">`,</a> <a id="3460" href="/DenotSound/#3333" class="Bound">v</a><a id="3461" class="Symbol">)</a>
<a id="3463" href="/DenotSound/#3314" class="Function">subst-ext</a> <a id="3473" href="/DenotSound/#3473" class="Bound">σ</a> <a id="3475" href="/DenotSound/#3475" class="Bound">d</a> <a id="3477" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="3479" class="Symbol">=</a> <a id="3481" href="/Denot/#10045" class="InductiveConstructor">var</a>
<a id="3485" href="/DenotSound/#3314" class="Function">subst-ext</a> <a id="3495" href="/DenotSound/#3495" class="Bound">σ</a> <a id="3497" href="/DenotSound/#3497" class="Bound">d</a> <a id="3499" class="Symbol">(</a><a id="3500" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="3502" href="/DenotSound/#3502" class="Bound">x</a><a id="3503" class="Symbol">)</a> <a id="3505" class="Symbol">=</a> <a id="3507" href="/Denot/#23486" class="Function">rename-pres</a> <a id="3519" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="3522" class="Symbol">(λ</a> <a id="3525" href="/DenotSound/#3525" class="Bound">_</a> <a id="3527" class="Symbol">→</a> <a id="3529" href="/Denot/#5698" class="Function">Refl⊑</a><a id="3534" class="Symbol">)</a> <a id="3536" class="Symbol">(</a><a id="3537" href="/DenotSound/#3497" class="Bound">d</a> <a id="3539" href="/DenotSound/#3502" class="Bound">x</a><a id="3540" class="Symbol">)</a></pre>

<p>The proof is by cases on the de Bruijn index x.</p>

<ul>
  <li>
    <p>If it is Z, then we need to show that δ , v ⊢ # 0 ↓ v,
which we have by rule (var).</p>
  </li>
  <li>
    <p>If it is S x’,then we need to show that 
(δ , v) ⊢ rename S_ (σ x’) ↓ nth x’ γ,
which we obtain by the renaming lemma.</p>
  </li>
</ul>

<p>With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let’s dive in!</p>

<pre class="Agda"><a id="subst-pres"></a><a id="3961" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="3972" class="Symbol">:</a> <a id="3974" class="Symbol">∀</a> <a id="3976" class="Symbol">{</a><a id="3977" href="/DenotSound/#3977" class="Bound">Γ</a> <a id="3979" href="/DenotSound/#3979" class="Bound">Δ</a> <a id="3981" href="/DenotSound/#3981" class="Bound">v</a><a id="3982" class="Symbol">}</a> <a id="3984" class="Symbol">{</a><a id="3985" href="/DenotSound/#3985" class="Bound">γ</a> <a id="3987" class="Symbol">:</a> <a id="3989" href="/Denot/#7488" class="Function">Env</a> <a id="3993" href="/DenotSound/#3977" class="Bound">Γ</a><a id="3994" class="Symbol">}</a> <a id="3996" class="Symbol">{</a><a id="3997" href="/DenotSound/#3997" class="Bound">δ</a> <a id="3999" class="Symbol">:</a> <a id="4001" href="/Denot/#7488" class="Function">Env</a> <a id="4005" href="/DenotSound/#3979" class="Bound">Δ</a><a id="4006" class="Symbol">}</a> <a id="4008" class="Symbol">{</a><a id="4009" href="/DenotSound/#4009" class="Bound">M</a> <a id="4011" class="Symbol">:</a> <a id="4013" href="/DenotSound/#3977" class="Bound">Γ</a> <a id="4015" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="4017" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="4018" class="Symbol">}</a>
  <a id="4022" class="Symbol">→</a> <a id="4024" class="Symbol">(</a><a id="4025" href="/DenotSound/#4025" class="Bound">σ</a> <a id="4027" class="Symbol">:</a> <a id="4029" href="/DenotSound/#2467" class="Function">Subst</a> <a id="4035" href="/DenotSound/#3977" class="Bound">Γ</a> <a id="4037" href="/DenotSound/#3979" class="Bound">Δ</a><a id="4038" class="Symbol">)</a>
  <a id="4042" class="Symbol">→</a> <a id="4044" href="/DenotSound/#3997" class="Bound">δ</a> <a id="4046" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="4049" href="/DenotSound/#4025" class="Bound">σ</a> <a id="4051" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="4053" href="/DenotSound/#3985" class="Bound">γ</a>
  <a id="4057" class="Symbol">→</a> <a id="4059" href="/DenotSound/#3985" class="Bound">γ</a> <a id="4061" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="4063" href="/DenotSound/#4009" class="Bound">M</a> <a id="4065" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="4067" href="/DenotSound/#3981" class="Bound">v</a>
    <a id="4073" class="Comment">------------------</a>
  <a id="4094" class="Symbol">→</a> <a id="4096" href="/DenotSound/#3997" class="Bound">δ</a> <a id="4098" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="4100" href="/Untyped/#6931" class="Function">subst</a> <a id="4106" href="/DenotSound/#4025" class="Bound">σ</a> <a id="4108" href="/DenotSound/#4009" class="Bound">M</a> <a id="4110" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="4112" href="/DenotSound/#3981" class="Bound">v</a>
<a id="4114" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4125" href="/DenotSound/#4125" class="Bound">σ</a> <a id="4127" href="/DenotSound/#4127" class="Bound">s</a> <a id="4129" class="Symbol">(</a><a id="4130" href="/Denot/#10045" class="InductiveConstructor">var</a> <a id="4134" class="Symbol">{</a><a id="4135" class="Argument">x</a> <a id="4137" class="Symbol">=</a> <a id="4139" href="/DenotSound/#4139" class="Bound">x</a><a id="4140" class="Symbol">})</a> <a id="4143" class="Symbol">=</a> <a id="4145" class="Symbol">(</a><a id="4146" href="/DenotSound/#4127" class="Bound">s</a> <a id="4148" href="/DenotSound/#4139" class="Bound">x</a><a id="4149" class="Symbol">)</a>
<a id="4151" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4162" href="/DenotSound/#4162" class="Bound">σ</a> <a id="4164" href="/DenotSound/#4164" class="Bound">s</a> <a id="4166" class="Symbol">(</a><a id="4167" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="4174" href="/DenotSound/#4174" class="Bound">d₁</a> <a id="4177" href="/DenotSound/#4177" class="Bound">d₂</a><a id="4179" class="Symbol">)</a> <a id="4181" class="Symbol">=</a>
  <a id="4185" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="4192" class="Symbol">(</a><a id="4193" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4204" href="/DenotSound/#4162" class="Bound">σ</a> <a id="4206" href="/DenotSound/#4164" class="Bound">s</a> <a id="4208" href="/DenotSound/#4174" class="Bound">d₁</a><a id="4210" class="Symbol">)</a> <a id="4212" class="Symbol">(</a><a id="4213" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4224" href="/DenotSound/#4162" class="Bound">σ</a> <a id="4226" href="/DenotSound/#4164" class="Bound">s</a> <a id="4228" href="/DenotSound/#4177" class="Bound">d₂</a><a id="4230" class="Symbol">)</a> 
<a id="4233" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4244" href="/DenotSound/#4244" class="Bound">σ</a> <a id="4246" href="/DenotSound/#4246" class="Bound">s</a> <a id="4248" class="Symbol">(</a><a id="4249" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="4257" href="/DenotSound/#4257" class="Bound">d</a><a id="4258" class="Symbol">)</a> <a id="4260" class="Symbol">=</a>
  <a id="4264" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="4272" class="Symbol">(</a><a id="4273" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4284" class="Symbol">(λ</a> <a id="4287" class="Symbol">{</a><a id="4288" href="/DenotSound/#4288" class="Bound">A</a><a id="4289" class="Symbol">}</a> <a id="4291" class="Symbol">→</a> <a id="4293" href="/Untyped/#6623" class="Function">exts</a> <a id="4298" href="/DenotSound/#4244" class="Bound">σ</a><a id="4299" class="Symbol">)</a> <a id="4301" class="Symbol">(</a><a id="4302" href="/DenotSound/#3314" class="Function">subst-ext</a> <a id="4312" href="/DenotSound/#4244" class="Bound">σ</a> <a id="4314" href="/DenotSound/#4246" class="Bound">s</a><a id="4315" class="Symbol">)</a> <a id="4317" href="/DenotSound/#4257" class="Bound">d</a><a id="4318" class="Symbol">)</a>
<a id="4320" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4331" href="/DenotSound/#4331" class="Bound">σ</a> <a id="4333" href="/DenotSound/#4333" class="Bound">s</a> <a id="4335" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a> <a id="4343" class="Symbol">=</a> <a id="4345" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a>
<a id="4353" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4364" href="/DenotSound/#4364" class="Bound">σ</a> <a id="4366" href="/DenotSound/#4366" class="Bound">s</a> <a id="4368" class="Symbol">(</a><a id="4369" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="4377" href="/DenotSound/#4377" class="Bound">d₁</a> <a id="4380" href="/DenotSound/#4380" class="Bound">d₂</a><a id="4382" class="Symbol">)</a> <a id="4384" class="Symbol">=</a>
  <a id="4388" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="4396" class="Symbol">(</a><a id="4397" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4408" href="/DenotSound/#4364" class="Bound">σ</a> <a id="4410" href="/DenotSound/#4366" class="Bound">s</a> <a id="4412" href="/DenotSound/#4377" class="Bound">d₁</a><a id="4414" class="Symbol">)</a> <a id="4416" class="Symbol">(</a><a id="4417" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4428" href="/DenotSound/#4364" class="Bound">σ</a> <a id="4430" href="/DenotSound/#4366" class="Bound">s</a> <a id="4432" href="/DenotSound/#4380" class="Bound">d₂</a><a id="4434" class="Symbol">)</a>
<a id="4436" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4447" href="/DenotSound/#4447" class="Bound">σ</a> <a id="4449" href="/DenotSound/#4449" class="Bound">s</a> <a id="4451" class="Symbol">(</a><a id="4452" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="4456" href="/DenotSound/#4456" class="Bound">d</a> <a id="4458" href="/DenotSound/#4458" class="Bound">lt</a><a id="4460" class="Symbol">)</a> <a id="4462" class="Symbol">=</a> <a id="4464" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="4468" class="Symbol">(</a><a id="4469" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="4480" href="/DenotSound/#4447" class="Bound">σ</a> <a id="4482" href="/DenotSound/#4449" class="Bound">s</a> <a id="4484" href="/DenotSound/#4456" class="Bound">d</a><a id="4485" class="Symbol">)</a> <a id="4487" href="/DenotSound/#4458" class="Bound">lt</a></pre>

<p>The proof is by induction on the semantics of M.  The two interesting
cases are for variables and lambda abstractions.</p>

<ul>
  <li>
    <p>For a variable x, we have that v ⊑ nth x γ and we need to show that
δ ⊢ σ x ↓ v.  From the premise applied to x, we have that
δ ⊢ σ x ↓ nth x γ, so we conclude by the (sub) rule.</p>
  </li>
  <li>
    <p>For a lambda abstraction, we must extend the substitution
for the induction hypothesis. We apply the extension lemma
to show that the extended substitution maps variables to
terms that result in the appropriate values.</p>
  </li>
</ul>

<h3 id="single-substitution-preserves-denotations">Single substitution preserves denotations</h3>

<p>For β reduction, (ƛ M) · N —→ M [ N ], we need to show that the
semantics is preserved when substituting N for de Bruijn index 0 in
term M. By inversion on the rules (↦-elim) and (↦-intro),
we have that γ , v₁ ⊢ M ↓ v₂ and γ ⊢ N ↓ v₁.
So we need to show that γ ⊢ M [ N ] ↓ v₂, or equivalently,
that γ ⊢ subst (subst-zero N) M ↓ v₂.</p>

<pre class="Agda"><a id="substitution"></a><a id="5430" href="/DenotSound/#5430" class="Function">substitution</a> <a id="5443" class="Symbol">:</a> <a id="5445" class="Symbol">∀</a> <a id="5447" class="Symbol">{</a><a id="5448" href="/DenotSound/#5448" class="Bound">Γ</a><a id="5449" class="Symbol">}</a> <a id="5451" class="Symbol">{</a><a id="5452" href="/DenotSound/#5452" class="Bound">γ</a> <a id="5454" class="Symbol">:</a> <a id="5456" href="/Denot/#7488" class="Function">Env</a> <a id="5460" href="/DenotSound/#5448" class="Bound">Γ</a><a id="5461" class="Symbol">}</a> <a id="5463" class="Symbol">{</a><a id="5464" href="/DenotSound/#5464" class="Bound">M</a> <a id="5466" href="/DenotSound/#5466" class="Bound">N</a> <a id="5468" href="/DenotSound/#5468" class="Bound">v₁</a> <a id="5471" href="/DenotSound/#5471" class="Bound">v₂</a><a id="5473" class="Symbol">}</a>
   <a id="5478" class="Symbol">→</a> <a id="5480" href="/DenotSound/#5452" class="Bound">γ</a> <a id="5482" href="/Denot/#7646" class="Function Operator">`,</a> <a id="5485" href="/DenotSound/#5468" class="Bound">v₁</a> <a id="5488" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="5490" href="/DenotSound/#5464" class="Bound">M</a> <a id="5492" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="5494" href="/DenotSound/#5471" class="Bound">v₂</a>
   <a id="5500" class="Symbol">→</a> <a id="5502" href="/DenotSound/#5452" class="Bound">γ</a> <a id="5504" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="5506" href="/DenotSound/#5466" class="Bound">N</a> <a id="5508" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="5510" href="/DenotSound/#5468" class="Bound">v₁</a>
     <a id="5518" class="Comment">-----------------</a>
   <a id="5539" class="Symbol">→</a> <a id="5541" href="/DenotSound/#5452" class="Bound">γ</a> <a id="5543" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="5545" href="/DenotSound/#5464" class="Bound">M</a> <a id="5547" href="/Untyped/#7475" class="Function Operator">[</a> <a id="5549" href="/DenotSound/#5466" class="Bound">N</a> <a id="5551" href="/Untyped/#7475" class="Function Operator">]</a> <a id="5553" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="5555" href="/DenotSound/#5471" class="Bound">v₂</a>   
<a id="5561" href="/DenotSound/#5430" class="Function">substitution</a><a id="5573" class="Symbol">{</a><a id="5574" href="/DenotSound/#5574" class="Bound">Γ</a><a id="5575" class="Symbol">}{</a><a id="5577" href="/DenotSound/#5577" class="Bound">γ</a><a id="5578" class="Symbol">}{</a><a id="5580" href="/DenotSound/#5580" class="Bound">M</a><a id="5581" class="Symbol">}{</a><a id="5583" href="/DenotSound/#5583" class="Bound">N</a><a id="5584" class="Symbol">}{</a><a id="5586" href="/DenotSound/#5586" class="Bound">v₁</a><a id="5588" class="Symbol">}{</a><a id="5590" href="/DenotSound/#5590" class="Bound">v₂</a><a id="5592" class="Symbol">}</a> <a id="5594" href="/DenotSound/#5594" class="Bound">dm</a> <a id="5597" href="/DenotSound/#5597" class="Bound">dn</a> <a id="5600" class="Symbol">=</a>
  <a id="5604" href="/DenotSound/#3961" class="Function">subst-pres</a> <a id="5615" class="Symbol">(</a><a id="5616" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5627" href="/DenotSound/#5583" class="Bound">N</a><a id="5628" class="Symbol">)</a> <a id="5630" href="/DenotSound/#5652" class="Function">sub-z-ok</a> <a id="5639" href="/DenotSound/#5594" class="Bound">dm</a>
  <a id="5644" class="Keyword">where</a>
  <a id="5652" href="/DenotSound/#5652" class="Function">sub-z-ok</a> <a id="5661" class="Symbol">:</a> <a id="5663" href="/DenotSound/#5577" class="Bound">γ</a> <a id="5665" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="5668" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5679" href="/DenotSound/#5583" class="Bound">N</a> <a id="5681" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="5683" class="Symbol">(</a><a id="5684" href="/DenotSound/#5577" class="Bound">γ</a> <a id="5686" href="/Denot/#7646" class="Function Operator">`,</a> <a id="5689" href="/DenotSound/#5586" class="Bound">v₁</a><a id="5691" class="Symbol">)</a>
  <a id="5695" href="/DenotSound/#5652" class="Function">sub-z-ok</a> <a id="5704" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="5706" class="Symbol">=</a> <a id="5708" href="/DenotSound/#5597" class="Bound">dn</a>
  <a id="5713" href="/DenotSound/#5652" class="Function">sub-z-ok</a> <a id="5722" class="Symbol">(</a><a id="5723" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="5725" href="/DenotSound/#5725" class="Bound">x</a><a id="5726" class="Symbol">)</a> <a id="5728" class="Symbol">=</a> <a id="5730" href="/Denot/#10045" class="InductiveConstructor">var</a></pre>

<p>This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that (subst-zero N) maps
variables to terms that produces the same values as those in γ , v₁.
Let y be an arbitrary variable (de Bruijn index).</p>

<ul>
  <li>
    <p>If it is Z, then (subst-zero N) y = N and nth y (γ , v₁) = v₁.
By the premise we conclude that γ ⊢ N ↓ v₁.</p>
  </li>
  <li>
    <p>If it is (S y’), then (subst-zero N) (S y’) = y’ and
nth (S y’) (γ , v₁) = nth y’ γ.  So we conclude that
γ ⊢ y’ ↓ nth y’ γ by rule (var).</p>
  </li>
</ul>

<h3 id="reduction-preserves-denotations">Reduction preserves denotations</h3>

<p>With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.</p>

<pre class="Agda"><a id="preserve"></a><a id="6417" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6426" class="Symbol">:</a> <a id="6428" class="Symbol">∀</a> <a id="6430" class="Symbol">{</a><a id="6431" href="/DenotSound/#6431" class="Bound">Γ</a><a id="6432" class="Symbol">}</a> <a id="6434" class="Symbol">{</a><a id="6435" href="/DenotSound/#6435" class="Bound">γ</a> <a id="6437" class="Symbol">:</a> <a id="6439" href="/Denot/#7488" class="Function">Env</a> <a id="6443" href="/DenotSound/#6431" class="Bound">Γ</a><a id="6444" class="Symbol">}</a> <a id="6446" class="Symbol">{</a><a id="6447" href="/DenotSound/#6447" class="Bound">M</a> <a id="6449" href="/DenotSound/#6449" class="Bound">N</a> <a id="6451" href="/DenotSound/#6451" class="Bound">v</a><a id="6452" class="Symbol">}</a>
  <a id="6456" class="Symbol">→</a> <a id="6458" href="/DenotSound/#6435" class="Bound">γ</a> <a id="6460" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="6462" href="/DenotSound/#6447" class="Bound">M</a> <a id="6464" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="6466" href="/DenotSound/#6451" class="Bound">v</a>
  <a id="6470" class="Symbol">→</a> <a id="6472" href="/DenotSound/#6447" class="Bound">M</a> <a id="6474" href="/Untyped/#10070" class="Datatype Operator">—→</a> <a id="6477" href="/DenotSound/#6449" class="Bound">N</a>
    <a id="6483" class="Comment">----------</a>
  <a id="6496" class="Symbol">→</a> <a id="6498" href="/DenotSound/#6435" class="Bound">γ</a> <a id="6500" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="6502" href="/DenotSound/#6449" class="Bound">N</a> <a id="6504" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="6506" href="/DenotSound/#6451" class="Bound">v</a>
<a id="6508" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6517" class="Symbol">(</a><a id="6518" href="/Denot/#10045" class="InductiveConstructor">var</a><a id="6521" class="Symbol">)</a> <a id="6523" class="Symbol">()</a>
<a id="6526" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6535" class="Symbol">(</a><a id="6536" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="6543" href="/DenotSound/#6543" class="Bound">d₁</a> <a id="6546" href="/DenotSound/#6546" class="Bound">d₂</a><a id="6548" class="Symbol">)</a> <a id="6550" class="Symbol">(</a><a id="6551" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="6554" href="/DenotSound/#6554" class="Bound">x</a> <a id="6556" href="/DenotSound/#6556" class="Bound">r</a><a id="6557" class="Symbol">)</a> <a id="6559" class="Symbol">=</a> <a id="6561" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="6568" class="Symbol">(</a><a id="6569" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6578" href="/DenotSound/#6543" class="Bound">d₁</a> <a id="6581" href="/DenotSound/#6556" class="Bound">r</a><a id="6582" class="Symbol">)</a> <a id="6584" href="/DenotSound/#6546" class="Bound">d₂</a> 
<a id="6588" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6597" class="Symbol">(</a><a id="6598" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="6605" href="/DenotSound/#6605" class="Bound">d₁</a> <a id="6608" href="/DenotSound/#6608" class="Bound">d₂</a><a id="6610" class="Symbol">)</a> <a id="6612" class="Symbol">(</a><a id="6613" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="6616" href="/DenotSound/#6616" class="Bound">x</a> <a id="6618" href="/DenotSound/#6618" class="Bound">r</a><a id="6619" class="Symbol">)</a> <a id="6621" class="Symbol">=</a> <a id="6623" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="6630" href="/DenotSound/#6605" class="Bound">d₁</a> <a id="6633" class="Symbol">(</a><a id="6634" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6643" href="/DenotSound/#6608" class="Bound">d₂</a> <a id="6646" href="/DenotSound/#6618" class="Bound">r</a><a id="6647" class="Symbol">)</a> 
<a id="6650" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6659" class="Symbol">(</a><a id="6660" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="6667" href="/DenotSound/#6667" class="Bound">d₁</a> <a id="6670" href="/DenotSound/#6670" class="Bound">d₂</a><a id="6672" class="Symbol">)</a> <a id="6674" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="6676" class="Symbol">=</a> <a id="6678" href="/DenotSound/#5430" class="Function">substitution</a> <a id="6691" class="Symbol">(</a><a id="6692" href="/DenotCompositional/#3324" class="Function">lambda-inversion</a> <a id="6709" href="/DenotSound/#6667" class="Bound">d₁</a><a id="6711" class="Symbol">)</a> <a id="6713" href="/DenotSound/#6670" class="Bound">d₂</a>
<a id="6716" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6725" class="Symbol">(</a><a id="6726" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="6734" href="/DenotSound/#6734" class="Bound">d</a><a id="6735" class="Symbol">)</a> <a id="6737" class="Symbol">(</a><a id="6738" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="6740" href="/DenotSound/#6740" class="Bound">r</a><a id="6741" class="Symbol">)</a> <a id="6743" class="Symbol">=</a> <a id="6745" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="6753" class="Symbol">(</a><a id="6754" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6763" href="/DenotSound/#6734" class="Bound">d</a> <a id="6765" href="/DenotSound/#6740" class="Bound">r</a><a id="6766" class="Symbol">)</a>
<a id="6768" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6777" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a> <a id="6785" href="/DenotSound/#6785" class="Bound">r</a> <a id="6787" class="Symbol">=</a> <a id="6789" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a>
<a id="6797" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6806" class="Symbol">(</a><a id="6807" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="6815" href="/DenotSound/#6815" class="Bound">d</a> <a id="6817" href="/DenotSound/#6817" class="Bound">d₁</a><a id="6819" class="Symbol">)</a> <a id="6821" href="/DenotSound/#6821" class="Bound">r</a> <a id="6823" class="Symbol">=</a> <a id="6825" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="6833" class="Symbol">(</a><a id="6834" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6843" href="/DenotSound/#6815" class="Bound">d</a> <a id="6845" href="/DenotSound/#6821" class="Bound">r</a><a id="6846" class="Symbol">)</a> <a id="6848" class="Symbol">(</a><a id="6849" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6858" href="/DenotSound/#6817" class="Bound">d₁</a> <a id="6861" href="/DenotSound/#6821" class="Bound">r</a><a id="6862" class="Symbol">)</a>
<a id="6864" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6873" class="Symbol">(</a><a id="6874" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="6878" href="/DenotSound/#6878" class="Bound">d</a> <a id="6880" href="/DenotSound/#6880" class="Bound">lt</a><a id="6882" class="Symbol">)</a> <a id="6884" href="/DenotSound/#6884" class="Bound">r</a> <a id="6886" class="Symbol">=</a> <a id="6888" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="6892" class="Symbol">(</a><a id="6893" href="/DenotSound/#6417" class="Function">preserve</a> <a id="6902" href="/DenotSound/#6878" class="Bound">d</a> <a id="6904" href="/DenotSound/#6884" class="Bound">r</a><a id="6905" class="Symbol">)</a> <a id="6907" href="/DenotSound/#6880" class="Bound">lt</a></pre>

<p>We proceed by induction on the semantics of M with case analysis on
the reduction.</p>

<ul>
  <li>
    <p>If M is a variable, then there is no such reduction.</p>
  </li>
  <li>
    <p>If M is an application, then the reduction is either a congruence
(ξ₁ or ξ₂) or β. For each congruence, we use the induction
hypothesis. For β reduction we use the substitution lemma and the
(sub) rule.</p>
  </li>
  <li>
    <p>The rest of the cases are straightforward.</p>
  </li>
</ul>

<h2 id="reduction-reflects-denotations">Reduction reflects denotations</h2>

<p>This section proves that reduction reflects the denotation of a
term. That is, if N results in v, and if M reduces to N, then M also
results in v. While there are some broad similarities between this
proof and the above proof of semantic preservation, we shall require a
few more technical lemmas to obtain this result.</p>

<p>The main challenge is dealing with the substitution in β reduction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ƛ M₁) · M₂ —→ M₁ [ M₂ ]
</code></pre></div></div>

<p>We have that γ ⊢ M₁ [ M₂ ] ↓ v and need to show that γ ⊢ (ƛ M₁) · M₂ ↓
v. Now consider the derivation of γ ⊢ M₁ [ M₂ ] ↓ v. The term M₂ may
occur 0, 1, or many times inside M₁ [ M₂ ]. At each of those
occurences, M₂ may result in a different value. But to build a
derivation for (ƛ M₁) · M₂, we need a single value for M₂.  If M₂
occured more than 1 time, then we can join all of the different values
using ⊔. If M₂ occured 0 times, then we can use ⊥ for the value of M₂.</p>

<h3 id="renaming-reflects-meaning">Renaming reflects meaning</h3>

<p>Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if δ ⊢ rename ρ M ↓ v, then γ ⊢ M ↓ v, where (δ ∘ ρ) `⊑ γ.</p>

<p>First, we need a variant of a lemma given earlier.</p>
<pre class="Agda"><a id="nth-ext"></a><a id="8531" href="/DenotSound/#8531" class="Function">nth-ext</a> <a id="8539" class="Symbol">:</a> <a id="8541" class="Symbol">∀</a> <a id="8543" class="Symbol">{</a><a id="8544" href="/DenotSound/#8544" class="Bound">Γ</a> <a id="8546" href="/DenotSound/#8546" class="Bound">Δ</a> <a id="8548" href="/DenotSound/#8548" class="Bound">v</a><a id="8549" class="Symbol">}</a> <a id="8551" class="Symbol">{</a><a id="8552" href="/DenotSound/#8552" class="Bound">γ</a> <a id="8554" class="Symbol">:</a> <a id="8556" href="/Denot/#7488" class="Function">Env</a> <a id="8560" href="/DenotSound/#8544" class="Bound">Γ</a><a id="8561" class="Symbol">}</a> <a id="8563" class="Symbol">{</a><a id="8564" href="/DenotSound/#8564" class="Bound">δ</a> <a id="8566" class="Symbol">:</a> <a id="8568" href="/Denot/#7488" class="Function">Env</a> <a id="8572" href="/DenotSound/#8546" class="Bound">Δ</a><a id="8573" class="Symbol">}</a>
  <a id="8577" class="Symbol">→</a> <a id="8579" class="Symbol">(</a><a id="8580" href="/DenotSound/#8580" class="Bound">ρ</a> <a id="8582" class="Symbol">:</a> <a id="8584" href="/Denot/#22654" class="Function">Rename</a> <a id="8591" href="/DenotSound/#8544" class="Bound">Γ</a> <a id="8593" href="/DenotSound/#8546" class="Bound">Δ</a><a id="8594" class="Symbol">)</a>
  <a id="8598" class="Symbol">→</a> <a id="8600" class="Symbol">(</a><a id="8601" href="/DenotSound/#8564" class="Bound">δ</a> <a id="8603" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="8605" href="/DenotSound/#8580" class="Bound">ρ</a><a id="8606" class="Symbol">)</a> <a id="8608" href="/Denot/#8499" class="Function Operator">`⊑</a> <a id="8611" href="/DenotSound/#8552" class="Bound">γ</a>
    <a id="8617" class="Comment">------------------------------</a>
  <a id="8650" class="Symbol">→</a> <a id="8652" class="Symbol">((</a><a id="8654" href="/DenotSound/#8564" class="Bound">δ</a> <a id="8656" href="/Denot/#7646" class="Function Operator">`,</a> <a id="8659" href="/DenotSound/#8548" class="Bound">v</a><a id="8660" class="Symbol">)</a> <a id="8662" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="8664" href="/Untyped/#5845" class="Function">ext</a> <a id="8668" href="/DenotSound/#8580" class="Bound">ρ</a><a id="8669" class="Symbol">)</a> <a id="8671" href="/Denot/#8499" class="Function Operator">`⊑</a> <a id="8674" class="Symbol">(</a><a id="8675" href="/DenotSound/#8552" class="Bound">γ</a> <a id="8677" href="/Denot/#7646" class="Function Operator">`,</a> <a id="8680" href="/DenotSound/#8548" class="Bound">v</a><a id="8681" class="Symbol">)</a>
<a id="8683" href="/DenotSound/#8531" class="Function">nth-ext</a> <a id="8691" href="/DenotSound/#8691" class="Bound">ρ</a> <a id="8693" href="/DenotSound/#8693" class="Bound">lt</a> <a id="8696" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="8698" class="Symbol">=</a> <a id="8700" href="/Denot/#5698" class="Function">Refl⊑</a>
<a id="8706" href="/DenotSound/#8531" class="Function">nth-ext</a> <a id="8714" href="/DenotSound/#8714" class="Bound">ρ</a> <a id="8716" href="/DenotSound/#8716" class="Bound">lt</a> <a id="8719" class="Symbol">(</a><a id="8720" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="8722" href="/DenotSound/#8722" class="Bound">x</a><a id="8723" class="Symbol">)</a> <a id="8725" class="Symbol">=</a> <a id="8727" href="/DenotSound/#8716" class="Bound">lt</a> <a id="8730" href="/DenotSound/#8722" class="Bound">x</a></pre>

<p>The proof is then as follows.</p>
<pre class="Agda"><a id="rename-reflect"></a><a id="8787" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="8802" class="Symbol">:</a> <a id="8804" class="Symbol">∀</a> <a id="8806" class="Symbol">{</a><a id="8807" href="/DenotSound/#8807" class="Bound">Γ</a> <a id="8809" href="/DenotSound/#8809" class="Bound">Δ</a> <a id="8811" href="/DenotSound/#8811" class="Bound">v</a><a id="8812" class="Symbol">}</a> <a id="8814" class="Symbol">{</a><a id="8815" href="/DenotSound/#8815" class="Bound">γ</a> <a id="8817" class="Symbol">:</a> <a id="8819" href="/Denot/#7488" class="Function">Env</a> <a id="8823" href="/DenotSound/#8807" class="Bound">Γ</a><a id="8824" class="Symbol">}</a> <a id="8826" class="Symbol">{</a><a id="8827" href="/DenotSound/#8827" class="Bound">δ</a> <a id="8829" class="Symbol">:</a> <a id="8831" href="/Denot/#7488" class="Function">Env</a> <a id="8835" href="/DenotSound/#8809" class="Bound">Δ</a><a id="8836" class="Symbol">}</a> <a id="8838" class="Symbol">{</a> <a id="8840" href="/DenotSound/#8840" class="Bound">M</a> <a id="8842" class="Symbol">:</a> <a id="8844" href="/DenotSound/#8807" class="Bound">Γ</a> <a id="8846" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="8848" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="8849" class="Symbol">}</a>
  <a id="8853" class="Symbol">→</a> <a id="8855" class="Symbol">{</a><a id="8856" href="/DenotSound/#8856" class="Bound">ρ</a> <a id="8858" class="Symbol">:</a> <a id="8860" href="/Denot/#22654" class="Function">Rename</a> <a id="8867" href="/DenotSound/#8807" class="Bound">Γ</a> <a id="8869" href="/DenotSound/#8809" class="Bound">Δ</a><a id="8870" class="Symbol">}</a>
  <a id="8874" class="Symbol">→</a> <a id="8876" class="Symbol">(</a><a id="8877" href="/DenotSound/#8827" class="Bound">δ</a> <a id="8879" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="8881" href="/DenotSound/#8856" class="Bound">ρ</a><a id="8882" class="Symbol">)</a> <a id="8884" href="/Denot/#8499" class="Function Operator">`⊑</a> <a id="8887" href="/DenotSound/#8815" class="Bound">γ</a>
  <a id="8891" class="Symbol">→</a> <a id="8893" href="/DenotSound/#8827" class="Bound">δ</a> <a id="8895" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="8897" href="/Untyped/#6171" class="Function">rename</a> <a id="8904" href="/DenotSound/#8856" class="Bound">ρ</a> <a id="8906" href="/DenotSound/#8840" class="Bound">M</a> <a id="8908" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="8910" href="/DenotSound/#8811" class="Bound">v</a>
    <a id="8916" class="Comment">------------------------------------</a>
  <a id="8955" class="Symbol">→</a> <a id="8957" href="/DenotSound/#8815" class="Bound">γ</a> <a id="8959" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="8961" href="/DenotSound/#8840" class="Bound">M</a> <a id="8963" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="8965" href="/DenotSound/#8811" class="Bound">v</a>
<a id="8967" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="8982" class="Symbol">{</a><a id="8983" class="Argument">M</a> <a id="8985" class="Symbol">=</a> <a id="8987" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="8989" href="/DenotSound/#8989" class="Bound">x</a><a id="8990" class="Symbol">}</a> <a id="8992" href="/DenotSound/#8992" class="Bound">all-n</a> <a id="8998" href="/DenotSound/#8998" class="Bound">d</a> <a id="9000" class="Keyword">with</a> <a id="9005" href="/DenotCompositional/#9278" class="Function">var-inv</a> <a id="9013" href="/DenotSound/#8998" class="Bound">d</a>
<a id="9015" class="Symbol">...</a> <a id="9019" class="Symbol">|</a> <a id="9021" href="/DenotSound/#9021" class="Bound">lt</a> <a id="9024" class="Symbol">=</a>  <a id="9027" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="9031" href="/Denot/#10045" class="InductiveConstructor">var</a> <a id="9035" class="Symbol">(</a><a id="9036" href="/Denot/#4789" class="InductiveConstructor">Trans⊑</a> <a id="9043" href="/DenotSound/#9021" class="Bound">lt</a> <a id="9046" class="Symbol">(</a><a id="9047" class="Bound">all-n</a> <a id="9053" class="Bound">x</a><a id="9054" class="Symbol">))</a>
<a id="9057" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9072" class="Symbol">{</a><a id="9073" href="/DenotSound/#9073" class="Bound">Γ</a><a id="9074" class="Symbol">}{</a><a id="9076" href="/DenotSound/#9076" class="Bound">Δ</a><a id="9077" class="Symbol">}{</a><a id="9079" href="/DenotSound/#9079" class="Bound">v₁</a> <a id="9082" href="/Denot/#4133" class="InductiveConstructor Operator">↦</a> <a id="9084" href="/DenotSound/#9084" class="Bound">v₂</a><a id="9086" class="Symbol">}{</a><a id="9088" href="/DenotSound/#9088" class="Bound">γ</a><a id="9089" class="Symbol">}{</a><a id="9091" href="/DenotSound/#9091" class="Bound">δ</a><a id="9092" class="Symbol">}{</a><a id="9094" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9096" href="/DenotSound/#9096" class="Bound">M&#39;</a><a id="9098" class="Symbol">}{</a><a id="9100" href="/DenotSound/#9100" class="Bound">ρ</a><a id="9101" class="Symbol">}</a> <a id="9103" href="/DenotSound/#9103" class="Bound">all-n</a> <a id="9109" class="Symbol">(</a><a id="9110" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="9118" href="/DenotSound/#9118" class="Bound">d</a><a id="9119" class="Symbol">)</a> <a id="9121" class="Symbol">=</a>
   <a id="9126" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="9134" class="Symbol">(</a><a id="9135" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9150" class="Symbol">(</a><a id="9151" href="/DenotSound/#8531" class="Function">nth-ext</a> <a id="9159" href="/DenotSound/#9100" class="Bound">ρ</a> <a id="9161" href="/DenotSound/#9103" class="Bound">all-n</a><a id="9166" class="Symbol">)</a> <a id="9168" href="/DenotSound/#9118" class="Bound">d</a><a id="9169" class="Symbol">)</a>
<a id="9171" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9186" class="Symbol">{</a><a id="9187" class="Argument">M</a> <a id="9189" class="Symbol">=</a> <a id="9191" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9193" href="/DenotSound/#9193" class="Bound">M&#39;</a><a id="9195" class="Symbol">}</a> <a id="9197" href="/DenotSound/#9197" class="Bound">all-n</a> <a id="9203" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a> <a id="9211" class="Symbol">=</a> <a id="9213" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a>
<a id="9221" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9236" class="Symbol">{</a><a id="9237" class="Argument">M</a> <a id="9239" class="Symbol">=</a> <a id="9241" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9243" href="/DenotSound/#9243" class="Bound">M&#39;</a><a id="9245" class="Symbol">}</a> <a id="9247" href="/DenotSound/#9247" class="Bound">all-n</a> <a id="9253" class="Symbol">(</a><a id="9254" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="9262" href="/DenotSound/#9262" class="Bound">d₁</a> <a id="9265" href="/DenotSound/#9265" class="Bound">d₂</a><a id="9267" class="Symbol">)</a> <a id="9269" class="Symbol">=</a>
   <a id="9274" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="9282" class="Symbol">(</a><a id="9283" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9298" href="/DenotSound/#9247" class="Bound">all-n</a> <a id="9304" href="/DenotSound/#9262" class="Bound">d₁</a><a id="9306" class="Symbol">)</a> <a id="9308" class="Symbol">(</a><a id="9309" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9324" href="/DenotSound/#9247" class="Bound">all-n</a> <a id="9330" href="/DenotSound/#9265" class="Bound">d₂</a><a id="9332" class="Symbol">)</a>
<a id="9334" href="/DenotSound/#8787" class="CatchallClause Function">rename-reflect</a><a id="9348" class="CatchallClause"> </a><a id="9349" class="CatchallClause Symbol">{</a><a id="9350" class="CatchallClause Argument">M</a><a id="9351" class="CatchallClause"> </a><a id="9352" class="CatchallClause Symbol">=</a><a id="9353" class="CatchallClause"> </a><a id="9354" href="/Untyped/#4238" class="CatchallClause InductiveConstructor Operator">ƛ</a><a id="9355" class="CatchallClause"> </a><a id="9356" href="/DenotSound/#9356" class="CatchallClause Bound">M&#39;</a><a id="9358" class="CatchallClause Symbol">}</a><a id="9359" class="CatchallClause"> </a><a id="9360" href="/DenotSound/#9360" class="CatchallClause Bound">all-n</a><a id="9365" class="CatchallClause"> </a><a id="9366" class="CatchallClause Symbol">(</a><a id="9367" href="/Denot/#10632" class="CatchallClause InductiveConstructor">sub</a><a id="9370" class="CatchallClause"> </a><a id="9371" href="/DenotSound/#9371" class="CatchallClause Bound">d₁</a><a id="9373" class="CatchallClause"> </a><a id="9374" href="/DenotSound/#9374" class="CatchallClause Bound">lt</a><a id="9376" class="CatchallClause Symbol">)</a> <a id="9378" class="Symbol">=</a>   <a id="9382" class="Comment">-- [PLW: why is this line in gray?]</a>
   <a id="9421" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="9425" class="Symbol">(</a><a id="9426" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9441" href="/DenotSound/#9360" class="Bound">all-n</a> <a id="9447" href="/DenotSound/#9371" class="Bound">d₁</a><a id="9449" class="Symbol">)</a> <a id="9451" href="/DenotSound/#9374" class="Bound">lt</a>
<a id="9454" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9469" class="Symbol">{</a><a id="9470" class="Argument">M</a> <a id="9472" class="Symbol">=</a> <a id="9474" href="/DenotSound/#9474" class="Bound">M₁</a> <a id="9477" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9479" href="/DenotSound/#9479" class="Bound">M₂</a><a id="9481" class="Symbol">}</a> <a id="9483" href="/DenotSound/#9483" class="Bound">all-n</a> <a id="9489" class="Symbol">(</a><a id="9490" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="9497" href="/DenotSound/#9497" class="Bound">d₁</a> <a id="9500" href="/DenotSound/#9500" class="Bound">d₂</a><a id="9502" class="Symbol">)</a> <a id="9504" class="Symbol">=</a>
   <a id="9509" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="9516" class="Symbol">(</a><a id="9517" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9532" href="/DenotSound/#9483" class="Bound">all-n</a> <a id="9538" href="/DenotSound/#9497" class="Bound">d₁</a><a id="9540" class="Symbol">)</a> <a id="9542" class="Symbol">(</a><a id="9543" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9558" href="/DenotSound/#9483" class="Bound">all-n</a> <a id="9564" href="/DenotSound/#9500" class="Bound">d₂</a><a id="9566" class="Symbol">)</a> 
<a id="9569" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9584" class="Symbol">{</a><a id="9585" class="Argument">M</a> <a id="9587" class="Symbol">=</a> <a id="9589" href="/DenotSound/#9589" class="Bound">M₁</a> <a id="9592" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9594" href="/DenotSound/#9594" class="Bound">M₂</a><a id="9596" class="Symbol">}</a> <a id="9598" href="/DenotSound/#9598" class="Bound">all-n</a> <a id="9604" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a> <a id="9612" class="Symbol">=</a> <a id="9614" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a>
<a id="9622" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9637" class="Symbol">{</a><a id="9638" class="Argument">M</a> <a id="9640" class="Symbol">=</a> <a id="9642" href="/DenotSound/#9642" class="Bound">M₁</a> <a id="9645" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9647" href="/DenotSound/#9647" class="Bound">M₂</a><a id="9649" class="Symbol">}</a> <a id="9651" href="/DenotSound/#9651" class="Bound">all-n</a> <a id="9657" class="Symbol">(</a><a id="9658" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="9666" href="/DenotSound/#9666" class="Bound">d₁</a> <a id="9669" href="/DenotSound/#9669" class="Bound">d₂</a><a id="9671" class="Symbol">)</a> <a id="9673" class="Symbol">=</a>
   <a id="9678" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="9686" class="Symbol">(</a><a id="9687" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9702" href="/DenotSound/#9651" class="Bound">all-n</a> <a id="9708" href="/DenotSound/#9666" class="Bound">d₁</a><a id="9710" class="Symbol">)</a> <a id="9712" class="Symbol">(</a><a id="9713" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9728" href="/DenotSound/#9651" class="Bound">all-n</a> <a id="9734" href="/DenotSound/#9669" class="Bound">d₂</a><a id="9736" class="Symbol">)</a>
<a id="9738" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9753" class="Symbol">{</a><a id="9754" class="Argument">M</a> <a id="9756" class="Symbol">=</a> <a id="9758" href="/DenotSound/#9758" class="Bound">M₁</a> <a id="9761" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9763" href="/DenotSound/#9763" class="Bound">M₂</a><a id="9765" class="Symbol">}</a> <a id="9767" href="/DenotSound/#9767" class="Bound">all-n</a> <a id="9773" class="Symbol">(</a><a id="9774" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="9778" href="/DenotSound/#9778" class="Bound">d₁</a> <a id="9781" href="/DenotSound/#9781" class="Bound">lt</a><a id="9783" class="Symbol">)</a> <a id="9785" class="Symbol">=</a>
   <a id="9790" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="9794" class="Symbol">(</a><a id="9795" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="9810" href="/DenotSound/#9767" class="Bound">all-n</a> <a id="9816" href="/DenotSound/#9778" class="Bound">d₁</a><a id="9818" class="Symbol">)</a> <a id="9820" href="/DenotSound/#9781" class="Bound">lt</a></pre>

<p>We cannot prove this lemma by induction on the derivation of
δ ⊢ rename ρ M ↓ v, so instead we proceed by induction on M.</p>

<ul>
  <li>
    <p>If it is a variable, we apply the inversion lemma to obtain
that v ⊑ nth (ρ x) δ. Instantiating the premise to x we have
nth (ρ x) δ = nth x γ, so we conclude by the (var) rule.</p>
  </li>
  <li>
    <p>If it is a lambda abstraction ƛ M’, we have
rename ρ (ƛ M’) = ƛ (rename (ext ρ) M’).
We proceed by cases on δ ⊢ ƛ (rename (ext ρ) M’) ↓ v.</p>

    <ul>
      <li>
        <p>Rule (↦-intro): To satisfy the premise of the induction
hypothesis, we prove that the renaming can be extended to be a
mapping from γ , v₁ to δ , v₁.</p>
      </li>
      <li>
        <p>Rule (⊥-intro): We simply apply (⊥-intro).</p>
      </li>
      <li>
        <p>Rule (⊔-intro): We apply the induction hypotheses and (⊔-intro).</p>
      </li>
      <li>
        <p>Rule (sub): [PLW: this case is also in the code!]</p>
      </li>
    </ul>
  </li>
  <li>
    <p>If it is an application M₁ · M₂, we have
rename ρ (M₁ · M₂) = (rename ρ M₁) · (rename ρ M₂).
We proceed by cases on δ ⊢ (rename ρ M₁) · (rename ρ M₂) ↓ v
and all the cases are straightforward.</p>
  </li>
</ul>

<p>In the upcoming uses of rename-reflect, the renaming will always be
the increment function. So we prove a corollary for that special case.</p>

<pre class="Agda"><a id="rename-inc-reflect"></a><a id="10980" href="/DenotSound/#10980" class="Function">rename-inc-reflect</a> <a id="10999" class="Symbol">:</a> <a id="11001" class="Symbol">∀</a> <a id="11003" class="Symbol">{</a><a id="11004" href="/DenotSound/#11004" class="Bound">Γ</a> <a id="11006" href="/DenotSound/#11006" class="Bound">v&#39;</a> <a id="11009" href="/DenotSound/#11009" class="Bound">v</a><a id="11010" class="Symbol">}</a> <a id="11012" class="Symbol">{</a><a id="11013" href="/DenotSound/#11013" class="Bound">γ</a> <a id="11015" class="Symbol">:</a> <a id="11017" href="/Denot/#7488" class="Function">Env</a> <a id="11021" href="/DenotSound/#11004" class="Bound">Γ</a><a id="11022" class="Symbol">}</a> <a id="11024" class="Symbol">{</a> <a id="11026" href="/DenotSound/#11026" class="Bound">M</a> <a id="11028" class="Symbol">:</a> <a id="11030" href="/DenotSound/#11004" class="Bound">Γ</a> <a id="11032" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="11034" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11035" class="Symbol">}</a>
  <a id="11039" class="Symbol">→</a> <a id="11041" class="Symbol">(</a><a id="11042" href="/DenotSound/#11013" class="Bound">γ</a> <a id="11044" href="/Denot/#7646" class="Function Operator">`,</a> <a id="11047" href="/DenotSound/#11006" class="Bound">v&#39;</a><a id="11049" class="Symbol">)</a> <a id="11051" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="11053" href="/Untyped/#6171" class="Function">rename</a> <a id="11060" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="11063" href="/DenotSound/#11026" class="Bound">M</a> <a id="11065" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="11067" href="/DenotSound/#11009" class="Bound">v</a>
    <a id="11073" class="Comment">----------------------------</a>
  <a id="11104" class="Symbol">→</a> <a id="11106" href="/DenotSound/#11013" class="Bound">γ</a> <a id="11108" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="11110" href="/DenotSound/#11026" class="Bound">M</a> <a id="11112" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="11114" href="/DenotSound/#11009" class="Bound">v</a>
<a id="11116" href="/DenotSound/#10980" class="Function">rename-inc-reflect</a> <a id="11135" href="/DenotSound/#11135" class="Bound">d</a> <a id="11137" class="Symbol">=</a> <a id="11139" href="/DenotSound/#8787" class="Function">rename-reflect</a> <a id="11154" href="/Denot/#9003" class="Function">`Refl⊑</a> <a id="11161" href="/DenotSound/#11135" class="Bound">d</a></pre>

<h3 id="substitution-reflects-denotations-the-variable-case">Substitution reflects denotations, the variable case</h3>

<p>We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if γ ⊢ (subst σ M) ↓ v, then γ ⊢ σ k ↓
nth k δ and δ ⊢ M ↓ v for any k and some δ.  We shall start with the
case in which M is a variable x.  So instead the premise is γ ⊢ σ x ↓
v and we need to show that δ ⊢ ` x ↓ v for some δ. The δ that we
choose shall be the environment that maps x to v and every other
variable to ⊥.</p>

<p>The nth element of the `⊥ environment is always ⊥.
[PLW: Probably can omit]</p>
<pre class="Agda"><a id="nth-`⊥"></a><a id="11746" href="/DenotSound/#11746" class="Function">nth-`⊥</a> <a id="11753" class="Symbol">:</a> <a id="11755" class="Symbol">∀{</a><a id="11757" href="/DenotSound/#11757" class="Bound">Γ</a><a id="11758" class="Symbol">}</a> <a id="11760" class="Symbol">{</a><a id="11761" href="/DenotSound/#11761" class="Bound">x</a> <a id="11763" class="Symbol">:</a> <a id="11765" href="/DenotSound/#11757" class="Bound">Γ</a> <a id="11767" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="11769" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11770" class="Symbol">}</a> <a id="11772" class="Symbol">→</a> <a id="11774" href="/Denot/#8718" class="Function">`⊥</a> <a id="11777" href="/DenotSound/#11761" class="Bound">x</a> <a id="11779" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="11781" href="/Denot/#4121" class="InductiveConstructor">⊥</a>
<a id="11783" href="/DenotSound/#11746" class="Function">nth-`⊥</a> <a id="11790" class="Symbol">{</a><a id="11791" class="Argument">x</a> <a id="11793" class="Symbol">=</a> <a id="11795" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="11796" class="Symbol">}</a> <a id="11798" class="Symbol">=</a> <a id="11800" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="11805" href="/DenotSound/#11746" class="Function">nth-`⊥</a> <a id="11812" class="Symbol">{</a><a id="11813" href="/DenotSound/#11813" class="Bound">Γ</a> <a id="11815" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="11817" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11818" class="Symbol">}</a> <a id="11820" class="Symbol">{</a><a id="11821" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="11823" href="/DenotSound/#11823" class="Bound">x</a><a id="11824" class="Symbol">}</a> <a id="11826" class="Symbol">=</a> <a id="11828" href="/DenotSound/#11746" class="Function">nth-`⊥</a> <a id="11835" class="Symbol">{</a><a id="11836" href="/DenotSound/#11813" class="Bound">Γ</a><a id="11837" class="Symbol">}</a> <a id="11839" class="Symbol">{</a><a id="11840" href="/DenotSound/#11823" class="Bound">x</a><a id="11841" class="Symbol">}</a></pre>

<p>Next we define the environment that maps x to v and every other
variable to ⊥, that is (const-env x v).</p>

<pre class="Agda"><a id="11973" class="Comment">{-
inv-S : ∀ {Γ A B} {x y : Γ ∋ A}
  → _≡_ {_} {Γ , B ∋ A} (S x) (S y)
  → S x ≡ S y
    -------------------------------
  → x ≡ y
inv-S refl = refl
-}</a>

<a id="_var≟_"></a><a id="12126" href="/DenotSound/#12126" class="Function Operator">_var≟_</a> <a id="12133" class="Symbol">:</a> <a id="12135" class="Symbol">∀</a> <a id="12137" class="Symbol">{</a><a id="12138" href="/DenotSound/#12138" class="Bound">Γ</a><a id="12139" class="Symbol">}</a> <a id="12141" class="Symbol">→</a> <a id="12143" class="Symbol">(</a><a id="12144" href="/DenotSound/#12144" class="Bound">x</a> <a id="12146" href="/DenotSound/#12146" class="Bound">y</a> <a id="12148" class="Symbol">:</a> <a id="12150" href="/DenotSound/#12138" class="Bound">Γ</a> <a id="12152" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12154" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12155" class="Symbol">)</a> <a id="12157" class="Symbol">→</a> <a id="12159" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#534" class="Datatype">Dec</a> <a id="12163" class="Symbol">(</a><a id="12164" href="/DenotSound/#12144" class="Bound">x</a> <a id="12166" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12168" href="/DenotSound/#12146" class="Bound">y</a><a id="12169" class="Symbol">)</a>
<a id="12171" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12173" href="/DenotSound/#12126" class="Function Operator">var≟</a> <a id="12178" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12181" class="Symbol">=</a>  <a id="12184" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12188" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12193" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12195" href="/DenotSound/#12126" class="Function Operator">var≟</a> <a id="12200" class="Symbol">(</a><a id="12201" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12203" class="Symbol">_)</a>  <a id="12207" class="Symbol">=</a>  <a id="12210" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12213" class="Symbol">λ()</a>
<a id="12217" class="Symbol">(</a><a id="12218" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12220" class="Symbol">_)</a> <a id="12223" href="/DenotSound/#12126" class="Function Operator">var≟</a> <a id="12228" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12231" class="Symbol">=</a>  <a id="12234" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12237" class="Symbol">λ()</a>
<a id="12241" class="Symbol">(</a><a id="12242" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12244" href="/DenotSound/#12244" class="Bound">x</a><a id="12245" class="Symbol">)</a> <a id="12247" href="/DenotSound/#12126" class="Function Operator">var≟</a> <a id="12252" class="Symbol">(</a><a id="12253" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12255" href="/DenotSound/#12255" class="Bound">y</a><a id="12256" class="Symbol">)</a> <a id="12258" class="Keyword">with</a>  <a id="12264" href="/DenotSound/#12244" class="Bound">x</a> <a id="12266" href="/DenotSound/#12126" class="Function Operator">var≟</a> <a id="12271" href="/DenotSound/#12255" class="Bound">y</a>
<a id="12273" class="Symbol">...</a>                 <a id="12293" class="Symbol">|</a>  <a id="12296" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12300" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12305" class="Symbol">=</a>  <a id="12308" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12312" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12317" class="Symbol">...</a>                 <a id="12337" class="Symbol">|</a>  <a id="12340" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12343" href="/DenotSound/#12343" class="Bound">neq</a>   <a id="12349" class="Symbol">=</a>  <a id="12352" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12355" class="Symbol">λ{</a><a id="12357" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12362" class="Symbol">→</a> <a id="12364" href="/DenotSound/#12343" class="Bound">neq</a> <a id="12368" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="12372" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12375" href="/DenotSound/#12375" class="Function">var≟-refl</a> <a id="12385" class="Symbol">:</a> <a id="12387" class="Symbol">∀</a> <a id="12389" class="Symbol">{</a><a id="12390" href="/DenotSound/#12390" class="Bound">Γ</a><a id="12391" class="Symbol">}</a> <a id="12393" class="Symbol">(</a><a id="12394" href="/DenotSound/#12394" class="Bound">x</a> <a id="12396" class="Symbol">:</a> <a id="12398" href="/DenotSound/#12390" class="Bound">Γ</a> <a id="12400" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12402" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12403" class="Symbol">)</a> <a id="12405" class="Symbol">→</a> <a id="12407" class="Symbol">(</a><a id="12408" href="/DenotSound/#12394" class="Bound">x</a> <a id="12410" href="/DenotSound/#12126" class="Function Operator">var≟</a> <a id="12415" href="/DenotSound/#12394" class="Bound">x</a><a id="12416" class="Symbol">)</a> <a id="12418" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12420" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12424" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12429" href="/DenotSound/#12375" class="Function">var≟-refl</a> <a id="12439" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12441" class="Symbol">=</a> <a id="12443" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12448" href="/DenotSound/#12375" class="Function">var≟-refl</a> <a id="12458" class="Symbol">(</a><a id="12459" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12461" href="/DenotSound/#12461" class="Bound">x</a><a id="12462" class="Symbol">)</a> <a id="12464" class="Keyword">rewrite</a> <a id="12472" href="/DenotSound/#12375" class="Function">var≟-refl</a> <a id="12482" href="/DenotSound/#12461" class="Bound">x</a> <a id="12484" class="Symbol">=</a> <a id="12486" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>

<a id="const-env"></a><a id="12492" href="/DenotSound/#12492" class="Function">const-env</a> <a id="12502" class="Symbol">:</a> <a id="12504" class="Symbol">∀{</a><a id="12506" href="/DenotSound/#12506" class="Bound">Γ</a><a id="12507" class="Symbol">}</a> <a id="12509" class="Symbol">→</a> <a id="12511" class="Symbol">(</a><a id="12512" href="/DenotSound/#12512" class="Bound">x</a> <a id="12514" class="Symbol">:</a> <a id="12516" href="/DenotSound/#12506" class="Bound">Γ</a> <a id="12518" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12520" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12521" class="Symbol">)</a> <a id="12523" class="Symbol">→</a> <a id="12525" href="/Denot/#4101" class="Datatype">Value</a> <a id="12531" class="Symbol">→</a> <a id="12533" href="/Denot/#7488" class="Function">Env</a> <a id="12537" href="/DenotSound/#12506" class="Bound">Γ</a>
<a id="12539" href="/DenotSound/#12492" class="Function">const-env</a> <a id="12549" href="/DenotSound/#12549" class="Bound">x</a> <a id="12551" href="/DenotSound/#12551" class="Bound">v</a> <a id="12553" href="/DenotSound/#12553" class="Bound">y</a> <a id="12555" class="Keyword">with</a> <a id="12560" href="/DenotSound/#12549" class="Bound">x</a> <a id="12562" href="/DenotSound/#12126" class="Function Operator">var≟</a> <a id="12567" href="/DenotSound/#12553" class="Bound">y</a>
<a id="12569" class="Symbol">...</a>             <a id="12585" class="Symbol">|</a> <a id="12587" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12591" class="Symbol">_</a>       <a id="12599" class="Symbol">=</a> <a id="12601" class="Bound">v</a>
<a id="12603" class="Symbol">...</a>             <a id="12619" class="Symbol">|</a> <a id="12621" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12624" class="Symbol">_</a>        <a id="12633" class="Symbol">=</a> <a id="12635" href="/Denot/#4121" class="InductiveConstructor">⊥</a></pre>

<p>Of course, the nth element of (const-env n v) is the value v.</p>

<pre class="Agda"><a id="nth-const-env"></a><a id="12725" href="/DenotSound/#12725" class="Function">nth-const-env</a> <a id="12739" class="Symbol">:</a> <a id="12741" class="Symbol">∀{</a><a id="12743" href="/DenotSound/#12743" class="Bound">Γ</a><a id="12744" class="Symbol">}</a> <a id="12746" class="Symbol">{</a><a id="12747" href="/DenotSound/#12747" class="Bound">x</a> <a id="12749" class="Symbol">:</a> <a id="12751" href="/DenotSound/#12743" class="Bound">Γ</a> <a id="12753" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12755" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12756" class="Symbol">}</a> <a id="12758" class="Symbol">{</a><a id="12759" href="/DenotSound/#12759" class="Bound">v</a><a id="12760" class="Symbol">}</a> <a id="12762" class="Symbol">→</a> <a id="12764" class="Symbol">(</a><a id="12765" href="/DenotSound/#12492" class="Function">const-env</a> <a id="12775" href="/DenotSound/#12747" class="Bound">x</a> <a id="12777" href="/DenotSound/#12759" class="Bound">v</a><a id="12778" class="Symbol">)</a> <a id="12780" href="/DenotSound/#12747" class="Bound">x</a> <a id="12782" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12784" href="/DenotSound/#12759" class="Bound">v</a>
<a id="12786" href="/DenotSound/#12725" class="Function">nth-const-env</a> <a id="12800" class="Symbol">{</a><a id="12801" class="Argument">x</a> <a id="12803" class="Symbol">=</a> <a id="12805" href="/DenotSound/#12805" class="Bound">x</a><a id="12806" class="Symbol">}</a> <a id="12808" class="Keyword">rewrite</a> <a id="12816" href="/DenotSound/#12375" class="Function">var≟-refl</a> <a id="12826" href="/DenotSound/#12805" class="Bound">x</a> <a id="12828" class="Symbol">=</a> <a id="12830" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>The nth element of (const-env n’ v) is the value ⊥, so long as n ≢ n’.</p>

<pre class="Agda"><a id="diff-nth-const-env"></a><a id="12932" href="/DenotSound/#12932" class="Function">diff-nth-const-env</a> <a id="12951" class="Symbol">:</a> <a id="12953" class="Symbol">∀{</a><a id="12955" href="/DenotSound/#12955" class="Bound">Γ</a><a id="12956" class="Symbol">}</a> <a id="12958" class="Symbol">{</a><a id="12959" href="/DenotSound/#12959" class="Bound">x</a> <a id="12961" href="/DenotSound/#12961" class="Bound">y</a> <a id="12963" class="Symbol">:</a> <a id="12965" href="/DenotSound/#12955" class="Bound">Γ</a> <a id="12967" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12969" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12970" class="Symbol">}</a> <a id="12972" class="Symbol">{</a><a id="12973" href="/DenotSound/#12973" class="Bound">v</a><a id="12974" class="Symbol">}</a>
  <a id="12978" class="Symbol">→</a> <a id="12980" href="/DenotSound/#12959" class="Bound">x</a> <a id="12982" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">≢</a> <a id="12984" href="/DenotSound/#12961" class="Bound">y</a>
    <a id="12990" class="Comment">-------------------</a>
  <a id="13012" class="Symbol">→</a> <a id="13014" href="/DenotSound/#12492" class="Function">const-env</a> <a id="13024" href="/DenotSound/#12959" class="Bound">x</a> <a id="13026" href="/DenotSound/#12973" class="Bound">v</a> <a id="13028" href="/DenotSound/#12961" class="Bound">y</a> <a id="13030" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13032" href="/Denot/#4121" class="InductiveConstructor">⊥</a>
<a id="13034" href="/DenotSound/#12932" class="Function">diff-nth-const-env</a> <a id="13053" class="Symbol">{</a><a id="13054" href="/DenotSound/#13054" class="Bound">Γ</a><a id="13055" class="Symbol">}</a> <a id="13057" class="Symbol">{</a><a id="13058" href="/DenotSound/#13058" class="Bound">x</a><a id="13059" class="Symbol">}</a> <a id="13061" class="Symbol">{</a><a id="13062" href="/DenotSound/#13062" class="Bound">y</a><a id="13063" class="Symbol">}</a> <a id="13065" href="/DenotSound/#13065" class="Bound">neq</a> <a id="13069" class="Keyword">with</a> <a id="13074" href="/DenotSound/#13058" class="Bound">x</a> <a id="13076" href="/DenotSound/#12126" class="Function Operator">var≟</a> <a id="13081" href="/DenotSound/#13062" class="Bound">y</a>
<a id="13083" class="Symbol">...</a>  <a id="13088" class="Symbol">|</a> <a id="13090" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="13094" href="/DenotSound/#13094" class="Bound">eq</a>  <a id="13098" class="Symbol">=</a>  <a id="13101" href="https://agda.github.io/agda-stdlib/Data.Empty.html#360" class="Function">⊥-elim</a> <a id="13108" class="Symbol">(</a><a id="13109" class="Bound">neq</a> <a id="13113" href="/DenotSound/#13094" class="Bound">eq</a><a id="13115" class="Symbol">)</a>
<a id="13117" class="Symbol">...</a>  <a id="13122" class="Symbol">|</a> <a id="13124" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="13127" class="Symbol">_</a>    <a id="13132" class="Symbol">=</a>  <a id="13135" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>So we choose (const-env x v) for δ and obtain δ ⊢ ` x ↓ v
with the (var) rule.</p>

<p>It remains to prove that γ `⊢ σ ↓ δ and δ ⊢ M ↓ v for any k, given that
we have chosen (const-env x v) for δ .  We shall have two cases to
consider, x ≡ y or x ≢ y.</p>

<p>Now to finish the two cases of the proof.</p>

<ul>
  <li>In the case where x ≡ y, we need to show
that γ ⊢ σ y ↓ v, but that’s just our premise.</li>
  <li>In the case where x ≢ y, we need to show
that γ ⊢ σ y ↓ ⊥, which we do via rule (⊥-intro).</li>
</ul>

<p>Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.</p>

<pre class="Agda"><a id="subst-reflect-var"></a><a id="13787" href="/DenotSound/#13787" class="Function">subst-reflect-var</a> <a id="13805" class="Symbol">:</a> <a id="13807" class="Symbol">∀</a> <a id="13809" class="Symbol">{</a><a id="13810" href="/DenotSound/#13810" class="Bound">Γ</a> <a id="13812" href="/DenotSound/#13812" class="Bound">Δ</a><a id="13813" class="Symbol">}</a> <a id="13815" class="Symbol">{</a><a id="13816" href="/DenotSound/#13816" class="Bound">γ</a> <a id="13818" class="Symbol">:</a> <a id="13820" href="/Denot/#7488" class="Function">Env</a> <a id="13824" href="/DenotSound/#13812" class="Bound">Δ</a><a id="13825" class="Symbol">}</a> <a id="13827" class="Symbol">{</a><a id="13828" href="/DenotSound/#13828" class="Bound">x</a> <a id="13830" class="Symbol">:</a> <a id="13832" href="/DenotSound/#13810" class="Bound">Γ</a> <a id="13834" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="13836" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="13837" class="Symbol">}</a> <a id="13839" class="Symbol">{</a><a id="13840" href="/DenotSound/#13840" class="Bound">v</a><a id="13841" class="Symbol">}</a> <a id="13843" class="Symbol">{</a><a id="13844" href="/DenotSound/#13844" class="Bound">σ</a> <a id="13846" class="Symbol">:</a> <a id="13848" href="/DenotSound/#2467" class="Function">Subst</a> <a id="13854" href="/DenotSound/#13810" class="Bound">Γ</a> <a id="13856" href="/DenotSound/#13812" class="Bound">Δ</a><a id="13857" class="Symbol">}</a>
  <a id="13861" class="Symbol">→</a> <a id="13863" href="/DenotSound/#13816" class="Bound">γ</a> <a id="13865" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="13867" href="/DenotSound/#13844" class="Bound">σ</a> <a id="13869" href="/DenotSound/#13828" class="Bound">x</a> <a id="13871" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="13873" href="/DenotSound/#13840" class="Bound">v</a>
    <a id="13879" class="Comment">----------------------------------------</a>
  <a id="13922" class="Symbol">→</a> <a id="13924" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="13927" href="/DenotSound/#13927" class="Bound">δ</a> <a id="13929" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="13931" href="/Denot/#7488" class="Function">Env</a> <a id="13935" href="/DenotSound/#13810" class="Bound">Γ</a> <a id="13937" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="13939" href="/DenotSound/#13816" class="Bound">γ</a> <a id="13941" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="13944" href="/DenotSound/#13844" class="Bound">σ</a> <a id="13946" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="13948" href="/DenotSound/#13927" class="Bound">δ</a>  <a id="13951" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="13954" href="/DenotSound/#13927" class="Bound">δ</a> <a id="13956" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="13958" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="13960" href="/DenotSound/#13828" class="Bound">x</a> <a id="13962" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="13964" href="/DenotSound/#13840" class="Bound">v</a>
<a id="13966" href="/DenotSound/#13787" class="Function">subst-reflect-var</a> <a id="13984" class="Symbol">{</a><a id="13985" href="/DenotSound/#13985" class="Bound">Γ</a><a id="13986" class="Symbol">}{</a><a id="13988" href="/DenotSound/#13988" class="Bound">Δ</a><a id="13989" class="Symbol">}{</a><a id="13991" href="/DenotSound/#13991" class="Bound">γ</a><a id="13992" class="Symbol">}{</a><a id="13994" href="/DenotSound/#13994" class="Bound">x</a><a id="13995" class="Symbol">}{</a><a id="13997" href="/DenotSound/#13997" class="Bound">v</a><a id="13998" class="Symbol">}{</a><a id="14000" href="/DenotSound/#14000" class="Bound">σ</a><a id="14001" class="Symbol">}</a> <a id="14003" href="/DenotSound/#14003" class="Bound">xv</a>
  <a id="14008" class="Keyword">rewrite</a> <a id="14016" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14020" class="Symbol">(</a><a id="14021" href="/DenotSound/#12725" class="Function">nth-const-env</a> <a id="14035" class="Symbol">{</a><a id="14036" href="/DenotSound/#13985" class="Bound">Γ</a><a id="14037" class="Symbol">}{</a><a id="14039" href="/DenotSound/#13994" class="Bound">x</a><a id="14040" class="Symbol">}{</a><a id="14042" href="/DenotSound/#13997" class="Bound">v</a><a id="14043" class="Symbol">})</a> <a id="14046" class="Symbol">=</a>
    <a id="14052" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14054" href="/DenotSound/#12492" class="Function">const-env</a> <a id="14064" href="/DenotSound/#13994" class="Bound">x</a> <a id="14066" href="/DenotSound/#13997" class="Bound">v</a> <a id="14068" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14070" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14072" href="/DenotSound/#14105" class="Function">const-env-ok</a> <a id="14085" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14087" href="/Denot/#10045" class="InductiveConstructor">var</a> <a id="14091" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="14093" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
  <a id="14097" class="Keyword">where</a>
  <a id="14105" href="/DenotSound/#14105" class="Function">const-env-ok</a> <a id="14118" class="Symbol">:</a> <a id="14120" href="/DenotSound/#13991" class="Bound">γ</a> <a id="14122" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="14125" href="/DenotSound/#14000" class="Bound">σ</a> <a id="14127" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="14129" href="/DenotSound/#12492" class="Function">const-env</a> <a id="14139" href="/DenotSound/#13994" class="Bound">x</a> <a id="14141" href="/DenotSound/#13997" class="Bound">v</a>
  <a id="14145" href="/DenotSound/#14105" class="Function">const-env-ok</a> <a id="14158" href="/DenotSound/#14158" class="Bound">y</a> <a id="14160" class="Keyword">with</a> <a id="14165" href="/DenotSound/#13994" class="Bound">x</a> <a id="14167" href="/DenotSound/#12126" class="Function Operator">var≟</a> <a id="14172" href="/DenotSound/#14158" class="Bound">y</a>
  <a id="14176" class="Symbol">...</a> <a id="14180" class="Symbol">|</a> <a id="14182" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="14186" href="/DenotSound/#14186" class="Bound">x≡y</a> <a id="14190" class="Keyword">rewrite</a> <a id="14198" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14202" href="/DenotSound/#14186" class="Bound">x≡y</a> <a id="14206" class="Symbol">|</a> <a id="14208" href="/DenotSound/#12725" class="Function">nth-const-env</a> <a id="14222" class="Symbol">{</a><a id="14223" href="/DenotSound/#13985" class="Bound">Γ</a><a id="14224" class="Symbol">}{</a><a id="14226" href="/DenotSound/#13994" class="Bound">x</a><a id="14227" class="Symbol">}{</a><a id="14229" href="/DenotSound/#13997" class="Bound">v</a><a id="14230" class="Symbol">}</a> <a id="14232" class="Symbol">=</a> <a id="14234" href="/DenotSound/#14003" class="Bound">xv</a>
  <a id="14239" class="Symbol">...</a> <a id="14243" class="Symbol">|</a> <a id="14245" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="14248" href="/DenotSound/#14248" class="Bound">x≢y</a> <a id="14252" class="Keyword">rewrite</a> <a id="14260" href="/DenotSound/#12932" class="Function">diff-nth-const-env</a> <a id="14279" class="Symbol">{</a><a id="14280" href="/DenotSound/#13985" class="Bound">Γ</a><a id="14281" class="Symbol">}{</a><a id="14283" href="/DenotSound/#13994" class="Bound">x</a><a id="14284" class="Symbol">}{</a><a id="14286" class="Bound">y</a><a id="14287" class="Symbol">}{</a><a id="14289" href="/DenotSound/#13997" class="Bound">v</a><a id="14290" class="Symbol">}</a> <a id="14292" href="/DenotSound/#14248" class="Bound">x≢y</a> <a id="14296" class="Symbol">=</a> <a id="14298" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a></pre>

<h3 id="substitutions-and-environment-construction">Substitutions and environment construction</h3>

<p>Every substitution produces terms that can evaluate to ⊥.</p>

<pre class="Agda"><a id="subst-⊥"></a><a id="14439" href="/DenotSound/#14439" class="Function">subst-⊥</a> <a id="14447" class="Symbol">:</a> <a id="14449" class="Symbol">∀{</a><a id="14451" href="/DenotSound/#14451" class="Bound">Γ</a> <a id="14453" href="/DenotSound/#14453" class="Bound">Δ</a><a id="14454" class="Symbol">}{</a><a id="14456" href="/DenotSound/#14456" class="Bound">γ</a> <a id="14458" class="Symbol">:</a> <a id="14460" href="/Denot/#7488" class="Function">Env</a> <a id="14464" href="/DenotSound/#14453" class="Bound">Δ</a><a id="14465" class="Symbol">}{</a><a id="14467" href="/DenotSound/#14467" class="Bound">σ</a> <a id="14469" class="Symbol">:</a> <a id="14471" href="/DenotSound/#2467" class="Function">Subst</a> <a id="14477" href="/DenotSound/#14451" class="Bound">Γ</a> <a id="14479" href="/DenotSound/#14453" class="Bound">Δ</a><a id="14480" class="Symbol">}</a>
    <a id="14486" class="Comment">-----------------</a>
  <a id="14506" class="Symbol">→</a> <a id="14508" href="/DenotSound/#14456" class="Bound">γ</a> <a id="14510" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="14513" href="/DenotSound/#14467" class="Bound">σ</a> <a id="14515" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="14517" href="/Denot/#8718" class="Function">`⊥</a>
<a id="14520" href="/DenotSound/#14439" class="Function">subst-⊥</a> <a id="14528" href="/DenotSound/#14528" class="Bound">x</a> <a id="14530" class="Symbol">=</a> <a id="14532" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a></pre>

<p>If a substitution produces terms that evaluate to the values in
both γ₁ and γ₂, then those terms also evaluate to the values in 
γ₁ `⊔ γ₂.</p>

<pre class="Agda"><a id="subst-⊔"></a><a id="14705" href="/DenotSound/#14705" class="Function">subst-⊔</a> <a id="14713" class="Symbol">:</a> <a id="14715" class="Symbol">∀{</a><a id="14717" href="/DenotSound/#14717" class="Bound">Γ</a> <a id="14719" href="/DenotSound/#14719" class="Bound">Δ</a><a id="14720" class="Symbol">}{</a><a id="14722" href="/DenotSound/#14722" class="Bound">γ</a> <a id="14724" class="Symbol">:</a> <a id="14726" href="/Denot/#7488" class="Function">Env</a> <a id="14730" href="/DenotSound/#14719" class="Bound">Δ</a><a id="14731" class="Symbol">}{</a><a id="14733" href="/DenotSound/#14733" class="Bound">γ₁</a> <a id="14736" href="/DenotSound/#14736" class="Bound">γ₂</a> <a id="14739" class="Symbol">:</a> <a id="14741" href="/Denot/#7488" class="Function">Env</a> <a id="14745" href="/DenotSound/#14717" class="Bound">Γ</a><a id="14746" class="Symbol">}{</a><a id="14748" href="/DenotSound/#14748" class="Bound">σ</a> <a id="14750" class="Symbol">:</a> <a id="14752" href="/DenotSound/#2467" class="Function">Subst</a> <a id="14758" href="/DenotSound/#14717" class="Bound">Γ</a> <a id="14760" href="/DenotSound/#14719" class="Bound">Δ</a><a id="14761" class="Symbol">}</a>
           <a id="14774" class="Symbol">→</a> <a id="14776" href="/DenotSound/#14722" class="Bound">γ</a> <a id="14778" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="14781" href="/DenotSound/#14748" class="Bound">σ</a> <a id="14783" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="14785" href="/DenotSound/#14733" class="Bound">γ₁</a>
           <a id="14799" class="Symbol">→</a> <a id="14801" href="/DenotSound/#14722" class="Bound">γ</a> <a id="14803" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="14806" href="/DenotSound/#14748" class="Bound">σ</a> <a id="14808" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="14810" href="/DenotSound/#14736" class="Bound">γ₂</a>
             <a id="14826" class="Comment">-------------------------</a>
           <a id="14863" class="Symbol">→</a> <a id="14865" href="/DenotSound/#14722" class="Bound">γ</a> <a id="14867" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="14870" href="/DenotSound/#14748" class="Bound">σ</a> <a id="14872" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="14874" class="Symbol">(</a><a id="14875" href="/DenotSound/#14733" class="Bound">γ₁</a> <a id="14878" href="/Denot/#8747" class="Function Operator">`⊔</a> <a id="14881" href="/DenotSound/#14736" class="Bound">γ₂</a><a id="14883" class="Symbol">)</a>
<a id="14885" href="/DenotSound/#14705" class="Function">subst-⊔</a> <a id="14893" href="/DenotSound/#14893" class="Bound">γ₁-ok</a> <a id="14899" href="/DenotSound/#14899" class="Bound">γ₂-ok</a> <a id="14905" href="/DenotSound/#14905" class="Bound">x</a> <a id="14907" class="Symbol">=</a> <a id="14909" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="14917" class="Symbol">(</a><a id="14918" href="/DenotSound/#14893" class="Bound">γ₁-ok</a> <a id="14924" href="/DenotSound/#14905" class="Bound">x</a><a id="14925" class="Symbol">)</a> <a id="14927" class="Symbol">(</a><a id="14928" href="/DenotSound/#14899" class="Bound">γ₂-ok</a> <a id="14934" href="/DenotSound/#14905" class="Bound">x</a><a id="14935" class="Symbol">)</a></pre>

<h3 id="the-lambda-constructor-is-injective">The Lambda constructor is injective</h3>

<pre class="Agda"><a id="lambda-inj"></a><a id="15003" href="/DenotSound/#15003" class="Function">lambda-inj</a> <a id="15014" class="Symbol">:</a> <a id="15016" class="Symbol">∀</a> <a id="15018" class="Symbol">{</a><a id="15019" href="/DenotSound/#15019" class="Bound">Γ</a><a id="15020" class="Symbol">}</a> <a id="15022" class="Symbol">{</a><a id="15023" href="/DenotSound/#15023" class="Bound">M</a> <a id="15025" href="/DenotSound/#15025" class="Bound">N</a> <a id="15027" class="Symbol">:</a> <a id="15029" href="/DenotSound/#15019" class="Bound">Γ</a> <a id="15031" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15033" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15035" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15037" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15039" class="Symbol">}</a>
  <a id="15043" class="Symbol">→</a> <a id="15045" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a> <a id="15049" class="Symbol">{</a><a id="15050" class="Argument">A</a> <a id="15052" class="Symbol">=</a> <a id="15054" href="/DenotSound/#15019" class="Bound">Γ</a> <a id="15056" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15058" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15059" class="Symbol">}</a> <a id="15061" class="Symbol">(</a><a id="15062" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15064" href="/DenotSound/#15023" class="Bound">M</a><a id="15065" class="Symbol">)</a> <a id="15067" class="Symbol">(</a><a id="15068" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15070" href="/DenotSound/#15025" class="Bound">N</a><a id="15071" class="Symbol">)</a>
    <a id="15077" class="Comment">---------------------------</a>
  <a id="15107" class="Symbol">→</a> <a id="15109" href="/DenotSound/#15023" class="Bound">M</a> <a id="15111" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="15113" href="/DenotSound/#15025" class="Bound">N</a>
<a id="15115" href="/DenotSound/#15003" class="Function">lambda-inj</a> <a id="15126" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="15131" class="Symbol">=</a> <a id="15133" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<h3 id="simultaneous-substitution-reflects-denotations">Simultaneous substitution reflects denotations</h3>

<p>In this section we prove a central lemma, that
substitution reflects denotations. That is, if γ ⊢ subst σ M ↓ v, then
δ ⊢ M ↓ v and γ `⊢ σ ↓ δ for some δ. We shall proceed by induction on
the derivation of γ ⊢ subst σ M ↓ v. This requires a minor
restatement of the lemma, changing the premise to γ ⊢ L ↓ v and
L ≡ subst σ M.</p>

<pre class="Agda"><a id="split"></a><a id="15542" href="/DenotSound/#15542" class="Function">split</a> <a id="15548" class="Symbol">:</a> <a id="15550" class="Symbol">∀</a> <a id="15552" class="Symbol">{</a><a id="15553" href="/DenotSound/#15553" class="Bound">Γ</a><a id="15554" class="Symbol">}</a> <a id="15556" class="Symbol">{</a><a id="15557" href="/DenotSound/#15557" class="Bound">M</a> <a id="15559" class="Symbol">:</a> <a id="15561" href="/DenotSound/#15553" class="Bound">Γ</a> <a id="15563" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15565" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15567" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15569" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15570" class="Symbol">}</a> <a id="15572" class="Symbol">{</a><a id="15573" href="/DenotSound/#15573" class="Bound">δ</a> <a id="15575" class="Symbol">:</a> <a id="15577" href="/Denot/#7488" class="Function">Env</a> <a id="15581" class="Symbol">(</a><a id="15582" href="/DenotSound/#15553" class="Bound">Γ</a> <a id="15584" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15586" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15587" class="Symbol">)}</a> <a id="15590" class="Symbol">{</a><a id="15591" href="/DenotSound/#15591" class="Bound">v</a><a id="15592" class="Symbol">}</a>
  <a id="15596" class="Symbol">→</a> <a id="15598" href="/DenotSound/#15573" class="Bound">δ</a> <a id="15600" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="15602" href="/DenotSound/#15557" class="Bound">M</a> <a id="15604" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="15606" href="/DenotSound/#15591" class="Bound">v</a>
    <a id="15612" class="Comment">--------------------------</a>
  <a id="15641" class="Symbol">→</a> <a id="15643" class="Symbol">(</a><a id="15644" href="/Denot/#7899" class="Function">init</a> <a id="15649" href="/DenotSound/#15573" class="Bound">δ</a> <a id="15651" href="/Denot/#7646" class="Function Operator">`,</a> <a id="15654" href="/Denot/#7954" class="Function">last</a> <a id="15659" href="/DenotSound/#15573" class="Bound">δ</a><a id="15660" class="Symbol">)</a> <a id="15662" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="15664" href="/DenotSound/#15557" class="Bound">M</a> <a id="15666" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="15668" href="/DenotSound/#15591" class="Bound">v</a>
<a id="15670" href="/DenotSound/#15542" class="Function">split</a> <a id="15676" class="Symbol">{</a><a id="15677" class="Argument">δ</a> <a id="15679" class="Symbol">=</a> <a id="15681" href="/DenotSound/#15681" class="Bound">δ</a><a id="15682" class="Symbol">}</a> <a id="15684" href="/DenotSound/#15684" class="Bound">δMv</a> <a id="15688" class="Keyword">rewrite</a> <a id="15696" href="/Denot/#8003" class="Function">init-last</a> <a id="15706" href="/DenotSound/#15681" class="Bound">δ</a> <a id="15708" class="Symbol">=</a> <a id="15710" href="/DenotSound/#15684" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="15715" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="15729" class="Symbol">:</a> <a id="15731" class="Symbol">∀</a> <a id="15733" class="Symbol">{</a><a id="15734" href="/DenotSound/#15734" class="Bound">Γ</a> <a id="15736" href="/DenotSound/#15736" class="Bound">Δ</a><a id="15737" class="Symbol">}</a> <a id="15739" class="Symbol">{</a><a id="15740" href="/DenotSound/#15740" class="Bound">δ</a> <a id="15742" class="Symbol">:</a> <a id="15744" href="/Denot/#7488" class="Function">Env</a> <a id="15748" href="/DenotSound/#15736" class="Bound">Δ</a><a id="15749" class="Symbol">}</a> <a id="15751" class="Symbol">{</a><a id="15752" href="/DenotSound/#15752" class="Bound">M</a> <a id="15754" class="Symbol">:</a> <a id="15756" href="/DenotSound/#15734" class="Bound">Γ</a> <a id="15758" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15760" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15761" class="Symbol">}</a> <a id="15763" class="Symbol">{</a><a id="15764" href="/DenotSound/#15764" class="Bound">v</a><a id="15765" class="Symbol">}</a> <a id="15767" class="Symbol">{</a><a id="15768" href="/DenotSound/#15768" class="Bound">L</a> <a id="15770" class="Symbol">:</a> <a id="15772" href="/DenotSound/#15736" class="Bound">Δ</a> <a id="15774" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15776" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15777" class="Symbol">}</a> <a id="15779" class="Symbol">{</a><a id="15780" href="/DenotSound/#15780" class="Bound">σ</a> <a id="15782" class="Symbol">:</a> <a id="15784" href="/DenotSound/#2467" class="Function">Subst</a> <a id="15790" href="/DenotSound/#15734" class="Bound">Γ</a> <a id="15792" href="/DenotSound/#15736" class="Bound">Δ</a><a id="15793" class="Symbol">}</a>
  <a id="15797" class="Symbol">→</a> <a id="15799" href="/DenotSound/#15740" class="Bound">δ</a> <a id="15801" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="15803" href="/DenotSound/#15768" class="Bound">L</a> <a id="15805" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="15807" href="/DenotSound/#15764" class="Bound">v</a>
  <a id="15811" class="Symbol">→</a> <a id="15813" href="/Untyped/#6931" class="Function">subst</a> <a id="15819" href="/DenotSound/#15780" class="Bound">σ</a> <a id="15821" href="/DenotSound/#15752" class="Bound">M</a> <a id="15823" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="15825" href="/DenotSound/#15768" class="Bound">L</a>
    <a id="15831" class="Comment">---------------------------------------</a>
  <a id="15873" class="Symbol">→</a> <a id="15875" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="15878" href="/DenotSound/#15878" class="Bound">γ</a> <a id="15880" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="15882" href="/Denot/#7488" class="Function">Env</a> <a id="15886" href="/DenotSound/#15734" class="Bound">Γ</a> <a id="15888" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="15890" href="/DenotSound/#15740" class="Bound">δ</a> <a id="15892" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="15895" href="/DenotSound/#15780" class="Bound">σ</a> <a id="15897" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="15899" href="/DenotSound/#15878" class="Bound">γ</a>  <a id="15902" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="15905" href="/DenotSound/#15878" class="Bound">γ</a> <a id="15907" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="15909" href="/DenotSound/#15752" class="Bound">M</a> <a id="15911" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="15913" href="/DenotSound/#15764" class="Bound">v</a>

<a id="15916" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="15930" class="Symbol">{</a><a id="15931" class="Argument">M</a> <a id="15933" class="Symbol">=</a> <a id="15935" href="/DenotSound/#15935" class="Bound">M</a><a id="15936" class="Symbol">}{</a><a id="15938" class="Argument">σ</a> <a id="15940" class="Symbol">=</a> <a id="15942" href="/DenotSound/#15942" class="Bound">σ</a><a id="15943" class="Symbol">}</a> <a id="15945" class="Symbol">(</a><a id="15946" href="/Denot/#10045" class="InductiveConstructor">var</a> <a id="15950" class="Symbol">{</a><a id="15951" class="Argument">x</a> <a id="15953" class="Symbol">=</a> <a id="15955" href="/DenotSound/#15955" class="Bound">y</a><a id="15956" class="Symbol">})</a> <a id="15959" href="/DenotSound/#15959" class="Bound">eqL</a> <a id="15963" class="Keyword">with</a> <a id="15968" href="/DenotSound/#15935" class="Bound">M</a> 
<a id="15971" class="Symbol">...</a> <a id="15975" class="Symbol">|</a> <a id="15977" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="15979" href="/DenotSound/#15979" class="Bound">x</a>  <a id="15982" class="Keyword">with</a> <a id="15987" href="/Denot/#10045" class="InductiveConstructor">var</a> <a id="15991" class="Symbol">{</a><a id="15992" class="Argument">x</a> <a id="15994" class="Symbol">=</a> <a id="15996" class="Bound">y</a><a id="15997" class="Symbol">}</a>
<a id="15999" class="Symbol">...</a>           <a id="16013" class="Symbol">|</a> <a id="16015" href="/DenotSound/#16015" class="Bound">yv</a>  <a id="16019" class="Keyword">rewrite</a> <a id="16027" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16031" class="Bound">eqL</a> <a id="16035" class="Symbol">=</a> <a id="16037" href="/DenotSound/#13787" class="Function">subst-reflect-var</a> <a id="16055" class="Symbol">{</a><a id="16056" class="Argument">σ</a> <a id="16058" class="Symbol">=</a> <a id="16060" class="Bound">σ</a><a id="16061" class="Symbol">}</a> <a id="16063" href="/DenotSound/#16015" class="Bound">yv</a>
<a id="16066" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="16080" class="Symbol">{</a><a id="16081" class="Argument">M</a> <a id="16083" class="Symbol">=</a> <a id="16085" href="/DenotSound/#16085" class="Bound">M</a><a id="16086" class="Symbol">}</a> <a id="16088" class="Symbol">(</a><a id="16089" href="/Denot/#10045" class="InductiveConstructor">var</a> <a id="16093" class="Symbol">{</a><a id="16094" class="Argument">x</a> <a id="16096" class="Symbol">=</a> <a id="16098" href="/DenotSound/#16098" class="Bound">y</a><a id="16099" class="Symbol">})</a> <a id="16102" class="Symbol">()</a> <a id="16105" class="Symbol">|</a> <a id="16107" href="/DenotSound/#16107" class="Bound">M₁</a> <a id="16110" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16112" href="/DenotSound/#16112" class="Bound">M₂</a>
<a id="16115" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="16129" class="Symbol">{</a><a id="16130" class="Argument">M</a> <a id="16132" class="Symbol">=</a> <a id="16134" href="/DenotSound/#16134" class="Bound">M</a><a id="16135" class="Symbol">}</a> <a id="16137" class="Symbol">(</a><a id="16138" href="/Denot/#10045" class="InductiveConstructor">var</a> <a id="16142" class="Symbol">{</a><a id="16143" class="Argument">x</a> <a id="16145" class="Symbol">=</a> <a id="16147" href="/DenotSound/#16147" class="Bound">y</a><a id="16148" class="Symbol">})</a> <a id="16151" class="Symbol">()</a> <a id="16154" class="Symbol">|</a> <a id="16156" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16158" href="/DenotSound/#16158" class="Bound">M&#39;</a>

<a id="16162" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="16176" class="Symbol">{</a><a id="16177" class="Argument">M</a> <a id="16179" class="Symbol">=</a> <a id="16181" href="/DenotSound/#16181" class="Bound">M</a><a id="16182" class="Symbol">}{</a><a id="16184" class="Argument">σ</a> <a id="16186" class="Symbol">=</a> <a id="16188" href="/DenotSound/#16188" class="Bound">σ</a><a id="16189" class="Symbol">}</a> <a id="16191" class="Symbol">(</a><a id="16192" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="16199" href="/DenotSound/#16199" class="Bound">d₁</a> <a id="16202" href="/DenotSound/#16202" class="Bound">d₂</a><a id="16204" class="Symbol">)</a> <a id="16206" href="/DenotSound/#16206" class="Bound">eqL</a>
         <a id="16219" class="Keyword">with</a> <a id="16224" href="/DenotSound/#16181" class="Bound">M</a> 
<a id="16227" class="Symbol">...</a>    <a id="16234" class="Symbol">|</a> <a id="16236" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16238" href="/DenotSound/#16238" class="Bound">x</a> <a id="16240" class="Keyword">with</a> <a id="16245" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="16252" class="Bound">d₁</a> <a id="16255" class="Bound">d₂</a> 
<a id="16259" class="Symbol">...</a>    <a id="16266" class="Symbol">|</a> <a id="16268" href="/DenotSound/#16268" class="Bound">d&#39;</a> <a id="16271" class="Keyword">rewrite</a> <a id="16279" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16283" class="Bound">eqL</a> <a id="16287" class="Symbol">=</a> <a id="16289" href="/DenotSound/#13787" class="Function">subst-reflect-var</a> <a id="16307" class="Symbol">{</a><a id="16308" class="Argument">σ</a> <a id="16310" class="Symbol">=</a> <a id="16312" class="Bound">σ</a><a id="16313" class="Symbol">}</a> <a id="16315" href="/DenotSound/#16268" class="Bound">d&#39;</a>
<a id="16318" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="16332" class="Symbol">(</a><a id="16333" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="16340" href="/DenotSound/#16340" class="Bound">d₁</a> <a id="16343" href="/DenotSound/#16343" class="Bound">d₂</a><a id="16345" class="Symbol">)</a> <a id="16347" class="Symbol">()</a> <a id="16350" class="Symbol">|</a> <a id="16352" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16354" href="/DenotSound/#16354" class="Bound">M&#39;</a>
<a id="16357" href="/DenotSound/#15715" class="Function">subst-reflect</a><a id="16370" class="Symbol">{</a><a id="16371" href="/DenotSound/#16371" class="Bound">Γ</a><a id="16372" class="Symbol">}{</a><a id="16374" href="/DenotSound/#16374" class="Bound">Δ</a><a id="16375" class="Symbol">}{</a><a id="16377" href="/DenotSound/#16377" class="Bound">γ</a><a id="16378" class="Symbol">}{</a><a id="16380" class="Argument">σ</a> <a id="16382" class="Symbol">=</a> <a id="16384" href="/DenotSound/#16384" class="Bound">σ</a><a id="16385" class="Symbol">}</a> <a id="16387" class="Symbol">(</a><a id="16388" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="16395" href="/DenotSound/#16395" class="Bound">d₁</a> <a id="16398" href="/DenotSound/#16398" class="Bound">d₂</a><a id="16400" class="Symbol">)</a>
   <a id="16405" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16410" class="Symbol">|</a> <a id="16412" href="/DenotSound/#16412" class="Bound">M₁</a> <a id="16415" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16417" href="/DenotSound/#16417" class="Bound">M₂</a>
     <a id="16425" class="Keyword">with</a> <a id="16430" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="16444" class="Symbol">{</a><a id="16445" class="Argument">M</a> <a id="16447" class="Symbol">=</a> <a id="16449" href="/DenotSound/#16412" class="Bound">M₁</a><a id="16451" class="Symbol">}</a> <a id="16453" href="/DenotSound/#16395" class="Bound">d₁</a> <a id="16456" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16461" class="Symbol">|</a> <a id="16463" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="16477" class="Symbol">{</a><a id="16478" class="Argument">M</a> <a id="16480" class="Symbol">=</a> <a id="16482" href="/DenotSound/#16417" class="Bound">M₂</a><a id="16484" class="Symbol">}</a> <a id="16486" href="/DenotSound/#16398" class="Bound">d₂</a> <a id="16489" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="16494" class="Symbol">...</a>     <a id="16502" class="Symbol">|</a> <a id="16504" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16506" href="/DenotSound/#16506" class="Bound">δ₁</a> <a id="16509" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16511" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16513" href="/DenotSound/#16513" class="Bound">subst-δ₁</a> <a id="16522" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16524" href="/DenotSound/#16524" class="Bound">m1</a> <a id="16527" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16529" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16531" class="Symbol">|</a> <a id="16533" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16535" href="/DenotSound/#16535" class="Bound">δ₂</a> <a id="16538" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16540" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16542" href="/DenotSound/#16542" class="Bound">subst-δ₂</a> <a id="16551" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16553" href="/DenotSound/#16553" class="Bound">m2</a> <a id="16556" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16558" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16560" class="Symbol">=</a>
     <a id="16567" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16569" href="/DenotSound/#16506" class="Bound">δ₁</a> <a id="16572" href="/Denot/#8747" class="Function Operator">`⊔</a> <a id="16575" href="/DenotSound/#16535" class="Bound">δ₂</a> <a id="16578" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16580" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16582" href="/DenotSound/#14705" class="Function">subst-⊔</a> <a id="16590" class="Symbol">{</a><a id="16591" class="Argument">γ₁</a> <a id="16594" class="Symbol">=</a> <a id="16596" href="/DenotSound/#16506" class="Bound">δ₁</a><a id="16598" class="Symbol">}{</a><a id="16600" class="Argument">γ₂</a> <a id="16603" class="Symbol">=</a> <a id="16605" href="/DenotSound/#16535" class="Bound">δ₂</a><a id="16607" class="Symbol">}{</a><a id="16609" class="Argument">σ</a> <a id="16611" class="Symbol">=</a> <a id="16613" class="Bound">σ</a><a id="16614" class="Symbol">}</a> <a id="16616" href="/DenotSound/#16513" class="Bound">subst-δ₁</a> <a id="16625" href="/DenotSound/#16542" class="Bound">subst-δ₂</a> <a id="16634" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="16656" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="16663" class="Symbol">(</a><a id="16664" href="/Denot/#26210" class="Function">Env⊑</a> <a id="16669" href="/DenotSound/#16524" class="Bound">m1</a> <a id="16672" class="Symbol">(</a><a id="16673" href="/Denot/#9071" class="Function">EnvConjR1⊑</a> <a id="16684" href="/DenotSound/#16506" class="Bound">δ₁</a> <a id="16687" href="/DenotSound/#16535" class="Bound">δ₂</a><a id="16689" class="Symbol">))</a>
                           <a id="16719" class="Symbol">(</a><a id="16720" href="/Denot/#26210" class="Function">Env⊑</a> <a id="16725" href="/DenotSound/#16553" class="Bound">m2</a> <a id="16728" class="Symbol">(</a><a id="16729" href="/Denot/#9168" class="Function">EnvConjR2⊑</a> <a id="16740" href="/DenotSound/#16506" class="Bound">δ₁</a> <a id="16743" href="/DenotSound/#16535" class="Bound">δ₂</a><a id="16745" class="Symbol">))</a> <a id="16748" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16750" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="16753" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="16767" class="Symbol">{</a><a id="16768" class="Argument">M</a> <a id="16770" class="Symbol">=</a> <a id="16772" href="/DenotSound/#16772" class="Bound">M</a><a id="16773" class="Symbol">}{</a><a id="16775" class="Argument">σ</a> <a id="16777" class="Symbol">=</a> <a id="16779" href="/DenotSound/#16779" class="Bound">σ</a><a id="16780" class="Symbol">}</a> <a id="16782" class="Symbol">(</a><a id="16783" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="16791" href="/DenotSound/#16791" class="Bound">d</a><a id="16792" class="Symbol">)</a> <a id="16794" href="/DenotSound/#16794" class="Bound">eqL</a> <a id="16798" class="Keyword">with</a> <a id="16803" href="/DenotSound/#16772" class="Bound">M</a>
<a id="16805" class="Symbol">...</a>    <a id="16812" class="Symbol">|</a> <a id="16814" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16816" href="/DenotSound/#16816" class="Bound">x</a> <a id="16818" class="Keyword">with</a> <a id="16823" class="Symbol">(</a><a id="16824" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="16832" class="Bound">d</a><a id="16833" class="Symbol">)</a>
<a id="16835" class="Symbol">...</a>             <a id="16851" class="Symbol">|</a> <a id="16853" href="/DenotSound/#16853" class="Bound">d&#39;</a> <a id="16856" class="Keyword">rewrite</a> <a id="16864" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16868" class="Bound">eqL</a> <a id="16872" class="Symbol">=</a> <a id="16874" href="/DenotSound/#13787" class="Function">subst-reflect-var</a> <a id="16892" class="Symbol">{</a><a id="16893" class="Argument">σ</a> <a id="16895" class="Symbol">=</a> <a id="16897" class="Bound">σ</a><a id="16898" class="Symbol">}</a> <a id="16900" href="/DenotSound/#16853" class="Bound">d&#39;</a>
<a id="16903" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="16917" class="Symbol">{</a><a id="16918" class="Argument">σ</a> <a id="16920" class="Symbol">=</a> <a id="16922" href="/DenotSound/#16922" class="Bound">σ</a><a id="16923" class="Symbol">}</a> <a id="16925" class="Symbol">(</a><a id="16926" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="16934" href="/DenotSound/#16934" class="Bound">d</a><a id="16935" class="Symbol">)</a> <a id="16937" href="/DenotSound/#16937" class="Bound">eq</a> <a id="16940" class="Symbol">|</a> <a id="16942" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16944" href="/DenotSound/#16944" class="Bound">M&#39;</a>
      <a id="16953" class="Keyword">with</a> <a id="16958" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="16972" class="Symbol">{</a><a id="16973" class="Argument">σ</a> <a id="16975" class="Symbol">=</a> <a id="16977" href="/Untyped/#6623" class="Function">exts</a> <a id="16982" href="/DenotSound/#16922" class="Bound">σ</a><a id="16983" class="Symbol">}</a> <a id="16985" href="/DenotSound/#16934" class="Bound">d</a> <a id="16987" class="Symbol">(</a><a id="16988" href="/DenotSound/#15003" class="Function">lambda-inj</a> <a id="16999" href="/DenotSound/#16937" class="Bound">eq</a><a id="17001" class="Symbol">)</a>
<a id="17003" class="Symbol">...</a> <a id="17007" class="Symbol">|</a> <a id="17009" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17011" href="/DenotSound/#17011" class="Bound">δ′</a> <a id="17014" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17016" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17018" href="/DenotSound/#17018" class="Bound">exts-σ-δ′</a> <a id="17028" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17030" href="/DenotSound/#17030" class="Bound">m′</a> <a id="17033" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17035" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17037" class="Symbol">=</a> 
    <a id="17044" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17046" href="/Denot/#7899" class="Function">init</a> <a id="17051" href="/DenotSound/#17011" class="Bound">δ′</a> <a id="17054" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17056" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17058" class="Symbol">((λ</a> <a id="17062" href="/DenotSound/#17062" class="Bound">x</a> <a id="17064" class="Symbol">→</a> <a id="17066" href="/DenotSound/#10980" class="Function">rename-inc-reflect</a> <a id="17085" class="Symbol">(</a><a id="17086" href="/DenotSound/#17018" class="Bound">exts-σ-δ′</a> <a id="17096" class="Symbol">(</a><a id="17097" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="17099" href="/DenotSound/#17062" class="Bound">x</a><a id="17100" class="Symbol">))))</a> <a id="17105" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
             <a id="17120" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="17128" class="Symbol">(</a><a id="17129" href="/Denot/#26642" class="Function">up-env</a> <a id="17136" class="Symbol">(</a><a id="17137" href="/DenotSound/#15542" class="Function">split</a> <a id="17143" href="/DenotSound/#17030" class="Bound">m′</a><a id="17145" class="Symbol">)</a> <a id="17147" class="Symbol">(</a><a id="17148" href="/DenotCompositional/#9278" class="Function">var-inv</a> <a id="17156" class="Symbol">(</a><a id="17157" href="/DenotSound/#17018" class="Bound">exts-σ-δ′</a> <a id="17167" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="17168" class="Symbol">)))</a> <a id="17172" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17174" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17176" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="17190" class="Symbol">(</a><a id="17191" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="17199" href="/DenotSound/#17199" class="Bound">d</a><a id="17200" class="Symbol">)</a> <a id="17202" class="Symbol">()</a> <a id="17205" class="Symbol">|</a> <a id="17207" href="/DenotSound/#17207" class="Bound">M₁</a> <a id="17210" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="17212" href="/DenotSound/#17212" class="Bound">M₂</a> 

<a id="17217" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="17231" class="Symbol">{</a><a id="17232" class="Argument">σ</a> <a id="17234" class="Symbol">=</a> <a id="17236" href="/DenotSound/#17236" class="Bound">σ</a><a id="17237" class="Symbol">}</a> <a id="17239" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a> <a id="17247" href="/DenotSound/#17247" class="Bound">eq</a> <a id="17250" class="Symbol">=</a>
    <a id="17256" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17258" href="/Denot/#8718" class="Function">`⊥</a> <a id="17261" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17263" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17265" href="/DenotSound/#14439" class="Function">subst-⊥</a> <a id="17273" class="Symbol">{</a><a id="17274" class="Argument">σ</a> <a id="17276" class="Symbol">=</a> <a id="17278" href="/DenotSound/#17236" class="Bound">σ</a><a id="17279" class="Symbol">}</a> <a id="17281" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17283" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a> <a id="17291" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17293" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="17296" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="17310" class="Symbol">{</a><a id="17311" class="Argument">σ</a> <a id="17313" class="Symbol">=</a> <a id="17315" href="/DenotSound/#17315" class="Bound">σ</a><a id="17316" class="Symbol">}</a> <a id="17318" class="Symbol">(</a><a id="17319" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="17327" href="/DenotSound/#17327" class="Bound">d₁</a> <a id="17330" href="/DenotSound/#17330" class="Bound">d₂</a><a id="17332" class="Symbol">)</a> <a id="17334" href="/DenotSound/#17334" class="Bound">eq</a>
  <a id="17339" class="Keyword">with</a> <a id="17344" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="17358" class="Symbol">{</a><a id="17359" class="Argument">σ</a> <a id="17361" class="Symbol">=</a> <a id="17363" href="/DenotSound/#17315" class="Bound">σ</a><a id="17364" class="Symbol">}</a> <a id="17366" href="/DenotSound/#17327" class="Bound">d₁</a> <a id="17369" href="/DenotSound/#17334" class="Bound">eq</a> <a id="17372" class="Symbol">|</a> <a id="17374" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="17388" class="Symbol">{</a><a id="17389" class="Argument">σ</a> <a id="17391" class="Symbol">=</a> <a id="17393" href="/DenotSound/#17315" class="Bound">σ</a><a id="17394" class="Symbol">}</a> <a id="17396" href="/DenotSound/#17330" class="Bound">d₂</a> <a id="17399" href="/DenotSound/#17334" class="Bound">eq</a>
<a id="17402" class="Symbol">...</a> <a id="17406" class="Symbol">|</a> <a id="17408" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17410" href="/DenotSound/#17410" class="Bound">δ₁</a> <a id="17413" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17415" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17417" href="/DenotSound/#17417" class="Bound">subst-δ₁</a> <a id="17426" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17428" href="/DenotSound/#17428" class="Bound">m1</a> <a id="17431" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17433" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17435" class="Symbol">|</a> <a id="17437" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17439" href="/DenotSound/#17439" class="Bound">δ₂</a> <a id="17442" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17444" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17446" href="/DenotSound/#17446" class="Bound">subst-δ₂</a> <a id="17455" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17457" href="/DenotSound/#17457" class="Bound">m2</a> <a id="17460" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17462" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17464" class="Symbol">=</a>
     <a id="17471" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17473" href="/DenotSound/#17410" class="Bound">δ₁</a> <a id="17476" href="/Denot/#8747" class="Function Operator">`⊔</a> <a id="17479" href="/DenotSound/#17439" class="Bound">δ₂</a> <a id="17482" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17484" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17486" href="/DenotSound/#14705" class="Function">subst-⊔</a> <a id="17494" class="Symbol">{</a><a id="17495" class="Argument">γ₁</a> <a id="17498" class="Symbol">=</a> <a id="17500" href="/DenotSound/#17410" class="Bound">δ₁</a><a id="17502" class="Symbol">}{</a><a id="17504" class="Argument">γ₂</a> <a id="17507" class="Symbol">=</a> <a id="17509" href="/DenotSound/#17439" class="Bound">δ₂</a><a id="17511" class="Symbol">}{</a><a id="17513" class="Argument">σ</a> <a id="17515" class="Symbol">=</a> <a id="17517" class="Bound">σ</a><a id="17518" class="Symbol">}</a> <a id="17520" href="/DenotSound/#17417" class="Bound">subst-δ₁</a> <a id="17529" href="/DenotSound/#17446" class="Bound">subst-δ₂</a> <a id="17538" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="17560" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="17568" class="Symbol">(</a><a id="17569" href="/Denot/#26210" class="Function">Env⊑</a> <a id="17574" href="/DenotSound/#17428" class="Bound">m1</a> <a id="17577" class="Symbol">(</a><a id="17578" href="/Denot/#9071" class="Function">EnvConjR1⊑</a> <a id="17589" href="/DenotSound/#17410" class="Bound">δ₁</a> <a id="17592" href="/DenotSound/#17439" class="Bound">δ₂</a><a id="17594" class="Symbol">))</a>
                            <a id="17625" class="Symbol">(</a><a id="17626" href="/Denot/#26210" class="Function">Env⊑</a> <a id="17631" href="/DenotSound/#17457" class="Bound">m2</a> <a id="17634" class="Symbol">(</a><a id="17635" href="/Denot/#9168" class="Function">EnvConjR2⊑</a> <a id="17646" href="/DenotSound/#17410" class="Bound">δ₁</a> <a id="17649" href="/DenotSound/#17439" class="Bound">δ₂</a><a id="17651" class="Symbol">))</a> <a id="17654" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17656" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17658" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="17672" class="Symbol">(</a><a id="17673" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="17677" href="/DenotSound/#17677" class="Bound">d</a> <a id="17679" href="/DenotSound/#17679" class="Bound">lt</a><a id="17681" class="Symbol">)</a> <a id="17683" href="/DenotSound/#17683" class="Bound">eq</a> 
    <a id="17691" class="Keyword">with</a> <a id="17696" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="17710" href="/DenotSound/#17677" class="Bound">d</a> <a id="17712" href="/DenotSound/#17683" class="Bound">eq</a>
<a id="17715" class="Symbol">...</a> <a id="17719" class="Symbol">|</a> <a id="17721" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17723" href="/DenotSound/#17723" class="Bound">δ</a> <a id="17725" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17727" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17729" href="/DenotSound/#17729" class="Bound">subst-δ</a> <a id="17737" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17739" href="/DenotSound/#17739" class="Bound">m</a> <a id="17741" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17743" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17745" class="Symbol">=</a> <a id="17747" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17749" href="/DenotSound/#17723" class="Bound">δ</a> <a id="17751" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17753" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17755" href="/DenotSound/#17729" class="Bound">subst-δ</a> <a id="17763" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17765" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="17769" href="/DenotSound/#17739" class="Bound">m</a> <a id="17771" class="Bound">lt</a> <a id="17774" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17776" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<ul>
  <li>
    <p>Case (var): We have subst σ M ≡ ` y, so M must also be a variable, say x.
We apply the lemma subst-reflect-var to conclude.</p>
  </li>
  <li>Case (↦-elim): We have subst σ M ≡ L₁ · L₂. We proceed by cases on M.
    <ul>
      <li>
        <p>Case M ≡ ` x: We apply the subst-reflect-var lemma again to conclude.</p>
      </li>
      <li>
        <p>Case M ≡ M₁ · M₂: By the induction hypothesis, we have
some δ₁ and δ₂ such that δ₁ ⊢ M₁ ↓ v₁ ↦ v₃ and γ <code class="highlighter-rouge">⊢ σ ↓ δ₁,
as well as δ₂ ⊢ M₂ ↓ v₁ and γ </code>⊢ σ ↓ δ₂.
By Env⊑ we have  δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃ and δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁
(using EnvConjR1⊑ and EnvConjR2⊑), and therefore δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃.
We conclude this case by obtaining γ ⊢ σ ↓ δ₁ ⊔ δ₂
by the subst-⊔ lemma.</p>
      </li>
    </ul>
  </li>
  <li>Case (↦-intro): We have subst σ M ≡ ƛ L’. We proceed by cases on M.
    <ul>
      <li>
        <p>Case M ≡ ` x: We apply the subst-reflect-var lemma.</p>
      </li>
      <li>
        <p>Case M ≡ ƛ M’: By the induction hypothesis, we have
(δ’ , v’) ⊢ M’ ↓ v₂ and (δ , v₁) ⊢ exts σ ↓ (δ’ , v’).
From the later we have (δ , v₁) ⊢ # 0 ↓ v’.
By the lemma var-inv we have v’ ⊑ v₁, so by the up-env lemma we
have (δ’ , v₁) ⊢ M’ ↓ v₂ and therefore δ’ ⊢ ƛ M’ ↓ v₁ → v₂.  We
also need to show that δ `⊢ σ ↓ δ’.  Fix k. We have (δ , v₁) ⊢
rename S_ σ k ↓ nth k δ’.  We then apply the lemma
rename-inc-reflect to obtain δ ⊢ σ k ↓ nth k δ’, so this case is
complete.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Case (⊥-intro): We choose ⊥ for δ.
We have ⊥ ⊢ M ↓ ⊥ by (⊥-intro).
We have δ ⊢ σ ↓ ⊥ by the lemma subst-empty.</p>
  </li>
  <li>Case (⊔-intro): By the induction hypothesis we have
δ₁ ⊢ M ↓ v₁, δ₂ ⊢ M ↓ v₂, δ ⊢ σ ↓ δ₁, and δ ⊢ σ ↓ δ₂.
We have δ₁ ⊔ δ₂ ⊢ M ↓ v₁ and δ₁ ⊔ δ₂ ⊢ M ↓ v₂
by Env⊑ with EnvConjR1⊑ and EnvConjR2⊑.
So by (⊔-intro) we have δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂.
By subst-⊔ we conclude that δ ⊢ σ ↓ δ₁ ⊔ δ₂.</li>
</ul>

<h3 id="single-substitution-reflects-denotations">Single substitution reflects denotations</h3>

<p>Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, β reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
give terms M : (Γ , ★ ⊢ ★) and N : (Γ ⊢ ★,)
if γ ⊢ M [ N ] ↓ v, then γ ⊢ N ↓ v₂ and (γ , v₂) ⊢ M ↓ v
for some value v₂. We have M [ N ] = subst (subst-zero N) M.
We apply the subst-reflect lemma to obtain
γ `⊢ subst-zero N ↓ (δ’ , v’) and (δ’ , v’) ⊢ M ↓ v
for some δ’ and v’.</p>

<p>Instantiating γ `⊢ subst-zero N ↓ (δ’ , v’) at k = 0
gives us γ ⊢ N ↓ v’. We choose v₂ = v’, so the first
part of our conclusion is complete.</p>

<p>It remains to prove (γ , v’) ⊢ M ↓ v. First, we obtain 
(γ , v’) ⊢ rename var-id M ↓ v by the rename-pres lemma
applied to (δ’ , v’) ⊢ M ↓ v, with the var-id renaming,
γ = (δ’ , v’), and δ = (γ , v’). To apply this lemma,
we need to show that 
nth n (δ’ , v’) ⊑ nth (var-id n) (γ , v’) for any n.
This is accomplished by the following lemma, which
makes use of γ `⊢ subst-zero N ↓ (δ’ , v’).</p>

<pre class="Agda"><a id="nth-id-le"></a><a id="20626" href="/DenotSound/#20626" class="Function">nth-id-le</a> <a id="20636" class="Symbol">:</a> <a id="20638" class="Symbol">∀{</a><a id="20640" href="/DenotSound/#20640" class="Bound">Γ</a><a id="20641" class="Symbol">}{</a><a id="20643" href="/DenotSound/#20643" class="Bound">δ&#39;</a><a id="20645" class="Symbol">}{</a><a id="20647" href="/DenotSound/#20647" class="Bound">v&#39;</a><a id="20649" class="Symbol">}{</a><a id="20651" href="/DenotSound/#20651" class="Bound">γ</a><a id="20652" class="Symbol">}{</a><a id="20654" href="/DenotSound/#20654" class="Bound">N</a><a id="20655" class="Symbol">}</a>
      <a id="20663" class="Symbol">→</a> <a id="20665" href="/DenotSound/#20651" class="Bound">γ</a> <a id="20667" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="20670" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="20681" href="/DenotSound/#20654" class="Bound">N</a> <a id="20683" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="20685" class="Symbol">(</a><a id="20686" href="/DenotSound/#20643" class="Bound">δ&#39;</a> <a id="20689" href="/Denot/#7646" class="Function Operator">`,</a> <a id="20692" href="/DenotSound/#20647" class="Bound">v&#39;</a><a id="20694" class="Symbol">)</a>
        <a id="20704" class="Comment">-----------------------------------------------------</a>
      <a id="20764" class="Symbol">→</a> <a id="20766" class="Symbol">(</a><a id="20767" href="/DenotSound/#20767" class="Bound">x</a> <a id="20769" class="Symbol">:</a> <a id="20771" href="/DenotSound/#20640" class="Bound">Γ</a> <a id="20773" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="20775" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="20777" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="20779" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="20780" class="Symbol">)</a> <a id="20782" class="Symbol">→</a> <a id="20784" class="Symbol">(</a><a id="20785" href="/DenotSound/#20643" class="Bound">δ&#39;</a> <a id="20788" href="/Denot/#7646" class="Function Operator">`,</a> <a id="20791" href="/DenotSound/#20647" class="Bound">v&#39;</a><a id="20793" class="Symbol">)</a> <a id="20795" href="/DenotSound/#20767" class="Bound">x</a> <a id="20797" href="/Denot/#4466" class="Datatype Operator">⊑</a> <a id="20799" class="Symbol">(</a><a id="20800" href="/DenotSound/#20651" class="Bound">γ</a> <a id="20802" href="/Denot/#7646" class="Function Operator">`,</a> <a id="20805" href="/DenotSound/#20647" class="Bound">v&#39;</a><a id="20807" class="Symbol">)</a> <a id="20809" class="Symbol">(</a><a id="20810" href="/Denot/#25868" class="Function">var-id</a> <a id="20817" href="/DenotSound/#20767" class="Bound">x</a><a id="20818" class="Symbol">)</a> 
<a id="20821" href="/DenotSound/#20626" class="Function">nth-id-le</a> <a id="20831" href="/DenotSound/#20831" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="20841" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="20843" class="Symbol">=</a> <a id="20845" href="/Denot/#5698" class="Function">Refl⊑</a>
<a id="20851" href="/DenotSound/#20626" class="Function">nth-id-le</a> <a id="20861" href="/DenotSound/#20861" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="20871" class="Symbol">(</a><a id="20872" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="20874" href="/DenotSound/#20874" class="Bound">n&#39;</a><a id="20876" class="Symbol">)</a> <a id="20878" class="Symbol">=</a> <a id="20880" href="/DenotCompositional/#9278" class="Function">var-inv</a> <a id="20888" class="Symbol">(</a><a id="20889" href="/DenotSound/#20861" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="20899" class="Symbol">(</a><a id="20900" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="20902" href="/DenotSound/#20874" class="Bound">n&#39;</a><a id="20904" class="Symbol">))</a></pre>

<p>The above lemma proceeds by induction on n.</p>

<ul>
  <li>If it is Z, then we show that v’ ⊑ v’ by Refl⊑.</li>
  <li>If it is S n,’ then from the premise we obtain
γ ⊢ # n’ ↓ nth n’ δ’. By var-inv we have
nth n’ δ’ ⊑ nth n’ γ from which we conclude that
nth (S n’) (δ’ , v’) ⊑ nth (var-id (S n’)) (γ , v’).</li>
</ul>

<p>Returning to the proof that single substitution reflects
denotations, we have just proved that</p>

<p>(γ `, v’) ⊢ rename var-id M ↓ v</p>

<p>but we need to show (γ `, v’) ⊢ M ↓ v. 
So we apply the rename-id lemma to obtain
rename var-id M ≡ M.</p>

<p>The following is the formal version of this proof.</p>

<pre class="Agda"><a id="subst-zero-reflect"></a><a id="21513" href="/DenotSound/#21513" class="Function">subst-zero-reflect</a> <a id="21532" class="Symbol">:</a> <a id="21534" class="Symbol">∀</a> <a id="21536" class="Symbol">{</a><a id="21537" href="/DenotSound/#21537" class="Bound">Δ</a><a id="21538" class="Symbol">}</a> <a id="21540" class="Symbol">{</a><a id="21541" href="/DenotSound/#21541" class="Bound">δ</a> <a id="21543" class="Symbol">:</a> <a id="21545" href="/Denot/#7488" class="Function">Env</a> <a id="21549" href="/DenotSound/#21537" class="Bound">Δ</a><a id="21550" class="Symbol">}</a> <a id="21552" class="Symbol">{</a><a id="21553" href="/DenotSound/#21553" class="Bound">γ</a> <a id="21555" class="Symbol">:</a> <a id="21557" href="/Denot/#7488" class="Function">Env</a> <a id="21561" class="Symbol">(</a><a id="21562" href="/DenotSound/#21537" class="Bound">Δ</a> <a id="21564" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="21566" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21567" class="Symbol">)}</a> <a id="21570" class="Symbol">{</a><a id="21571" href="/DenotSound/#21571" class="Bound">N</a> <a id="21573" class="Symbol">:</a> <a id="21575" href="/DenotSound/#21537" class="Bound">Δ</a> <a id="21577" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21579" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21580" class="Symbol">}</a>
  <a id="21584" class="Symbol">→</a> <a id="21586" href="/DenotSound/#21541" class="Bound">δ</a> <a id="21588" href="/DenotSound/#2933" class="Function Operator">`⊢</a> <a id="21591" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="21602" href="/DenotSound/#21571" class="Bound">N</a> <a id="21604" href="/DenotSound/#2933" class="Function Operator">↓</a> <a id="21606" href="/DenotSound/#21553" class="Bound">γ</a>
    <a id="21612" class="Comment">----------------------------------------</a>
  <a id="21655" class="Symbol">→</a> <a id="21657" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="21660" href="/DenotSound/#21660" class="Bound">w</a> <a id="21662" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="21664" href="/Denot/#4101" class="Datatype">Value</a> <a id="21670" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="21672" href="/DenotSound/#21553" class="Bound">γ</a> <a id="21674" href="/Denot/#8499" class="Function Operator">`⊑</a> <a id="21677" class="Symbol">(</a><a id="21678" href="/DenotSound/#21541" class="Bound">δ</a> <a id="21680" href="/Denot/#7646" class="Function Operator">`,</a> <a id="21683" href="/DenotSound/#21660" class="Bound">w</a><a id="21684" class="Symbol">)</a> <a id="21686" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a> <a id="21688" href="/DenotSound/#21541" class="Bound">δ</a> <a id="21690" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="21692" href="/DenotSound/#21571" class="Bound">N</a> <a id="21694" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="21696" href="/DenotSound/#21660" class="Bound">w</a>
<a id="21698" href="/DenotSound/#21513" class="Function">subst-zero-reflect</a> <a id="21717" class="Symbol">{</a><a id="21718" class="Argument">δ</a> <a id="21720" class="Symbol">=</a> <a id="21722" href="/DenotSound/#21722" class="Bound">δ</a><a id="21723" class="Symbol">}</a> <a id="21725" class="Symbol">{</a><a id="21726" class="Argument">γ</a> <a id="21728" class="Symbol">=</a> <a id="21730" href="/DenotSound/#21730" class="Bound">γ</a><a id="21731" class="Symbol">}</a> <a id="21733" href="/DenotSound/#21733" class="Bound">δσγ</a> <a id="21737" class="Symbol">=</a> <a id="21739" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21741" href="/Denot/#7954" class="Function">last</a> <a id="21746" href="/DenotSound/#21730" class="Bound">γ</a> <a id="21748" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21750" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21752" href="/DenotSound/#21783" class="Function">lemma</a> <a id="21758" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21760" href="/DenotSound/#21733" class="Bound">δσγ</a> <a id="21764" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="21766" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21768" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>   
  <a id="21775" class="Keyword">where</a>
  <a id="21783" href="/DenotSound/#21783" class="Function">lemma</a> <a id="21789" class="Symbol">:</a> <a id="21791" href="/DenotSound/#21730" class="Bound">γ</a> <a id="21793" href="/Denot/#8499" class="Function Operator">`⊑</a> <a id="21796" class="Symbol">(</a><a id="21797" href="/DenotSound/#21722" class="Bound">δ</a> <a id="21799" href="/Denot/#7646" class="Function Operator">`,</a> <a id="21802" href="/Denot/#7954" class="Function">last</a> <a id="21807" href="/DenotSound/#21730" class="Bound">γ</a><a id="21808" class="Symbol">)</a>
  <a id="21812" href="/DenotSound/#21783" class="Function">lemma</a> <a id="21818" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="21821" class="Symbol">=</a>  <a id="21824" href="/Denot/#5698" class="Function">Refl⊑</a>
  <a id="21832" href="/DenotSound/#21783" class="Function">lemma</a> <a id="21838" class="Symbol">(</a><a id="21839" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21841" href="/DenotSound/#21841" class="Bound">x</a><a id="21842" class="Symbol">)</a> <a id="21844" class="Symbol">=</a> <a id="21846" href="/DenotCompositional/#9278" class="Function">var-inv</a> <a id="21854" class="Symbol">(</a><a id="21855" href="/DenotSound/#21733" class="Bound">δσγ</a> <a id="21859" class="Symbol">(</a><a id="21860" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21862" href="/DenotSound/#21841" class="Bound">x</a><a id="21863" class="Symbol">))</a>
  
<a id="substitution-reflect"></a><a id="21869" href="/DenotSound/#21869" class="Function">substitution-reflect</a> <a id="21890" class="Symbol">:</a> <a id="21892" class="Symbol">∀</a> <a id="21894" class="Symbol">{</a><a id="21895" href="/DenotSound/#21895" class="Bound">Δ</a><a id="21896" class="Symbol">}</a> <a id="21898" class="Symbol">{</a><a id="21899" href="/DenotSound/#21899" class="Bound">δ</a> <a id="21901" class="Symbol">:</a> <a id="21903" href="/Denot/#7488" class="Function">Env</a> <a id="21907" href="/DenotSound/#21895" class="Bound">Δ</a><a id="21908" class="Symbol">}</a> <a id="21910" class="Symbol">{</a><a id="21911" href="/DenotSound/#21911" class="Bound">M</a> <a id="21913" class="Symbol">:</a> <a id="21915" href="/DenotSound/#21895" class="Bound">Δ</a> <a id="21917" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="21919" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="21921" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21923" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21924" class="Symbol">}</a> <a id="21926" class="Symbol">{</a><a id="21927" href="/DenotSound/#21927" class="Bound">N</a> <a id="21929" class="Symbol">:</a> <a id="21931" href="/DenotSound/#21895" class="Bound">Δ</a> <a id="21933" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21935" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21936" class="Symbol">}</a> <a id="21938" class="Symbol">{</a><a id="21939" href="/DenotSound/#21939" class="Bound">v</a><a id="21940" class="Symbol">}</a>
  <a id="21944" class="Symbol">→</a> <a id="21946" href="/DenotSound/#21899" class="Bound">δ</a> <a id="21948" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="21950" href="/DenotSound/#21911" class="Bound">M</a> <a id="21952" href="/Untyped/#7475" class="Function Operator">[</a> <a id="21954" href="/DenotSound/#21927" class="Bound">N</a> <a id="21956" href="/Untyped/#7475" class="Function Operator">]</a> <a id="21958" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="21960" href="/DenotSound/#21939" class="Bound">v</a>
    <a id="21966" class="Comment">------------------------------------------------</a>
  <a id="22017" class="Symbol">→</a> <a id="22019" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="22022" href="/DenotSound/#22022" class="Bound">w</a> <a id="22024" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="22026" href="/Denot/#4101" class="Datatype">Value</a> <a id="22032" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="22034" href="/DenotSound/#21899" class="Bound">δ</a> <a id="22036" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="22038" href="/DenotSound/#21927" class="Bound">N</a> <a id="22040" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="22042" href="/DenotSound/#22022" class="Bound">w</a>  <a id="22045" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="22048" class="Symbol">(</a><a id="22049" href="/DenotSound/#21899" class="Bound">δ</a> <a id="22051" href="/Denot/#7646" class="Function Operator">`,</a> <a id="22054" href="/DenotSound/#22022" class="Bound">w</a><a id="22055" class="Symbol">)</a> <a id="22057" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="22059" href="/DenotSound/#21911" class="Bound">M</a> <a id="22061" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="22063" href="/DenotSound/#21939" class="Bound">v</a>
<a id="22065" href="/DenotSound/#21869" class="Function">substitution-reflect</a> <a id="22086" href="/DenotSound/#22086" class="Bound">d</a> <a id="22088" class="Keyword">with</a> <a id="22093" href="/DenotSound/#15715" class="Function">subst-reflect</a> <a id="22107" href="/DenotSound/#22086" class="Bound">d</a> <a id="22109" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="22114" class="Symbol">...</a>  <a id="22119" class="Symbol">|</a> <a id="22121" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22123" href="/DenotSound/#22123" class="Bound">γ</a> <a id="22125" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22127" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22129" href="/DenotSound/#22129" class="Bound">δσγ</a> <a id="22133" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22135" href="/DenotSound/#22135" class="Bound">γMv</a> <a id="22139" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22141" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22143" class="Keyword">with</a> <a id="22148" href="/DenotSound/#21513" class="Function">subst-zero-reflect</a> <a id="22167" href="/DenotSound/#22129" class="Bound">δσγ</a>
<a id="22171" class="Symbol">...</a>    <a id="22178" class="Symbol">|</a> <a id="22180" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22182" href="/DenotSound/#22182" class="Bound">w</a> <a id="22184" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22186" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22188" href="/DenotSound/#22188" class="Bound">ineq</a> <a id="22193" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22195" href="/DenotSound/#22195" class="Bound">δNw</a> <a id="22199" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22201" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22203" class="Symbol">=</a> <a id="22205" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22207" href="/DenotSound/#22182" class="Bound">w</a> <a id="22209" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22211" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22213" href="/DenotSound/#22195" class="Bound">δNw</a> <a id="22217" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22219" href="/Denot/#26210" class="Function">Env⊑</a> <a id="22224" class="Bound">γMv</a> <a id="22228" href="/DenotSound/#22188" class="Bound">ineq</a> <a id="22233" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22235" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<h3 id="reduction-reflects-denotations-1">Reduction reflects denotations</h3>

<p>Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.</p>

<pre class="Agda"><a id="reflect-beta"></a><a id="22409" href="/DenotSound/#22409" class="Function">reflect-beta</a> <a id="22422" class="Symbol">:</a> <a id="22424" class="Symbol">∀{</a><a id="22426" href="/DenotSound/#22426" class="Bound">Γ</a><a id="22427" class="Symbol">}{</a><a id="22429" href="/DenotSound/#22429" class="Bound">γ</a> <a id="22431" class="Symbol">:</a> <a id="22433" href="/Denot/#7488" class="Function">Env</a> <a id="22437" href="/DenotSound/#22426" class="Bound">Γ</a><a id="22438" class="Symbol">}{</a><a id="22440" href="/DenotSound/#22440" class="Bound">M</a> <a id="22442" href="/DenotSound/#22442" class="Bound">N</a><a id="22443" class="Symbol">}{</a><a id="22445" href="/DenotSound/#22445" class="Bound">v</a><a id="22446" class="Symbol">}</a>
    <a id="22452" class="Symbol">→</a> <a id="22454" href="/DenotSound/#22429" class="Bound">γ</a> <a id="22456" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="22458" class="Symbol">(</a><a id="22459" href="/DenotSound/#22442" class="Bound">N</a> <a id="22461" href="/Untyped/#7475" class="Function Operator">[</a> <a id="22463" href="/DenotSound/#22440" class="Bound">M</a> <a id="22465" href="/Untyped/#7475" class="Function Operator">]</a><a id="22466" class="Symbol">)</a> <a id="22468" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="22470" href="/DenotSound/#22445" class="Bound">v</a>
    <a id="22476" class="Symbol">→</a> <a id="22478" href="/DenotSound/#22429" class="Bound">γ</a> <a id="22480" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="22482" class="Symbol">(</a><a id="22483" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="22485" href="/DenotSound/#22442" class="Bound">N</a><a id="22486" class="Symbol">)</a> <a id="22488" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="22490" href="/DenotSound/#22440" class="Bound">M</a> <a id="22492" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="22494" href="/DenotSound/#22445" class="Bound">v</a>
<a id="22496" href="/DenotSound/#22409" class="Function">reflect-beta</a> <a id="22509" href="/DenotSound/#22509" class="Bound">d</a> 
    <a id="22516" class="Keyword">with</a> <a id="22521" href="/DenotSound/#21869" class="Function">substitution-reflect</a> <a id="22542" href="/DenotSound/#22509" class="Bound">d</a>
<a id="22544" class="Symbol">...</a> <a id="22548" class="Symbol">|</a> <a id="22550" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22552" href="/DenotSound/#22552" class="Bound">v₂&#39;</a> <a id="22556" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22558" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22560" href="/DenotSound/#22560" class="Bound">d₁&#39;</a> <a id="22564" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22566" href="/DenotSound/#22566" class="Bound">d₂&#39;</a> <a id="22570" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22572" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22574" class="Symbol">=</a> <a id="22576" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="22583" class="Symbol">(</a><a id="22584" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="22592" href="/DenotSound/#22566" class="Bound">d₂&#39;</a><a id="22595" class="Symbol">)</a> <a id="22597" href="/DenotSound/#22560" class="Bound">d₁&#39;</a> 


<a id="reflect"></a><a id="22604" href="/DenotSound/#22604" class="Function">reflect</a> <a id="22612" class="Symbol">:</a> <a id="22614" class="Symbol">∀</a> <a id="22616" class="Symbol">{</a><a id="22617" href="/DenotSound/#22617" class="Bound">Γ</a><a id="22618" class="Symbol">}</a> <a id="22620" class="Symbol">{</a><a id="22621" href="/DenotSound/#22621" class="Bound">γ</a> <a id="22623" class="Symbol">:</a> <a id="22625" href="/Denot/#7488" class="Function">Env</a> <a id="22629" href="/DenotSound/#22617" class="Bound">Γ</a><a id="22630" class="Symbol">}</a> <a id="22632" class="Symbol">{</a><a id="22633" href="/DenotSound/#22633" class="Bound">M</a> <a id="22635" href="/DenotSound/#22635" class="Bound">M&#39;</a> <a id="22638" href="/DenotSound/#22638" class="Bound">N</a> <a id="22640" href="/DenotSound/#22640" class="Bound">v</a><a id="22641" class="Symbol">}</a>
  <a id="22645" class="Symbol">→</a> <a id="22647" href="/DenotSound/#22621" class="Bound">γ</a> <a id="22649" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="22651" href="/DenotSound/#22638" class="Bound">N</a> <a id="22653" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="22655" href="/DenotSound/#22640" class="Bound">v</a>  <a id="22658" class="Symbol">→</a>  <a id="22661" href="/DenotSound/#22633" class="Bound">M</a> <a id="22663" href="/Untyped/#10070" class="Datatype Operator">—→</a> <a id="22666" href="/DenotSound/#22635" class="Bound">M&#39;</a>  <a id="22670" class="Symbol">→</a>   <a id="22674" href="/DenotSound/#22635" class="Bound">M&#39;</a> <a id="22677" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="22679" href="/DenotSound/#22638" class="Bound">N</a>
    <a id="22685" class="Comment">---------------------------------</a>
  <a id="22721" class="Symbol">→</a> <a id="22723" href="/DenotSound/#22621" class="Bound">γ</a> <a id="22725" href="/Denot/#9991" class="Datatype Operator">⊢</a> <a id="22727" href="/DenotSound/#22633" class="Bound">M</a> <a id="22729" href="/Denot/#9991" class="Datatype Operator">↓</a> <a id="22731" href="/DenotSound/#22640" class="Bound">v</a>
<a id="22733" href="/DenotSound/#22604" class="Function">reflect</a> <a id="22741" class="Symbol">(</a><a id="22742" href="/Denot/#10045" class="InductiveConstructor">var</a><a id="22745" class="Symbol">)</a> <a id="22747" class="Symbol">(</a><a id="22748" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="22751" href="/DenotSound/#22751" class="Bound">x₁</a> <a id="22754" href="/DenotSound/#22754" class="Bound">r</a><a id="22755" class="Symbol">)</a> <a id="22757" class="Symbol">()</a>
<a id="22760" href="/DenotSound/#22604" class="Function">reflect</a> <a id="22768" class="Symbol">(</a><a id="22769" href="/Denot/#10045" class="InductiveConstructor">var</a><a id="22772" class="Symbol">)</a> <a id="22774" class="Symbol">(</a><a id="22775" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="22778" href="/DenotSound/#22778" class="Bound">x₁</a> <a id="22781" href="/DenotSound/#22781" class="Bound">r</a><a id="22782" class="Symbol">)</a> <a id="22784" class="Symbol">()</a>
<a id="22787" href="/DenotSound/#22604" class="Function">reflect</a><a id="22794" class="Symbol">{</a><a id="22795" class="Argument">γ</a> <a id="22797" class="Symbol">=</a> <a id="22799" href="/DenotSound/#22799" class="Bound">γ</a><a id="22800" class="Symbol">}</a> <a id="22802" class="Symbol">(</a><a id="22803" href="/Denot/#10045" class="InductiveConstructor">var</a><a id="22806" class="Symbol">{</a><a id="22807" class="Argument">x</a> <a id="22809" class="Symbol">=</a> <a id="22811" href="/DenotSound/#22811" class="Bound">x</a><a id="22812" class="Symbol">})</a> <a id="22815" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="22817" href="/DenotSound/#22817" class="Bound">mn</a>
    <a id="22824" class="Keyword">with</a> <a id="22829" href="/Denot/#10045" class="InductiveConstructor">var</a><a id="22832" class="Symbol">{</a><a id="22833" class="Argument">γ</a> <a id="22835" class="Symbol">=</a> <a id="22837" href="/DenotSound/#22799" class="Bound">γ</a><a id="22838" class="Symbol">}{</a><a id="22840" class="Argument">x</a> <a id="22842" class="Symbol">=</a> <a id="22844" href="/DenotSound/#22811" class="Bound">x</a><a id="22845" class="Symbol">}</a>
<a id="22847" class="Symbol">...</a> <a id="22851" class="Symbol">|</a> <a id="22853" href="/DenotSound/#22853" class="Bound">d&#39;</a> <a id="22856" class="Keyword">rewrite</a> <a id="22864" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="22868" class="Bound">mn</a> <a id="22871" class="Symbol">=</a> <a id="22873" href="/DenotSound/#22409" class="Function">reflect-beta</a> <a id="22886" href="/DenotSound/#22853" class="Bound">d&#39;</a> 
<a id="22890" href="/DenotSound/#22604" class="Function">reflect</a> <a id="22898" class="Symbol">(</a><a id="22899" href="/Denot/#10045" class="InductiveConstructor">var</a><a id="22902" class="Symbol">)</a> <a id="22904" class="Symbol">(</a><a id="22905" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="22907" href="/DenotSound/#22907" class="Bound">r</a><a id="22908" class="Symbol">)</a> <a id="22910" class="Symbol">()</a>
<a id="22913" href="/DenotSound/#22604" class="Function">reflect</a> <a id="22921" class="Symbol">(</a><a id="22922" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="22929" href="/DenotSound/#22929" class="Bound">d₁</a> <a id="22932" href="/DenotSound/#22932" class="Bound">d₂</a><a id="22934" class="Symbol">)</a> <a id="22936" class="Symbol">(</a><a id="22937" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="22940" href="/DenotSound/#22940" class="Bound">x</a> <a id="22942" href="/DenotSound/#22942" class="Bound">r</a><a id="22943" class="Symbol">)</a> <a id="22945" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="22950" class="Symbol">=</a> <a id="22952" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="22959" class="Symbol">(</a><a id="22960" href="/DenotSound/#22604" class="Function">reflect</a> <a id="22968" href="/DenotSound/#22929" class="Bound">d₁</a> <a id="22971" href="/DenotSound/#22942" class="Bound">r</a> <a id="22973" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="22977" class="Symbol">)</a> <a id="22979" href="/DenotSound/#22932" class="Bound">d₂</a> 
<a id="22983" href="/DenotSound/#22604" class="Function">reflect</a> <a id="22991" class="Symbol">(</a><a id="22992" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="22999" href="/DenotSound/#22999" class="Bound">d₁</a> <a id="23002" href="/DenotSound/#23002" class="Bound">d₂</a><a id="23004" class="Symbol">)</a> <a id="23006" class="Symbol">(</a><a id="23007" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="23010" href="/DenotSound/#23010" class="Bound">x</a> <a id="23012" href="/DenotSound/#23012" class="Bound">r</a><a id="23013" class="Symbol">)</a> <a id="23015" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23020" class="Symbol">=</a> <a id="23022" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="23029" href="/DenotSound/#22999" class="Bound">d₁</a> <a id="23032" class="Symbol">(</a><a id="23033" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23041" href="/DenotSound/#23002" class="Bound">d₂</a> <a id="23044" href="/DenotSound/#23012" class="Bound">r</a> <a id="23046" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23050" class="Symbol">)</a> 
<a id="23053" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23061" class="Symbol">(</a><a id="23062" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="23069" href="/DenotSound/#23069" class="Bound">d₁</a> <a id="23072" href="/DenotSound/#23072" class="Bound">d₂</a><a id="23074" class="Symbol">)</a> <a id="23076" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="23078" href="/DenotSound/#23078" class="Bound">mn</a>
    <a id="23085" class="Keyword">with</a> <a id="23090" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="23097" href="/DenotSound/#23069" class="Bound">d₁</a> <a id="23100" href="/DenotSound/#23072" class="Bound">d₂</a>
<a id="23103" class="Symbol">...</a> <a id="23107" class="Symbol">|</a> <a id="23109" href="/DenotSound/#23109" class="Bound">d&#39;</a> <a id="23112" class="Keyword">rewrite</a> <a id="23120" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23124" class="Bound">mn</a> <a id="23127" class="Symbol">=</a> <a id="23129" href="/DenotSound/#22409" class="Function">reflect-beta</a> <a id="23142" href="/DenotSound/#23109" class="Bound">d&#39;</a>
<a id="23145" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23153" class="Symbol">(</a><a id="23154" href="/Denot/#10128" class="InductiveConstructor">↦-elim</a> <a id="23161" href="/DenotSound/#23161" class="Bound">d₁</a> <a id="23164" href="/DenotSound/#23164" class="Bound">d₂</a><a id="23166" class="Symbol">)</a> <a id="23168" class="Symbol">(</a><a id="23169" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="23171" href="/DenotSound/#23171" class="Bound">r</a><a id="23172" class="Symbol">)</a> <a id="23174" class="Symbol">()</a>
<a id="23177" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23185" class="Symbol">(</a><a id="23186" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="23194" href="/DenotSound/#23194" class="Bound">d</a><a id="23195" class="Symbol">)</a> <a id="23197" class="Symbol">(</a><a id="23198" href="/Untyped/#10120" class="InductiveConstructor">ξ₁</a> <a id="23201" href="/DenotSound/#23201" class="Bound">x</a> <a id="23203" href="/DenotSound/#23203" class="Bound">r</a><a id="23204" class="Symbol">)</a> <a id="23206" class="Symbol">()</a>
<a id="23209" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23217" class="Symbol">(</a><a id="23218" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="23226" href="/DenotSound/#23226" class="Bound">d</a><a id="23227" class="Symbol">)</a> <a id="23229" class="Symbol">(</a><a id="23230" href="/Untyped/#10230" class="InductiveConstructor">ξ₂</a> <a id="23233" href="/DenotSound/#23233" class="Bound">x</a> <a id="23235" href="/DenotSound/#23235" class="Bound">r</a><a id="23236" class="Symbol">)</a> <a id="23238" class="Symbol">()</a>
<a id="23241" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23249" class="Symbol">(</a><a id="23250" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="23258" href="/DenotSound/#23258" class="Bound">d</a><a id="23259" class="Symbol">)</a> <a id="23261" href="/Untyped/#10336" class="InductiveConstructor">β</a> <a id="23263" href="/DenotSound/#23263" class="Bound">mn</a>
    <a id="23270" class="Keyword">with</a> <a id="23275" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="23283" href="/DenotSound/#23258" class="Bound">d</a>
<a id="23285" class="Symbol">...</a> <a id="23289" class="Symbol">|</a> <a id="23291" href="/DenotSound/#23291" class="Bound">d&#39;</a> <a id="23294" class="Keyword">rewrite</a> <a id="23302" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23306" class="Bound">mn</a> <a id="23309" class="Symbol">=</a> <a id="23311" href="/DenotSound/#22409" class="Function">reflect-beta</a> <a id="23324" href="/DenotSound/#23291" class="Bound">d&#39;</a>
<a id="23327" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23335" class="Symbol">(</a><a id="23336" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="23344" href="/DenotSound/#23344" class="Bound">d</a><a id="23345" class="Symbol">)</a> <a id="23347" class="Symbol">(</a><a id="23348" href="/Untyped/#10444" class="InductiveConstructor">ζ</a> <a id="23350" href="/DenotSound/#23350" class="Bound">r</a><a id="23351" class="Symbol">)</a> <a id="23353" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23358" class="Symbol">=</a> <a id="23360" href="/Denot/#10281" class="InductiveConstructor">↦-intro</a> <a id="23368" class="Symbol">(</a><a id="23369" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23377" href="/DenotSound/#23344" class="Bound">d</a> <a id="23379" href="/DenotSound/#23350" class="Bound">r</a> <a id="23381" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23385" class="Symbol">)</a>
<a id="23387" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23395" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a> <a id="23403" href="/DenotSound/#23403" class="Bound">r</a> <a id="23405" href="/DenotSound/#23405" class="Bound">mn</a> <a id="23408" class="Symbol">=</a> <a id="23410" href="/Denot/#10413" class="InductiveConstructor">⊥-intro</a>
<a id="23418" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23426" class="Symbol">(</a><a id="23427" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="23435" href="/DenotSound/#23435" class="Bound">d₁</a> <a id="23438" href="/DenotSound/#23438" class="Bound">d₂</a><a id="23440" class="Symbol">)</a> <a id="23442" href="/DenotSound/#23442" class="Bound">r</a> <a id="23444" href="/DenotSound/#23444" class="Bound">mn</a> <a id="23447" class="Keyword">rewrite</a> <a id="23455" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23459" href="/DenotSound/#23444" class="Bound">mn</a> <a id="23462" class="Symbol">=</a>
   <a id="23467" href="/Denot/#10488" class="InductiveConstructor">⊔-intro</a> <a id="23475" class="Symbol">(</a><a id="23476" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23484" href="/DenotSound/#23435" class="Bound">d₁</a> <a id="23487" href="/DenotSound/#23442" class="Bound">r</a> <a id="23489" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23493" class="Symbol">)</a> <a id="23495" class="Symbol">(</a><a id="23496" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23504" href="/DenotSound/#23438" class="Bound">d₂</a> <a id="23507" href="/DenotSound/#23442" class="Bound">r</a> <a id="23509" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23513" class="Symbol">)</a>
<a id="23515" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23523" class="Symbol">(</a><a id="23524" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="23528" href="/DenotSound/#23528" class="Bound">d</a> <a id="23530" href="/DenotSound/#23530" class="Bound">lt</a><a id="23532" class="Symbol">)</a> <a id="23534" href="/DenotSound/#23534" class="Bound">r</a> <a id="23536" href="/DenotSound/#23536" class="Bound">mn</a> <a id="23539" class="Symbol">=</a> <a id="23541" href="/Denot/#10632" class="InductiveConstructor">sub</a> <a id="23545" class="Symbol">(</a><a id="23546" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23554" href="/DenotSound/#23528" class="Bound">d</a> <a id="23556" href="/DenotSound/#23534" class="Bound">r</a> <a id="23558" href="/DenotSound/#23536" class="Bound">mn</a><a id="23560" class="Symbol">)</a> <a id="23562" href="/DenotSound/#23530" class="Bound">lt</a></pre>

<h2 id="finale-reduction-implies-denotational-equality">Finale: reduction implies denotational equality</h2>

<p>We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.</p>

<pre class="Agda"><a id="reduce-equal"></a><a id="23762" href="/DenotSound/#23762" class="Function">reduce-equal</a> <a id="23775" class="Symbol">:</a> <a id="23777" class="Symbol">∀</a> <a id="23779" class="Symbol">{</a><a id="23780" href="/DenotSound/#23780" class="Bound">Γ</a><a id="23781" class="Symbol">}</a> <a id="23783" class="Symbol">{</a><a id="23784" href="/DenotSound/#23784" class="Bound">M</a> <a id="23786" class="Symbol">:</a> <a id="23788" href="/DenotSound/#23780" class="Bound">Γ</a> <a id="23790" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="23792" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="23793" class="Symbol">}</a> <a id="23795" class="Symbol">{</a><a id="23796" href="/DenotSound/#23796" class="Bound">N</a> <a id="23798" class="Symbol">:</a> <a id="23800" href="/DenotSound/#23780" class="Bound">Γ</a> <a id="23802" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="23804" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="23805" class="Symbol">}</a>
  <a id="23809" class="Symbol">→</a> <a id="23811" href="/DenotSound/#23784" class="Bound">M</a> <a id="23813" href="/Untyped/#10070" class="Datatype Operator">—→</a> <a id="23816" href="/DenotSound/#23796" class="Bound">N</a>
    <a id="23822" class="Comment">---------</a>
  <a id="23834" class="Symbol">→</a> <a id="23836" href="/Denot/#18470" class="Function">ℰ</a> <a id="23838" href="/DenotSound/#23784" class="Bound">M</a> <a id="23840" href="/Denot/#18668" class="Function Operator">≃</a> <a id="23842" href="/Denot/#18470" class="Function">ℰ</a> <a id="23844" href="/DenotSound/#23796" class="Bound">N</a>
<a id="23846" href="/DenotSound/#23762" class="Function">reduce-equal</a> <a id="23859" class="Symbol">{</a><a id="23860" href="/DenotSound/#23860" class="Bound">Γ</a><a id="23861" class="Symbol">}{</a><a id="23863" href="/DenotSound/#23863" class="Bound">M</a><a id="23864" class="Symbol">}{</a><a id="23866" href="/DenotSound/#23866" class="Bound">N</a><a id="23867" class="Symbol">}</a> <a id="23869" href="/DenotSound/#23869" class="Bound">r</a> <a id="23871" class="Symbol">=</a> <a id="23873" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="23875" class="Symbol">(λ</a> <a id="23878" href="/DenotSound/#23878" class="Bound">m</a> <a id="23880" class="Symbol">→</a> <a id="23882" href="/DenotSound/#6417" class="Function">preserve</a> <a id="23891" href="/DenotSound/#23878" class="Bound">m</a> <a id="23893" href="/DenotSound/#23869" class="Bound">r</a><a id="23894" class="Symbol">)</a> <a id="23896" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="23898" class="Symbol">(λ</a> <a id="23901" href="/DenotSound/#23901" class="Bound">n</a> <a id="23903" class="Symbol">→</a> <a id="23905" href="/DenotSound/#22604" class="Function">reflect</a> <a id="23913" href="/DenotSound/#23901" class="Bound">n</a> <a id="23915" href="/DenotSound/#23869" class="Bound">r</a> <a id="23917" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23921" class="Symbol">)</a> <a id="23923" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<p>We conclude that multi-step reduction to a lambda abstraction implies
denotational equivalence to a lambda abstraction.</p>

<pre class="Agda"><a id="denot-sound"></a><a id="24071" href="/DenotSound/#24071" class="Function">denot-sound</a> <a id="24083" class="Symbol">:</a> <a id="24085" class="Symbol">∀{</a><a id="24087" href="/DenotSound/#24087" class="Bound">Γ</a><a id="24088" class="Symbol">}</a> <a id="24090" class="Symbol">{</a><a id="24091" href="/DenotSound/#24091" class="Bound">M</a> <a id="24093" class="Symbol">:</a> <a id="24095" href="/DenotSound/#24087" class="Bound">Γ</a> <a id="24097" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24099" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24100" class="Symbol">}</a> <a id="24102" class="Symbol">{</a><a id="24103" href="/DenotSound/#24103" class="Bound">N</a> <a id="24105" class="Symbol">:</a> <a id="24107" href="/DenotSound/#24087" class="Bound">Γ</a> <a id="24109" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="24111" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="24113" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24115" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24116" class="Symbol">}</a>
  <a id="24120" class="Symbol">→</a> <a id="24122" href="/DenotSound/#24091" class="Bound">M</a> <a id="24124" href="/Untyped/#11252" class="Datatype Operator">—↠</a> <a id="24127" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24129" href="/DenotSound/#24103" class="Bound">N</a>
    <a id="24135" class="Comment">-----------------</a>
  <a id="24155" class="Symbol">→</a> <a id="24157" href="/Denot/#18470" class="Function">ℰ</a> <a id="24159" href="/DenotSound/#24091" class="Bound">M</a> <a id="24161" href="/Denot/#18668" class="Function Operator">≃</a> <a id="24163" href="/Denot/#18470" class="Function">ℰ</a> <a id="24165" class="Symbol">(</a><a id="24166" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24168" href="/DenotSound/#24103" class="Bound">N</a><a id="24169" class="Symbol">)</a>
<a id="24171" href="/DenotSound/#24071" class="Function">denot-sound</a> <a id="24183" class="Symbol">(</a><a id="24184" class="DottedPattern Symbol">.(</a><a id="24186" href="/Untyped/#4238" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="24188" class="DottedPattern Symbol">_)</a> <a id="24191" href="/Untyped/#11302" class="InductiveConstructor Operator">∎</a><a id="24192" class="Symbol">)</a> <a id="24194" class="Symbol">=</a> <a id="24196" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="24198" class="Symbol">(λ</a> <a id="24201" href="/DenotSound/#24201" class="Bound">x</a> <a id="24203" class="Symbol">→</a> <a id="24205" href="/DenotSound/#24201" class="Bound">x</a><a id="24206" class="Symbol">)</a> <a id="24208" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="24210" class="Symbol">(λ</a> <a id="24213" href="/DenotSound/#24213" class="Bound">x</a> <a id="24215" class="Symbol">→</a> <a id="24217" href="/DenotSound/#24213" class="Bound">x</a><a id="24218" class="Symbol">)</a> <a id="24220" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="24222" href="/DenotSound/#24071" class="Function">denot-sound</a> <a id="24234" class="Symbol">{</a><a id="24235" href="/DenotSound/#24235" class="Bound">Γ</a><a id="24236" class="Symbol">}</a> <a id="24238" class="Symbol">(</a><a id="24239" href="/DenotSound/#24239" class="Bound">L</a> <a id="24241" href="/Untyped/#11358" class="InductiveConstructor Operator">—→⟨</a> <a id="24245" href="/DenotSound/#24245" class="Bound">r</a> <a id="24247" href="/Untyped/#11358" class="InductiveConstructor Operator">⟩</a> <a id="24249" href="/DenotSound/#24249" class="Bound">M—↠N</a><a id="24253" class="Symbol">)</a> <a id="24255" class="Symbol">{</a><a id="24256" href="/DenotSound/#24256" class="Bound">γ</a><a id="24257" class="Symbol">}</a> <a id="24259" class="Symbol">{</a><a id="24260" href="/DenotSound/#24260" class="Bound">v</a><a id="24261" class="Symbol">}</a> <a id="24263" class="Symbol">=</a>
  <a id="24267" class="Keyword">let</a> <a id="24271" href="/DenotSound/#24271" class="Bound">ih</a> <a id="24274" class="Symbol">=</a> <a id="24276" href="/DenotSound/#24071" class="Function">denot-sound</a> <a id="24288" href="/DenotSound/#24249" class="Bound">M—↠N</a> <a id="24293" class="Keyword">in</a>
  <a id="24298" class="Keyword">let</a> <a id="24302" href="/DenotSound/#24302" class="Bound">e</a> <a id="24304" class="Symbol">=</a> <a id="24306" href="/DenotSound/#23762" class="Function">reduce-equal</a> <a id="24319" href="/DenotSound/#24245" class="Bound">r</a> <a id="24321" class="Symbol">{</a><a id="24322" href="/DenotSound/#24256" class="Bound">γ</a><a id="24323" class="Symbol">}</a> <a id="24325" class="Symbol">{</a><a id="24326" href="/DenotSound/#24260" class="Bound">v</a><a id="24327" class="Symbol">}</a> <a id="24329" class="Keyword">in</a>
  <a id="24334" href="/Denot/#19041" class="Function">≃-trans</a> <a id="24342" class="Symbol">{</a><a id="24343" href="/DenotSound/#24235" class="Bound">Γ</a><a id="24344" class="Symbol">}</a> <a id="24346" href="/DenotSound/#24302" class="Bound">e</a> <a id="24348" href="/DenotSound/#24271" class="Bound">ih</a> <a id="24351" class="Symbol">{</a><a id="24352" href="/DenotSound/#24256" class="Bound">γ</a><a id="24353" class="Symbol">}</a> <a id="24355" class="Symbol">{</a><a id="24356" href="/DenotSound/#24260" class="Bound">v</a><a id="24357" class="Symbol">}</a></pre>


  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/DenotCompositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/DenotSound.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/DenotAdequate/">Next</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>

<!-- Script which allows for foldable code blocks -->
<script type="text/javascript">
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
